<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eddy World - Blue Theme</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        /* Header Styles */
        .header {
            background: #1d4ed8;
            color: white;
            padding: 5px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .header-top {
            background: rgba(255,255,255,0.06);
            padding: 4px 0;
            font-size: 12px;
        }

        .header-top-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-top-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-top-left a {
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .header-top-left a:hover {
            color: #e0e7ff;
        }

        .header-top-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-top-right a {
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .header-top-right a:hover {
            color: #e0e7ff;
        }

        .header-top-right .language-selector {
            margin: 0;
        }

        .header-top-right .language-selector select {
            background: transparent;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 12px;
        }

        .header-top-right .language-selector select option {
            background: #333;
            color: white;
        }

        .header-main {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            padding: 8px 0;
            gap: 20px;
        }

        .logo {
            font-size: 32px;
            font-weight: bold;
            color: #ffd700;
            margin-right: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            transition: transform 0.3s ease;
            flex-shrink: 0;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .search-container {
            flex: 1;
            max-width: 800px;
            margin: 0 15px;
            margin-top: 25px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .search-box {
            display: flex;
            background: white;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: 0 1px 2px rgba(0,0,0,0.06);
            transition: box-shadow 0.2s ease;
            border: 1px solid #e5e7eb;
            width: 100%;
        }

        .search-box:focus-within {
            box-shadow: 0 0 0 2px rgba(29,78,216,0.18);
        }

        .search-input {
            flex: 1;
            padding: 12px 16px;
            border: none;
            outline: none;
            font-size: 14px;
            border-radius: 6px 0 0 6px;
        }

        .search-btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 12px 16px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            border-radius: 0 6px 6px 0;
        }

        .search-btn:hover {
            background: #1d4ed8;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-left: 0;
        }

        .cart-icon, .user-icon, .wishlist-icon, .order-icon {
            color: white;
            font-size: 22px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
            padding: 10px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
        }

        .wishlist-icon {
            display: none;
        }

        .wishlist-icon.show {
            display: inline-block;
        }

        .cart-icon:hover, .user-icon:hover, .wishlist-icon:hover, .order-icon:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .admin-icon {
            color: #ffd700;
            font-size: 22px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
            padding: 10px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
        }

        .admin-icon:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
            color: #fff;
        }

        .cart-count, .wishlist-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa500 100%);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .notification-icon {
            color: #ffd700;
            font-size: 22px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
            padding: 10px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .notification-icon:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
            color: #fff;
        }



        /* Search Suggestions */
        .search-suggestions {
            display: flex;
            gap: 15px;
            margin-top: 8px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .search-suggestions span {
            color: white;
            font-size: 12px;
            cursor: pointer;
            transition: color 0.2s ease;
        }
        
        .search-suggestions span:hover {
            color: #ffd700;
        }

        /* Main Promotional Banner/Hero Section */
        .banner-section {
            max-width: 1200px;
            margin: 30px auto;
        }

        .main-banner {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            height: 220px;
        }

        /* Left Side - Image Carousel */
        .left-carousel {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            height: 220px;
        }

        .carousel-container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .carousel-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: none !important;
        }

        .carousel-slide.active {
            opacity: 1;
        }

        .carousel-slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .slide-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.2));
            color: white;
            padding: 25px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .slide-overlay h2 {
            font-size: 20px;
            margin: 0 0 8px 0;
            font-weight: 600;
        }

        .slide-overlay p {
            font-size: 14px;
            margin: 0 0 15px 0;
            opacity: 0.9;
        }

        /* Carousel Navigation Buttons */
        .carousel-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.8);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s ease;
        }

        .carousel-btn:hover {
            background: rgba(255, 255, 255, 1);
        }

        .prev-btn {
            left: 15px;
        }

        .next-btn {
            right: 15px;
        }

        /* Carousel Dots */
        .carousel-dots {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            z-index: 10;
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dot.active {
            background: rgba(255, 255, 255, 1);
        }

        .banner-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px 24px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .banner-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        /* Right Side - Two Picture Ads */
        .right-picture-ads {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .picture-ad {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            height: 102.5px;
        }

        .picture-ad img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Quick Access Category Icons */
        .quick-categories {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 20px;
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }

        .category-icon {
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .category-icon:hover {
            transform: translateY(-5px);
        }

        .icon-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin: 0 auto 10px;
            color: white;
        }

        .icon-circle.blue { background: #667eea; }
        .icon-circle.green { background: #28a745; }
        .icon-circle.orange { background: #ff6b35; }
        .icon-circle.red { background: #dc3545; }

        .category-icon span {
            font-size: 12px;
            color: #666;
            font-weight: 500;
        }

        /* Mid-Page Promotional Banner */
        .mid-promo-banner {
            margin: 20px auto;
            max-width: 1200px;
        }

        .promo-content {
            position: relative;
            width: 100%;
            height: 90px;
            overflow: hidden;
            border-radius: 8px;
        }

        .promo-content img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .promo-content img:hover {
            transform: scale(1.05);
        }

        /* Categories Section */
        .categories-section {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
            position: relative;
            overflow: hidden;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
        }

        .categories-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 20px 20px 0 20px;
        }

        .categories-header h2 {
            color: #333;
            font-size: 24px;
            font-weight: 600;
        }

        .categories-nav-btn {
            background: #f5f5f5;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .categories-nav-btn:hover {
            background: #e0e0e0;
            transform: scale(1.1);
        }

        .categories-grid {
            display: flex;
            gap: 0;
            overflow: hidden;
            transition: transform 0.5s ease;
            position: relative;
            width: max-content;
            max-width: 100%;
            padding: 0 20px 20px 20px;
        }
        
        .categories-row {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 15px;
            width: 100%;
            max-width: 1200px;
            flex-shrink: 0;
        }
        
        .categories-nav-btn i {
            transition: transform 0.3s ease;
        }
        
        .categories-grid.show-more + .categories-header .categories-nav-btn i {
            transform: rotate(180deg);
        }

        .category-item-grid {
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .category-item-grid:hover {
            transform: translateY(-5px);
        }

        .category-icon-grid {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            color: white;
            font-size: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .category-icon-grid img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }
        
        .category-icon-grid i {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2;
        }

        .category-icon-grid.blue { background: #667eea; }
        .category-icon-grid.green { background: #28a745; }
        .category-icon-grid.orange { background: #ff6b35; }
        .category-icon-grid.red { background: #dc3545; }

        .category-item-grid:hover .category-icon-grid {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .category-item-grid span {
            font-size: 12px;
            color: #666;
            font-weight: 500;
            display: block;
            line-height: 1.4;
            margin-top: 5px;
            min-height: 16px;
        }

        /* Flash Sale Section */
        .flash-sale-section {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }

        .flash-sale-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .flash-sale-title {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .flash-sale-title h2 {
            color: #ff6b35;
            font-size: 28px;
            font-weight: 700;
            margin: 0;
        }

        .countdown-timer {
            background: #000;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: bold;
            font-size: 18px;
            display: flex;
            gap: 8px;
        }

        .see-all-link {
            color: #ff6b35;
            text-decoration: none;
            font-weight: 600;
            font-size: 16px;
            transition: color 0.3s ease;
        }

        .see-all-link:hover {
            color: #e55a2b;
        }

        .flash-sale-products {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            padding: 10px 0;
            position: relative;
        }

        .flash-sale-product {
            background: white;
            border-radius: 12px;
            padding: 15px;
            min-width: 200px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            transition: transform 0.3s ease;
        }

        .flash-sale-product:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .product-badges {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .mall-badge {
            background: #ff4444;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
        }

        .discount-badge {
            background: #ffd700;
            color: #333;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
        }

        .product-image {
            text-align: center;
            margin-bottom: 10px;
        }

        .product-image img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
        }

        .super-brand-badge {
            background: #ff4444;
            color: white;
            text-align: center;
            padding: 6px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .product-price {
            color: #ff6b35;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
        }

        .sales-status {
            text-align: center;
        }

        .status-bar {
            background: #f0f0f0;
            height: 6px;
            border-radius: 3px;
            margin-bottom: 5px;
            overflow: hidden;
        }

        .status-fill {
            background: #ff6b35;
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        .status-text {
            font-size: 10px;
            color: #ff6b35;
            font-weight: bold;
        }

        .flash-sale-nav-btn {
            background: #f5f5f5;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: absolute;
            right: -20px;
            top: 50%;
            transform: translateY(-50%);
        }

        .flash-sale-nav-btn:hover {
            background: #e0e0e0;
            transform: translateY(-50%) scale(1.1);
        }

        /* Free Shipping Popup */
        .free-shipping-popup {
            position: fixed;
            right: 20px;
            bottom: 20px;
            transform: none;
            background: #ff6b35;
            color: white;
            padding: 8px;
            border-radius: 50%;
            box-shadow: 0 8px 25px rgba(255, 107, 53, 0.3);
            z-index: 1000;
            width: 84px;
            height: 84px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        /* Disable any animations on popup text */
        .free-shipping-popup, .free-shipping-popup * {
            animation: none !important;
            transition: none !important;
            transform: none !important;
            opacity: 1 !important;
        }

        .popup-close {
            position: absolute;
            top: 4px;
            right: 4px;
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 14px;
            height: 14px;
            cursor: pointer;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .popup-close:hover {
            background: #cc3333;
        }

        .popup-text {
            font-size: 11px;
            font-weight: bold;
            margin-bottom: 0;
            line-height: 1.1;
            text-align: center;
        }

        .popup-subtext {
            font-size: 9px;
            opacity: 0.9;
            line-height: 1.1;
        }

        /* Make popup content clickable as a full circle link */
        .popup-link {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            width: 100%;
            height: 100%;
            color: inherit;
            text-decoration: none;
            cursor: pointer;
        }
        .popup-link:visited {
            color: inherit;
        }

        /* Ensure inner content fills circle and is centered */
        .popup-content {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            text-align: center;
        }

        /* Language gate styles (blue theme) */
        .lang-gate-btn {
            border: 2px solid #2563eb !important;
            color: #2563eb !important;
            background: #ffffff !important;
            transition: all 0.2s ease;
        }
        .lang-gate-btn:hover {
            background: #2563eb !important;
            color: #ffffff !important;
        }



        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 30px auto;
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 30px;
        }

        /* Sidebar */
        .sidebar {
            background: white;
            border-radius: 8px;
            padding: 24px;
            height: fit-content;
            box-shadow: 0 1px 2px rgba(0,0,0,0.06);
            border: 1px solid #e5e7eb;
        }

        .sidebar h3 {
            color: #111827;
            margin-bottom: 16px;
            font-size: 16px;
            text-align: left;
            padding-bottom: 8px;
            border-bottom: 1px solid #e5e7eb;
            font-weight: 600;
        }

        .category-item {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            color: #374151;
            text-decoration: none;
            transition: background-color 0.2s ease, color 0.2s ease;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .category-item:hover {
            color: #111827;
            background: #f3f4f6;
        }

        .category-item i {
            margin-right: 12px;
            width: 20px;
            color: #667eea;
        }

        /* Product Grid */
        .products-section {
            background: white;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.06);
            border: 1px solid #e5e7eb;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .section-title {
            color: #667eea;
            font-size: 24px;
            font-weight: 600;
        }

        .view-all {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .view-all:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 25px;
        }

        .product-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 18px;
            text-align: center;
            transition: background-color 0.2s ease, border-color 0.2s ease;
            cursor: pointer;
            box-shadow: 0 1px 2px rgba(0,0,0,0.06);
            position: relative;
            overflow: hidden;
        }

        .product-card::before {
            content: none;
        }

        .product-card:hover {
            background: #fafafa;
            border-color: #e5e7eb;
        }

        .product-image {
            width: 100%;
            height: 160px;
            background: linear-gradient(45deg, #e3f2fd, #bbdefb);
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #667eea;
            font-size: 50px;
            position: relative;
            transition: all 0.3s ease;
        }

        

        .product-title {
            font-size: 15px;
            color: #333;
            margin-bottom: 12px;
            line-height: 1.4;
            font-weight: 500;
        }

        .product-price {
            color: #ff6b6b;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 12px;
        }

        .product-rating {
            color: #ffd700;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .rating-text {
            font-size: 12px;
            margin-left: 5px;
            color: #666;
        }

        .review-count {
            font-size: 11px;
            margin-left: 5px;
            color: #999;
        }

        .add-to-cart {
            background: #2563eb;
            color: white;
            border: none;
            padding: 10px 14px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            width: 100%;
            font-weight: 600;
            box-shadow: none;
        }

        .add-to-cart:hover {
            background: #1d4ed8;
        }

        .wishlist-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #ffffff;
            border: 1px solid #e5e7eb;
            color: #ef4444;
            font-size: 16px;
            cursor: pointer;
            padding: 6px;
            border-radius: 6px;
            z-index: 1;
            transition: background-color 0.2s ease, color 0.2s ease;
            box-shadow: none;
        }

        .wishlist-btn:hover {
            color: #1e40af;
            background: #eff6ff;
        }

        /* Footer */
        .footer {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 50px 0 30px;
            margin-top: 50px;
            position: relative;
        }

        .footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ff6b6b, #ffa500, #ffd700, #ff6b6b);
            background-size: 200% 100%;
            animation: gradient 3s ease infinite;
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            padding: 0 20px;
        }

        .footer-section h3 {
            margin-bottom: 16px;
            color: #f9fafb;
            font-size: 16px;
            position: relative;
            font-weight: 600;
        }

        .footer-section h3::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 32px;
            height: 2px;
            background: rgba(255,255,255,0.2);
            border-radius: 1px;
        }

        .footer-section a {
            color: #d1d5db;
            text-decoration: none;
            display: block;
            margin-bottom: 10px;
            transition: color 0.2s ease;
            padding: 5px 0;
        }

        .footer-section a:hover {
            color: #f3f4f6;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            padding: 20px;
            box-sizing: border-box;
        }

        .modal-content {
            background: white;
            margin: 6% auto;
            padding: 24px;
            border: 1px solid #e5e7eb;
            width: 90%;
            max-width: 480px;
            border-radius: 8px;
            position: relative;
            box-shadow: 0 10px 24px rgba(0,0,0,0.12);
            animation: modalSlideIn 0.2s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e5e7eb;
        }

        .modal-header h2 {
            color: #111827;
            margin: 0;
            font-size: 20px;
        }

        .close {
            color: #6b7280;
            float: right;
            font-size: 22px;
            font-weight: 500;
            position: absolute;
            top: 14px;
            right: 16px;
            cursor: pointer;
            transition: color 0.2s ease;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
        }

        .close:hover,
        .close:focus {
            color: #111827;
            background: #f3f4f6;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            box-sizing: border-box;
            font-size: 14px;
            transition: all 0.3s ease;
            background: #fafafa;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn-primary {
            background: #2563eb;
            color: white;
            padding: 12px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            font-size: 15px;
            font-weight: 600;
            transition: background-color 0.2s ease;
            box-shadow: none;
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        .modal-footer {
            text-align: center;
            margin-top: 25px;
            color: #666;
            padding-top: 20px;
            border-top: 1px solid #f0f0f0;
        }

        .modal-footer a {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .modal-footer a:hover {
            color: #5a6fd8;
            text-decoration: underline;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .categories-row {
                grid-template-columns: repeat(5, 1fr);
                grid-template-rows: repeat(4, 1fr);
                gap: 15px;
            }
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
                margin: 20px auto;
            }
            
            .header-main {
                flex-direction: column;
                gap: 20px;
                padding: 20px 0;
            }
            
            .search-container {
                margin: 0;
                margin-top: 15px;
                max-width: 100%;
                order: 2;
                width: 100%;
            }
            
            .logo {
                order: 1;
                margin-right: 0;
                margin-bottom: 10px;
            }
            
            .header-actions {
                order: 3;
                gap: 15px;
            }
            

            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
                gap: 20px;
            }

            .product-card {
                padding: 15px;
            }

            .product-image {
                height: 120px;
                font-size: 35px;
            }

            /* New banner responsive styles */
            .main-banner {
                grid-template-columns: 1fr;
                height: auto;
                gap: 15px;
            }
            
            .left-carousel {
                height: 160px;
            }
            
            .right-picture-ads {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .picture-ad {
                height: 75px;
            }
            
            .picture-ad img {
                height: 100%;
            }
            
            .quick-categories {
                grid-template-columns: repeat(4, 1fr);
                gap: 15px;
                padding: 0 15px;
            }
            
            .icon-circle {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
            
            .category-icon span {
                font-size: 11px;
            }
            
            .mid-promo-banner {
                margin: 30px 15px;
                padding: 20px;
            }
            
            .promo-content {
                grid-template-columns: 1fr;
                gap: 20px;
                text-align: center;
            }
            
            .search-suggestions {
                justify-content: center;
                gap: 10px;
                margin-top: 5px;
            }
            
            .search-suggestions span {
                font-size: 11px;
            }

            .modal-content {
                margin: 10% auto;
                padding: 20px;
                width: 95%;
            }

            /* Responsive styles for new sections */
            .categories-row {
                grid-template-columns: repeat(3, 1fr);
                grid-template-rows: repeat(7, 1fr);
                gap: 12px;
            }
            
            .category-icon-grid {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
            
            .category-item-grid span {
                font-size: 11px;
            }
            
            .flash-sale-products {
                gap: 15px;
            }
            
            .flash-sale-product {
                min-width: 180px;
                padding: 12px;
            }
            
            .flash-sale-title h2 {
                font-size: 24px;
            }
            
            .countdown-timer {
                font-size: 16px;
                padding: 6px 12px;
            }
            
            .free-shipping-popup {
                right: 10px;
                width: 72px;
                height: 72px;
                padding: 6px;
            }

            .sidebar {
                margin: 0 20px;
            }

            .products-section {
                margin: 0 20px;
                padding: 20px;
            }
        }

        @media (max-width: 768px) {
            .header-top-content {
                flex-direction: column;
                gap: 10px;
            }

            .header-top-left,
            .header-top-right {
                gap: 10px;
                flex-wrap: wrap;
                justify-content: center;
            }

            .header-top-left a,
            .header-top-right a {
                font-size: 11px;
            }

            .header-top-right .language-selector select {
                font-size: 11px;
                padding: 3px 6px;
            }
        }
            .products-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .banner {
                padding: 25px 15px;
            }

            .banner h2 {
                font-size: 20px;
            }

            .banner-btn {
                padding: 12px 25px;
                font-size: 14px;
            }

            .modal-content {
                padding: 15px;
            }

            .form-group input {
                padding: 12px;
            }

            .btn-primary {
                padding: 12px 20px;
                font-size: 14px;
            }
        
        /* Phone validation styles */
        #registerPhone:invalid,
        #registerPhone[style*="border-color: #ff6b6b"] {
            border-color: #ff6b6b !important;
            box-shadow: 0 0 0 2px rgba(255, 107, 107, 0.2);
        }
        
        #registerPhone:valid,
        #registerPhone[style*="border-color: #28a745"] {
            border-color: #28a745 !important;
            box-shadow: 0 0 0 2px rgba(40, 167, 69, 0.2);
        }
        
        #registerCountryCode {
            transition: all 0.3s ease;
        }
        
        #registerCountryCode:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }
        
        #registerPhone {
            transition: all 0.3s ease;
        }
        
        #registerPhone:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }
        
        /* Language selector styles */
        .language-selector {
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .current-language {
            font-size: 16px;
            color: white;
            opacity: 0.8;
        }
        
        .language-selector select {
            background: transparent;
            color: white;
            border: none;
            border-radius: 0;
            padding: 6px 12px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .language-selector select:hover {
            background: transparent;
        }
        
        .language-selector select:focus {
            outline: none;
            background: transparent;
        }
        
        .language-selector option {
            background: #1d4ed8;
            color: white;
        }
        
        .language-toggle-btn {
            background: linear-gradient(135deg, #1e3a8a, #3b82f6);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            margin-left: 10px;
            min-width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .language-toggle-btn:hover {
            background: linear-gradient(135deg, #1e40af, #2563eb);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        
        /* Language change animations */
        .language-change-animation {
            animation: languageFade 0.5s ease-in-out;
        }
        
        @keyframes languageFade {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(0.98); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        /* Guest notification animations */
        @keyframes slideOutRight {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(100%);
            }
        }
        
        .language-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #1e3a8a, #3b82f6);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
            z-index: 3000;
            transform: translateX(100%);
            animation: slideInRight 0.5s ease-out forwards;
        }
        
        @keyframes slideInRight {
            to { transform: translateX(0); }
        }
        
        /* Smooth formatting transitions */
        .price, .product-price, .date, .product-date, .number, .quantity, .phone {
            transition: all 0.3s ease-in-out;
        }
        
        .formatting-change {
            animation: formatPulse 0.5s ease-in-out;
        }
        
        @keyframes formatPulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.02); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        /* Formatting demo styles */
        .formatting-demo {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border: 2px solid #3b82f6;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 3000;
            min-width: 300px;
            text-align: center;
        }
        
        .formatting-demo h3 {
            margin: 0 0 20px 0;
            color: #1e3a8a;
            font-size: 18px;
        }
        
        .demo-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 15px 0;
            padding: 10px;
            background: #f8fafc;
            border-radius: 8px;
        }
        
        .demo-label {
            font-weight: bold;
            color: #374151;
        }
        
        .demo-value {
            font-family: monospace;
            font-size: 16px;
            color: #059669;
        }
        
        .close-demo {
            margin-top: 20px;
            padding: 10px 20px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .close-demo:hover {
            background: #1e3a8a;
        }
    </style>
</head>
<body>
    <!-- Language Selection Overlay -->
    <div id="languageGate" style="display:none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(2px); z-index: 5000; align-items: center; justify-content: center; padding: 20px;">
        <div style="max-width: 480px; width: 92%; margin: 0 auto; text-align: center; background: #ffffff; border: 1px solid #dbeafe; border-radius: 0; padding: 24px; box-shadow: 0 20px 50px rgba(37, 99, 235, 0.25);">
            <div class="logo" style="font-size: 40px; margin-bottom: 12px; color: #ffd700;">Eddy World</div>
            <h2 id="langGateTitle" style="margin: 0 0 24px 0; font-size: 24px; color: #1e3a8a;" data-translate="select_language">Select Language</h2>
            <div style="display: flex; flex-direction: column; gap: 16px;">
                <button class="lang-gate-btn" data-lang="th" style="padding: 14px; border: 2px solid #2563eb; border-radius: 0; background: #fff; color: #2563eb; font-size: 18px; cursor: pointer;">ไทย</button>
                <button class="lang-gate-btn" data-lang="en" style="padding: 14px; border: 2px solid #2563eb; border-radius: 0; background: #fff; color: #2563eb; font-size: 18px; cursor: pointer;">English</button>
                <button class="lang-gate-btn" data-lang="zh" style="padding: 14px; border: 2px solid #2563eb; border-radius: 0; background: #fff; color: #2563eb; font-size: 18px; cursor: pointer;">中文</button>
            </div>
            
        </div>
    </div>
    <!-- Header -->
    <div class="header">
        <div class="header-top">
            <div class="header-top-content">
                <div class="header-top-left">
                    <a href="#">Seller Centre</a>
                    <a href="#">Start Selling</a>
                    <a href="#">Download</a>
                    <span style="color: #e5e7eb; margin: 0 8px;">|</span>
                    <span style="color: #e5e7eb;">Follow us on</span>
                    <a href="#" aria-label="Instagram" title="Instagram"><i class="fab fa-instagram"></i></a>
                    <a href="#" aria-label="Facebook" title="Facebook"><i class="fab fa-facebook"></i></a>
                    <a href="#" aria-label="LINE" title="LINE"><i class="fab fa-line"></i></a>
                </div>
                <div class="header-top-right">
                    <a href="#" onclick="showNotifications()"><i class="fas fa-bell"></i> Notification</a>
                    <a href="#" onclick="alert('Help center coming soon')"><i class="fas fa-question-circle"></i> Help</a>
                    <div class="language-selector" style="display: inline-block; margin-left: 8px;">
            <select id="languageSelect" onchange="changeLanguage(this.value)">
                <option value="en">English</option>
                <option value="th">ไทย</option>
                <option value="zh">中文</option>
            </select>
        </div>
                    <div id="guest-actions" style="display: inline-block; margin-left: 8px;">
                        <a href="#" onclick="return openLoginSession()" style="font-weight: 500; font-size: 14px;">Sign Up</a>
                        <span style="color: #e5e7eb; margin: 0 6px;">|</span>
                        <a href="#" onclick="return openLoginSession()" style="font-weight: 500; font-size: 14px;">Log In</a>
                    </div>
                    <div id="user-actions" style="display: none; margin-left: 8px;">
                        <span id="user-greeting">Welcome!</span>
                        <a href="#" onclick="showWishlist()"><i class="fas fa-heart"></i> Wishlist</a>
                        <a href="#" onclick="logout()">Logout</a>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="header-main">
            <div class="logo">Eddy World</div>
            <div class="search-container">
                <div class="search-box">
                    <input type="text" class="search-input" placeholder="ลูกค้าใหม่ รับเลย โค้ดส่วนลด หรือโค้ดส่งฟรี*">
                    <button class="search-btn"><i class="fas fa-search"></i></button>
                </div>
                <div class="search-suggestions">
                    <span data-translate="sugg_iphone_1_thb">โทรศัพท์ราคา 1 บาทไอโฟน</span>
                    <span data-translate="sugg_bluetooth_speaker">เครื่องเสียง บลูทูธ</span>
                    <span data-translate="sugg_long_sleeve_mc">เสื้อแขนยาวแม็กของแท้mc</span>
                    <span data-translate="sugg_sneakers">รองเท้าผ้าใบ</span>
                    <span data-translate="sugg_brand_bag">กระเป๋าแบรนด์เนม</span>
                </div>
            </div>
            <div class="header-actions">
                <div class="wishlist-icon" onclick="showWishlist()" title="Wishlist" style="display: none;">
                    <i class="fas fa-heart"></i>
                    <span class="wishlist-count">0</span>
                </div>
                <div class="cart-icon" onclick="showCartModal()">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count">0</span>
                </div>
                <div class="user-icon" onclick="showUserProfile()" style="display: none;">
                    <i class="fas fa-user"></i>
                </div>
                <div class="notification-icon" onclick="showNotifications()" title="Notifications" style="display: none;">
                    <i class="fas fa-bell"></i>
                </div>
                <div class="admin-icon" onclick="displayAnalytics()" title="Analytics Dashboard" style="display: none;">
                    <i class="fas fa-chart-bar"></i>
                </div>
            </div>
        </div>
    </div>



    <!-- Main Promotional Banner/Hero Section -->
    <div class="banner-section">
        <div class="main-banner">
            <!-- Left Side - Image Carousel/Slider -->
            <div class="left-carousel">
                <div class="carousel-container">
                    <div class="carousel-slide active" data-slide="1">
                        <img src="https://via.placeholder.com/500x300/ff6b35/ffffff?text=Ad+1+New+Customer" alt="Ad 1">
                        <div class="slide-overlay">
                            <h2>ลูกค้าใหม่ ราคาพิเศษ $1.-</h2>
                            <p>New customers get special prices from $1</p>
                            <button class="banner-btn">Shop Now</button>
        </div>
    </div>

                    <div class="carousel-slide" data-slide="2">
                        <img src="https://via.placeholder.com/500x300/667eea/ffffff?text=Ad+2+Free+Shipping" alt="Ad 2">
                        <div class="slide-overlay">
                            <h2>ส่งฟรี ขั้นต่ำ 0 บาท</h2>
                            <p>Free Shipping, Minimum $0</p>
                            <button class="banner-btn">Learn More</button>
                        </div>
                    </div>
                    
                    <div class="carousel-slide" data-slide="3">
                        <img src="https://via.placeholder.com/500x300/4ecdc4/ffffff?text=Ad+3+Discount+50" alt="Ad 3">
                        <div class="slide-overlay">
                            <h2>โค้ดส่วนลด 50%</h2>
                            <p>Discount Code 50% Off</p>
                            <button class="banner-btn">Get Code</button>
                        </div>
                    </div>
                    
                    <div class="carousel-slide" data-slide="4">
                        <img src="https://via.placeholder.com/500x300/ff6b6b/ffffff?text=Ad+4+Hot+Sale" alt="Ad 4">
                        <div class="slide-overlay">
                            <h2>Hot Sale! 🔥</h2>
                            <p>Limited time offers</p>
                            <button class="banner-btn">Shop Now</button>
                        </div>
                    </div>
                    
                    <div class="carousel-slide" data-slide="5">
                        <img src="https://via.placeholder.com/500x300/9b59b6/ffffff?text=Ad+5+New+Arrivals" alt="Ad 5">
                        <div class="slide-overlay">
                            <h2>New Arrivals ✨</h2>
                            <p>Check out latest products</p>
                            <button class="banner-btn">Explore</button>
                        </div>
                    </div>
                </div>
                
                <!-- Carousel Navigation -->
                <button class="carousel-btn prev-btn">‹</button>
                <button class="carousel-btn next-btn">›</button>
                
                <!-- Carousel Dots -->
                <div class="carousel-dots">
                    <span class="dot active" data-slide="1"></span>
                    <span class="dot" data-slide="2"></span>
                    <span class="dot" data-slide="3"></span>
                    <span class="dot" data-slide="4"></span>
                    <span class="dot" data-slide="5"></span>
                </div>
            </div>
            
            <!-- Right Side - Two Picture Ads -->
            <div class="right-picture-ads">
                <div class="picture-ad home-ad">
                    <img src="https://via.placeholder.com/300x150/4ecdc4/ffffff" alt="Ad 1">
                </div>
                
                <div class="picture-ad payment-ad">
                    <img src="https://via.placeholder.com/300x150/667eea/ffffff" alt="Ad 2">
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Access Category Icons -->
    <div class="quick-categories">
        <div class="category-icon">
            <div class="icon-circle blue">🔌</div>
            <span>Electronics</span>
        </div>
        <div class="category-icon">
            <div class="icon-circle green">🛒</div>
            <span>Supermarket</span>
        </div>
        <div class="category-icon">
            <div class="icon-circle green">🏠</div>
            <span>Eddy Home</span>
        </div>
        <div class="category-icon">
            <div class="icon-circle orange">👍</div>
            <span>Best Deals</span>
        </div>
        <div class="category-icon">
            <div class="icon-circle red">✅</div>
            <span>Eddy Choice</span>
        </div>
        <div class="category-icon">
            <div class="icon-circle red">🛍️</div>
            <span>Eddy Mall</span>
        </div>
        <div class="category-icon">
            <div class="icon-circle orange">🔥</div>
            <span>Trending</span>
        </div>
        <div class="category-icon">
            <div class="icon-circle green">🚚</div>
            <span>Free Shipping</span>
        </div>
    </div>
    
    <!-- Mid-Page Promotional Banner -->
    <div class="mid-promo-banner">
        <div class="promo-content">
            <img src="https://via.placeholder.com/800x120/ff6b35/ffffff?text=Special+Promo+Banner" alt="Special Promo Banner">
        </div>
    </div>

    <!-- Categories Section -->
    <div class="categories-section">
        <div class="categories-header">
            <h2>CATEGORIES</h2>
            <button class="categories-nav-btn next-btn" onclick="toggleCategoriesView()" title="Show More Categories">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
        <div class="categories-grid">
            <div class="categories-row">
                <div class="category-item-grid" data-category-id="1">
                    <div class="category-icon-grid blue">
                        <i class="fas fa-spa"></i>
                    </div>
                    <span>Beauty & Personal Care</span>
                </div>
            <div class="category-item-grid" data-category-id="2">
                <div class="category-icon-grid green">
                    <i class="fas fa-tshirt"></i>
                </div>
                <span>Men Clothes</span>
            </div>
            <div class="category-item-grid" data-category-id="3">
                <div class="category-icon-grid orange">
                    <i class="fas fa-shopping-bag"></i>
                </div>
                <span>Bags</span>
            </div>
            <div class="category-item-grid" data-category-id="4">
                <div class="category-icon-grid red">
                    <i class="fas fa-female"></i>
                </div>
                <span>Women Shoes</span>
            </div>
            <div class="category-item-grid" data-category-id="5">
                <div class="category-icon-grid blue">
                    <i class="fas fa-clock"></i>
                </div>
                <span>Watches & Glasses</span>
            </div>
            <div class="category-item-grid" data-category-id="6">
                <div class="category-icon-grid green">
                    <i class="fas fa-headphones"></i>
                </div>
                <span>Electronics Accessories</span>
            </div>
            <div class="category-item-grid" data-category-id="7">
                <div class="category-icon-grid blue">
                    <i class="fas fa-tv"></i>
                </div>
                <span>Home Appliances</span>
            </div>
            <div class="category-item-grid" data-category-id="8">
                <div class="category-icon-grid orange">
                    <i class="fas fa-camera"></i>
                </div>
                <span>Cameras</span>
            </div>
            <div class="category-item-grid" data-category-id="9">
                <div class="category-icon-grid red">
                    <i class="fas fa-baby"></i>
                </div>
                <span>Baby & Toys</span>
            </div>
            <div class="category-item-grid" data-category-id="10">
                <div class="category-icon-grid blue">
                    <i class="fas fa-paw"></i>
                </div>
                <span>Pets</span>
            </div>
            <div class="category-item-grid" data-category-id="11">
                <div class="category-icon-grid green">
                    <i class="fas fa-mask"></i>
                </div>
                <span>Health & Wellness</span>
            </div>
            <div class="category-item-grid" data-category-id="12">
                <div class="category-icon-grid orange">
                    <i class="fas fa-female"></i>
                </div>
                <span>Women Clothes</span>
            </div>
            <div class="category-item-grid" data-category-id="13">
                <div class="category-icon-grid red">
                    <i class="fas fa-shoe-prints"></i>
                </div>
                <span>Men Shoes</span>
            </div>
            <div class="category-item-grid" data-category-id="14">
                <div class="category-icon-grid blue">
                    <i class="fas fa-gem"></i>
                </div>
                <span>Fashion Accessories</span>
            </div>
            <div class="category-item-grid" data-category-id="15">
                <div class="category-icon-grid green">
                    <i class="fas fa-home"></i>
                </div>
                <span>Home & Living</span>
            </div>
            <div class="category-item-grid" data-category-id="16">
                <div class="category-icon-grid orange">
                    <i class="fas fa-mobile-alt"></i>
                </div>
                <span>Mobile & Tablets</span>
            </div>
            <div class="category-item-grid" data-category-id="17">
                <div class="category-icon-grid blue">
                    <i class="fas fa-laptop"></i>
                </div>
                <span>Computers & Laptops</span>
            </div>
            <div class="category-item-grid" data-category-id="18">
                <div class="category-icon-grid green">
                    <i class="fas fa-utensils"></i>
                </div>
                <span>Food & Beverages</span>
            </div>
            <div class="category-item-grid" data-category-id="19">
                <div class="category-icon-grid red">
                    <i class="fas fa-bicycle"></i>
                </div>
                <span>Sports & Outdoors</span>
            </div>
            <div class="category-item-grid" data-category-id="20">
                <div class="category-icon-grid blue">
                    <i class="fas fa-gamepad"></i>
                </div>
                <span>Gaming & Accessories</span>
            </div>
            </div>
            
            <div class="categories-row">
                <div class="category-item-grid" data-category-id="21">
                    <div class="category-icon-grid orange">
                        <i class="fas fa-car"></i>
                    </div>
                    <span>Automotive</span>
                </div>
                <div class="category-item-grid" data-category-id="22">
                    <div class="category-icon-grid green">
                        <i class="fas fa-book"></i>
                    </div>
                    <span>Books & Media</span>
                </div>
                <div class="category-item-grid" data-category-id="23">
                    <div class="category-icon-grid blue">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <span>Education</span>
                </div>
                <div class="category-item-grid" data-category-id="24">
                    <div class="category-icon-grid red">
                        <i class="fas fa-palette"></i>
                    </div>
                    <span>Arts & Crafts</span>
                </div>
                <div class="category-item-grid" data-category-id="25">
                    <div class="category-icon-grid orange">
                        <i class="fas fa-tools"></i>
                    </div>
                    <span>Tools & Hardware</span>
                </div>
                <div class="category-item-grid" data-category-id="26">
                    <div class="category-icon-grid green">
                        <i class="fas fa-seedling"></i>
                    </div>
                    <span>Garden & Outdoor</span>
                </div>
                <div class="category-item-grid" data-category-id="27">
                    <div class="category-icon-grid blue">
                        <i class="fas fa-music"></i>
                    </div>
                    <span>Musical Instruments</span>
                </div>
                <div class="category-item-grid" data-category-id="28">
                    <div class="category-icon-grid orange">
                        <i class="fas fa-plane"></i>
                    </div>
                    <span>Travel & Luggage</span>
                </div>
                <div class="category-item-grid" data-category-id="29">
                    <div class="category-icon-grid red">
                        <i class="fas fa-gift"></i>
                    </div>
                    <span>Gifts & Occasions</span>
                </div>
                <div class="category-item-grid" data-category-id="30">
                    <div class="category-icon-grid blue">
                        <i class="fas fa-star"></i>
                    </div>
                    <span>Featured</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Flash Sale Section -->
    <div class="flash-sale-section">
        <div class="flash-sale-header">
            <div class="flash-sale-title">
                <h2>FLASH SALE</h2>
                <div class="countdown-timer">
                    <span id="hours">00</span>
                    <span id="minutes">37</span>
                    <span id="seconds">22</span>
                </div>
            </div>
            <a href="#" class="see-all-link">See All ></a>
        </div>
        <div class="flash-sale-products">
            <div class="flash-sale-product">
                <div class="product-badges">
                    <span class="mall-badge">Mall</span>
                    <span class="discount-badge">19% OFF</span>
                </div>
                <div class="product-image">
                    <img src="https://via.placeholder.com/120x120/ff6b35/ffffff?text=Hi-Q+Milk" alt="Hi-Q Milk">
                </div>
                <div class="super-brand-badge">Super Brand Day</div>
                <div class="product-price">฿1,897</div>
                <div class="sales-status">
                    <div class="status-bar">
                        <div class="status-fill" style="width: 75%"></div>
                    </div>
                    <span class="status-text">SELLING FAST</span>
                </div>
            </div>
            <div class="flash-sale-product">
                <div class="product-badges">
                    <span class="mall-badge">Mall</span>
                    <span class="discount-badge">20% OFF</span>
                </div>
                <div class="product-image">
                    <img src="https://via.placeholder.com/120x120/ff6b35/ffffff?text=Hi-Q+Milk" alt="Hi-Q Milk">
                </div>
                <div class="super-brand-badge">Super Brand Day</div>
                <div class="product-price">฿2,503</div>
                <div class="sales-status">
                    <div class="status-bar">
                        <div class="status-fill" style="width: 60%"></div>
                    </div>
                    <span class="status-text">41 SOLD</span>
                </div>
            </div>
            <div class="flash-sale-product">
                <div class="product-badges">
                    <span class="mall-badge">Mall</span>
                    <span class="discount-badge">15% OFF</span>
                </div>
                <div class="product-image">
                    <img src="https://via.placeholder.com/120x120/ff6b35/ffffff?text=Hi-Q+Milk" alt="Hi-Q Milk">
                </div>
                <div class="super-brand-badge">Super Brand Day</div>
                <div class="product-price">฿1,650</div>
                <div class="sales-status">
                    <div class="status-bar">
                        <div class="status-fill" style="width: 90%"></div>
                    </div>
                    <span class="status-text">SELLING FAST</span>
                </div>
            </div>
            <div class="flash-sale-product">
                <div class="product-badges">
                    <span class="mall-badge">Mall</span>
                    <span class="discount-badge">25% OFF</span>
                </div>
                <div class="product-image">
                    <img src="https://via.placeholder.com/120x120/ff6b35/ffffff?text=Hi-Q+Milk" alt="Hi-Q Milk">
                </div>
                <div class="super-brand-badge">Super Brand Day</div>
                <div class="product-price">฿2,100</div>
                <div class="sales-status">
                    <div class="status-bar">
                        <div class="status-fill" style="width: 45%"></div>
                    </div>
                    <span class="status-text">23 SOLD</span>
                </div>
            </div>
            <button class="flash-sale-nav-btn next-btn">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>

    <!-- Free Shipping Popup Ad -->
    <div id="freeShippingPopup" class="free-shipping-popup">
        <a href="?page=free-shipping" class="popup-link">
            <div class="popup-content">
                <button class="popup-close" onclick="event.stopPropagation(); event.preventDefault(); closeFreeShippingPopup()">×</button>
                <div class="popup-text" data-translate="free_shipping_popup_title">Get Free Shipping</div>
            </div>
        </a>
    </div>
    <!-- Main Content -->
    <div class="main-content">
        <!-- Products Section -->
        <div class="products-section">
            <div class="section-header">
                <h2 class="section-title">Featured Products</h2>
                <a href="#" class="view-all">View All</a>
            </div>
            
            <div class="products-grid">
                <div class="product-card" onclick="showProductDetails(1)">
                    <div class="product-image">
                        <i class="fas fa-mobile-alt"></i>
                        <button class="wishlist-btn" onclick="toggleWishlist(1, event)" title="Add to Wishlist">
                            <i class="fas fa-heart"></i>
                        </button>
                    </div>
                    <h3 class="product-title">Smartphone Pro Max 2024</h3>
                    <div class="product-price">฿15,999</div>
                    <div class="product-rating">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <span class="rating-text">(4.8)</span>
                        <span class="review-count">(127 reviews)</span>
                    </div>
                    <button class="add-to-cart" onclick="addToCart(1, 'Smartphone Pro Max 2024', 15999)">Add to Cart</button>
                </div>

                <div class="product-card" onclick="showProductDetails(2)">
                    <div class="product-image">
                        <i class="fas fa-laptop"></i>
                        <button class="wishlist-btn" onclick="toggleWishlist(2, event)" title="Add to Wishlist">
                            <i class="fas fa-heart"></i>
                        </button>
                    </div>
                    <h3 class="product-title">Gaming Laptop Ultra</h3>
                    <div class="product-price">฿45,999</div>
                    <div class="product-rating">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star-half-alt"></i>
                        <span class="rating-text">(4.6)</span>
                        <span class="review-count">(89 reviews)</span>
                    </div>
                    <button class="add-to-cart" onclick="addToCart(2, 'Gaming Laptop Ultra', 45999)">Add to Cart</button>
                </div>

                <div class="product-card" onclick="showProductDetails(3)">
                    <div class="product-image">
                        <i class="fas fa-headphones"></i>
                        <button class="wishlist-btn" onclick="toggleWishlist(3, event)" title="Add to Wishlist">
                            <i class="fas fa-heart"></i>
                        </button>
                    </div>
                    <h3 class="product-title">Wireless Headphones Pro</h3>
                    <div class="product-price">฿2,999</div>
                    <div class="product-rating">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <span class="rating-text">(4.9)</span>
                        <span class="review-count">(203 reviews)</span>
                    </div>
                    <button class="add-to-cart" onclick="addToCart(3, 'Wireless Headphones Pro', 2999)">Add to Cart</button>
                </div>

                <div class="product-card" onclick="showProductDetails(4)">
                    <div class="product-image">
                        <i class="fas fa-camera"></i>
                        <button class="wishlist-btn" onclick="toggleWishlist(4, event)" title="Add to Wishlist">
                            <i class="fas fa-heart"></i>
                        </button>
                    </div>
                    <h3 class="product-title">4K Action Camera</h3>
                    <div class="product-price">฿8,999</div>
                    <div class="product-rating">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <span class="rating-text">(4.7)</span>
                        <span class="review-count">(156 reviews)</span>
                    </div>
                    <button class="add-to-cart" onclick="addToCart(4, '4K Action Camera', 8999)">Add to Cart</button>
                </div>

                <div class="product-card" onclick="showProductDetails(5)">
                    <div class="product-image">
                        <i class="fas fa-tablet-alt"></i>
                        <button class="wishlist-btn" onclick="toggleWishlist(5, event)" title="Add to Wishlist">
                            <i class="fas fa-heart"></i>
                        </button>
                    </div>
                    <h3 class="product-title">iPad Air 2024</h3>
                    <div class="product-price">฿25,999</div>
                    <div class="product-rating">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <span class="rating-text">(4.8)</span>
                        <span class="review-count">(94 reviews)</span>
                    </div>
                    <button class="add-to-cart" onclick="addToCart(5, 'iPad Air 2024', 25999)">Add to Cart</button>
                </div>

                <div class="product-card" onclick="showProductDetails(6)">
                    <div class="product-image">
                        <i class="fas fa-watch"></i>
                        <button class="wishlist-btn" onclick="toggleWishlist(6, event)" title="Add to Wishlist">
                            <i class="fas fa-heart"></i>
                        </button>
                    </div>
                    <h3 class="product-title">Smart Watch Series 8</h3>
                    <div class="product-price">฿12,999</div>
                    <div class="product-rating">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star-half-alt"></i>
                        <span class="rating-text">(4.5)</span>
                        <span class="review-count">(78 reviews)</span>
                    </div>
                    <button class="add-to-cart" onclick="addToCart(6, 'Smart Watch Series 8', 12999)">Add to Cart</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer" id="main-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Customer Service</h3>
                <a href="#">Help Center</a>
                <a href="#">Contact Us</a>
                <a href="#">Shipping Info</a>
                <a href="#">Returns</a>
                <a href="#">Size Guide</a>
            </div>
            <div class="footer-section">
                <h3>About Eddy World</h3>
                <a href="#">About Us</a>
                <a href="#">Careers</a>
                <a href="#">Press</a>
                <a href="#">Blog</a>
                <a href="#">Investor Relations</a>
            </div>
            <div class="footer-section">
                <h3>Payment Methods</h3>
                <a href="#">Credit Cards</a>
                <a href="#">Bank Transfer</a>
                <a href="#">Cash on Delivery</a>
                <a href="#">E-Wallet</a>
                <a href="#">Installments</a>
            </div>
            <div class="footer-section">
                <h3>Follow Us</h3>
                <a href="#"><i class="fab fa-facebook"></i> Facebook</a>
                <a href="#"><i class="fab fa-twitter"></i> Twitter</a>
                <a href="#"><i class="fab fa-instagram"></i> Instagram</a>
                <a href="#"><i class="fab fa-youtube"></i> YouTube</a>
                <a href="#"><i class="fab fa-tiktok"></i> TikTok</a>
            </div>
        </div>
    </div>

    <!-- Authentication Modals -->
    <div id="loginModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Login to Eddy World</h2>
                <span class="close" onclick="closeModal('loginModal')">&times;</span>
            </div>
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn-primary">Login</button>
            </form>
            <p class="modal-footer">
                Don't have an account? <a href="#" onclick="hideLanguageGate(); switchModal('loginModal', 'registerModal')">Register here</a>
            </p>
        </div>
    </div>

    <div id="registerModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create Account</h2>
                <span class="close" onclick="closeModal('registerModal')">&times;</span>
            </div>
            <form id="registerForm" onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label for="registerName">Full Name</label>
                    <input type="text" id="registerName" required>
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" required>
                </div>
                <div class="form-group">
                    <label for="registerPhone">Phone Number</label>
                    <div style="display: flex; gap: 10px;">
                        <select id="registerCountryCode" style="flex: 0 0 120px; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; background: #fafafa;" onchange="updatePhoneValidation()">
                            <option value="+66" selected>🇹🇭 +66 (Thailand)</option>
                            <option value="+1">🇺🇸 +1 (USA/Canada)</option>
                            <option value="+44">🇬🇧 +44 (UK)</option>
                            <option value="+81">🇯🇵 +81 (Japan)</option>
                            <option value="+86">🇨🇳 +86 (China)</option>
                            <option value="+91">🇮🇳 +91 (India)</option>
                            <option value="+61">🇦🇺 +61 (Australia)</option>
                            <option value="+49">🇩🇪 +49 (Germany)</option>
                            <option value="+33">🇫🇷 +33 (France)</option>
                            <option value="+39">🇮🇹 +39 (Italy)</option>
                            <option value="+34">🇪🇸 +34 (Spain)</option>
                            <option value="+7">🇷🇺 +7 (Russia)</option>
                            <option value="+82">🇰🇷 +82 (South Korea)</option>
                            <option value="+55">🇧🇷 +55 (Brazil)</option>
                            <option value="+52">🇲🇽 +52 (Mexico)</option>
                            <option value="+971">🇦🇪 +971 (UAE)</option>
                            <option value="+65">🇸🇬 +65 (Singapore)</option>
                            <option value="+60">🇲🇾 +60 (Malaysia)</option>
                            <option value="+84">🇻🇳 +84 (Vietnam)</option>
                            <option value="+62">🇮🇩 +62 (Indonesia)</option>
                            <option value="+63">🇵🇭 +63 (Philippines)</option>
                            <option value="+95">🇲🇲 +95 (Myanmar)</option>
                            <option value="+856">🇱🇦 +856 (Laos)</option>
                            <option value="+855">🇰🇭 +855 (Cambodia)</option>
                            <option value="+66">🇹🇭 +66 (Thailand)</option>
                        </select>
                        <input type="tel" id="registerPhone" placeholder="Enter phone number" required style="flex: 1; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; background: #fafafa;" oninput="validatePhoneNumber(this)" maxlength="15">
                    </div>
                </div>
                <div class="form-group">
                    <label for="registerPassword">Password</label>
                    <input type="password" id="registerPassword" required>
                </div>
                <div class="form-group">
                    <label for="registerConfirmPassword">Confirm Password</label>
                    <input type="password" id="registerConfirmPassword" required>
                </div>
                <button type="submit" class="btn-primary">Create Account</button>
            </form>
            <p class="modal-footer">
                Already have an account? <a href="#" onclick="switchModal('registerModal', 'loginModal')">Login here</a>
            </p>
        </div>
    </div>
    <script>
        // Global variables
        let cart = [];
        let cartTotal = 0;
        let wishlist = [];
        let currentUser = null;
        let users = [];
        let orders = [];
        let orderCounter = 1000;
        let isAdmin = false;
        let notifications = [];
        let inventory = {};
        
        // New marketplace variables
        let shops = []; // Seller shops
        let shopCounter = 100;
        let products = []; // All marketplace products
        let productCounter = 1000;
        let categories = []; // Product categories
        let vouchers = []; // Vouchers and promotions
        let coins = []; // User coins system
        let escrowTransactions = []; // Escrow system
        let returns = []; // Returns and disputes
        let chatThreads = []; // Buyer-seller chat
        let liveSessions = []; // Live shopping
        let flashSales = []; // Flash sale events
        
        let customerData = {
            pageViews: 0,
            productViews: {},
            searchQueries: [],
            cartAbandonments: 0,
            sessionStart: new Date(),
            userBehavior: []
        };
        
        // Language system
        let currentLanguage = 'en';
        
        // Language translations
        const translations = {
            en: {
                // Header
                'welcome': 'Welcome to Eddy World',
                'search_placeholder': 'Search for products...',
                'login': 'Login',
                'register': 'Sign Up',
                'logout': 'Logout',
                'wishlist': 'Wishlist',
                'my_orders': 'My Orders',
                'chat': 'Chat',
                'become_seller': 'Become a Seller',
                'admin_panel': 'Admin Panel',
                'manage_orders': 'Manage Orders',
                'analytics': 'Analytics',
                'need_help': 'Need help?',
                'seller_centre': 'Seller Centre',
                'start_selling': 'Start Selling',
                'download': 'Download',
                'follow_us_on': 'Follow us on',
                'notification': 'Notification',
                'help': 'Help',
                
                // Navigation
                'home': 'Home',
                'categories': 'Categories',
                'flash_sale': 'Flash Sale',
                'live_shopping': 'Live Shopping',
                'vouchers': 'Vouchers',
                'electronics': 'Electronics',
                'supermarket': 'Supermarket',
                'best_deals': 'Best Deals',
                'trending': 'Trending',
                'free_shipping': 'Free Shipping',
                'fashion': 'Fashion',
                'home_living': 'Home & Living',
                'beauty': 'Beauty',
                'sports': 'Sports',
                'books': 'Books',
                'automotive': 'Automotive',
                'mall': 'Mall',
                'super_brand_day': 'Super Brand Day',
                'selling_fast': 'SELLING FAST',
                'sold': 'SOLD',
                'off': 'OFF',
                'shop_now': 'Shop Now',
                'learn_more': 'Learn More',
                'get_code': 'Get Code',
                'explore': 'Explore',
                
                // Free shipping popup
                'free_shipping_popup_title': 'Get Free Shipping',
                'free_shipping_popup_subtext': 'Get Free Shipping Code',

                // Language gate
                'select_language': 'Select Language',
                'select_language_tip': 'You can change language later from the header.',
                
                // Main content
                'featured_products': 'Featured Products',
                'view_all': 'View All',
                'add_to_cart': 'Add to Cart',
                'add_to_wishlist': 'Add to Wishlist',
                'remove_from_wishlist': 'Remove from Wishlist',
                'explore_products': 'Explore Products',
                
                // User actions
                'wishlist': 'Wishlist',
                'logout': 'Logout',
                'my_orders': 'My Orders',
                'chat': 'Chat',
                'become_seller': 'Become a Seller',
                'seller_dashboard': 'Seller Dashboard',
                
                // Modals
                'login_title': 'Log In',
                'email': 'Email',
                'password': 'Password',
                'login_button': 'Login',
                'no_account': "Don't have an account?",
                'register_link': 'Sign up here',
                'register_title': 'Create New Account',
                'phone_number': 'Phone Number',
                'confirm_password': 'Confirm Password',
                'register_button': 'Sign Up',
                'have_account': 'Already have an account?',
                'login_link': 'Log in here',
                'close': 'Close',
                
                // Footer
                'about_eddy': 'About Eddy World',
                'about_us': 'About Us',
                'careers': 'Careers',
                'press': 'Press',
                'blog': 'Blog',
                'investor_relations': 'Investor Relations',
                'customer_service': 'Customer Service',
                'help_center': 'Help Center',
                'contact_us': 'Contact Us',
                'shipping_info': 'Shipping Info',
                'returns': 'Returns',
                'size_guide': 'Size Guide',
                'payment_methods': 'Payment Methods',
                'credit_cards': 'Credit Cards',
                'bank_transfer': 'Bank Transfer',
                'cash_on_delivery': 'Cash on Delivery',
                'e_wallet': 'E-Wallet',
                'installments': 'Installments',
                'follow_us': 'Follow Us',
                // Login footer (new)
                'footer_customer_service': 'Customer Service',
                'footer_about_eddy': 'About Eddy',
                'footer_payment': 'Payment',
                'footer_follow_us': 'Follow Us',
                'footer_app_download': 'App Download',
                'footer_help_centre': 'Help Centre',
                'footer_how_to_buy': 'How To Buy',
                'footer_how_to_sell': 'How To Sell',
                'footer_payment_methods': 'Payment Methods',
                'footer_shipping_delivery': 'Shipping & Delivery',
                'footer_return_refund': 'Return & Refund',
                'footer_shop_guarantee': 'Shop Guarantee',
                'footer_contact_us': 'Contact Us',
                'footer_about_us': 'About Us',
                'footer_affiliate_program': 'Affiliate Program',
                'footer_careers': 'Careers',
                'footer_policies': 'Policies',
                'footer_privacy': 'Privacy',
                'footer_blog': 'Blog',
                'footer_media_contact': 'Media Contact',
                'footer_qr_code': 'QR Code',
                'footer_app_store': 'App Store',
                'footer_google_play': 'Google Play',
                'footer_copyright': '© 2025 Eddy World. All Rights Reserved.',
                
                // Cart
                'shopping_cart': 'Shopping Cart',
                'cart_empty': 'Your cart is empty',
                'total': 'Total',
                'checkout': 'Checkout',
                'remove': 'Remove',
                'quantity': 'Quantity',
                
                // Messages
                'login_success': 'Login successful!',
                'register_success': 'Registration successful!',
                'logout_success': 'Logout successful!',
                'item_added_cart': 'Item added to cart!',
                'item_removed_cart': 'Item removed from cart!',
                'item_added_wishlist': 'Item added to wishlist!',
                'item_removed_wishlist': 'Item removed from wishlist!',
                
                // Admin specific
                'admin_welcome': 'Welcome to Admin Panel',
                'admin_dashboard': 'Admin Dashboard',
                'manage_orders': 'Manage Orders',
                'analytics': 'Analytics',
                'shop_verification': 'Shop Verification',
                'kyc_management': 'KYC Management',
                'escrow_management': 'Escrow Management',
                'voucher_management': 'Voucher Management',
                'order_management': 'Order Management',
                'user_management': 'User Management',
                'inventory_management': 'Inventory Management',
                
                // Language
                'language_changed': 'Language Changed',
                'language_changed_message': 'Language settings have been updated successfully',
                'current_language': 'Current Language',
                
                // Products
                'smartphone': 'Smartphone',
                'laptop': 'Laptop',
                'headphones': 'Headphones',
                'watch': 'Watch',
                'smartphone_pro_max': 'Smartphone Pro Max 2024',
                'gaming_laptop_ultra': 'Gaming Laptop Ultra',
                'wireless_headphones_pro': 'Wireless Headphones Pro',
                'action_camera_4k': '4K Action Camera',
                'ipad_air_2024': 'iPad Air 2024',
                'smart_watch_series_8': 'Smart Watch Series 8',
                'smartphone_description': 'Latest smartphone with advanced features, high-resolution camera, and long battery life.',
                'laptop_description': 'High-performance gaming laptop with RTX graphics and fast refresh rate.',
                'headphones_description': 'Premium wireless headphones with noise cancellation and premium sound quality.',
                'camera_description': 'Professional action camera with 4K recording and waterproof design.',
                'ipad_description': 'Latest iPad with powerful performance and stunning Retina display.',
                'watch_description': 'Advanced smartwatch with health monitoring and fitness tracking.',
                
                // Categories grid
                'beauty_personal_care': 'Beauty & Personal Care',
                'men_clothes': 'Men Clothes',
                'bags': 'Bags',
                'women_shoes': 'Women Shoes',
                'watches_glasses': 'Watches & Glasses',
                'electronics_accessories': 'Electronics Accessories',
                'home_appliances': 'Home Appliances',
                'cameras': 'Cameras',
                'baby_toys': 'Baby & Toys',
                'pets': 'Pets',
                'health_wellness': 'Health & Wellness',
                'women_clothes': 'Women Clothes',
                'men_shoes': 'Men Shoes',
                'fashion_accessories': 'Fashion Accessories',
                'mobile_tablets': 'Mobile & Tablets',
                'computers_laptops': 'Computers & Laptops',
                'food_beverages': 'Food & Beverages',
                'sports_outdoors': 'Sports & Outdoors',
                'gaming_accessories': 'Gaming & Accessories',
                
                // Search suggestions
                'sugg_iphone_1_thb': 'iPhone for 1 THB',
                'sugg_bluetooth_speaker': 'Bluetooth speakers',
                'sugg_long_sleeve_mc': 'Authentic MC long-sleeve',
                'sugg_sneakers': 'Sneakers',
                'sugg_brand_bag': 'Branded bags',
                
                // Formatting demo
                            'price': 'Price',
            'date': 'Date',
            'number': 'Number',
            'phone': 'Phone',
            'close': 'Close'
            },
            th: {
                // Header
                'welcome': 'ยินดีต้อนรับสู่ Eddy World',
                'search_placeholder': 'ค้นหาสินค้า...',
                'login': 'เข้าสู่ระบบ',
                'register': 'สมัครสมาชิก',
                'logout': 'ออกจากระบบ',
                'wishlist': 'รายการโปรด',
                'my_orders': 'คำสั่งซื้อของฉัน',
                'chat': 'แชท',
                'become_seller': 'เป็นผู้ขาย',
                'admin_panel': 'แผงผู้ดูแล',
                'manage_orders': 'จัดการคำสั่งซื้อ',
                'analytics': 'การวิเคราะห์',
                'need_help': 'ต้องการความช่วยเหลือหรือไม่?',
                'seller_centre': 'ศูนย์ผู้ขาย',
                'start_selling': 'เริ่มขาย',
                'download': 'ดาวน์โหลด',
                'follow_us_on': 'ติดตามเรา',
                'notification': 'การแจ้งเตือน',
                'help': 'ช่วยเหลือ',
                
                // Navigation
                'home': 'หน้าแรก',
                'categories': 'หมวดหมู่',
                'flash_sale': 'แฟลชเซล',
                'live_shopping': 'ช้อปปิ้งสด',
                'vouchers': 'คูปอง',
                'electronics': 'อิเล็กทรอนิกส์',
                'supermarket': 'ซูเปอร์มาร์เก็ต',
                'best_deals': 'ดีลเด็ด',
                'trending': 'กำลังมาแรง',
                'free_shipping': 'ส่งฟรี',
                'fashion': 'แฟชั่น',
                'home_living': 'บ้านและไลฟ์สไตล์',
                'beauty': 'ความงาม',
                'sports': 'กีฬา',
                'books': 'หนังสือ',
                'automotive': 'ยานยนต์',
                'mall': 'มอลล์',
                'super_brand_day': 'วันซูเปอร์แบรนด์',
                'selling_fast': 'ขายดีมาก',
                'sold': 'ชิ้นที่ขาย',
                'off': 'ลด',
                'shop_now': 'ช้อปเลย',
                'learn_more': 'ดูเพิ่มเติม',
                'get_code': 'รับโค้ด',
                'explore': 'สำรวจ',
                
                // Free shipping popup
                'free_shipping_popup_title': 'รับโค้ด ส่งฟรี',
                'free_shipping_popup_subtext': 'รับโค้ดส่งฟรี',

                // Language gate
                'select_language': 'เลือกภาษา',
                'select_language_tip': 'คุณสามารถเปลี่ยนภาษาได้ภายหลังที่ส่วนหัว',
                
                // Main content
                'featured_products': 'สินค้าแนะนำ',
                'view_all': 'ดูทั้งหมด',
                'add_to_cart': 'เพิ่มลงตะกร้า',
                'add_to_wishlist': 'เพิ่มลงรายการโปรด',
                'remove_from_wishlist': 'ลบออกจากรายการโปรด',
                'explore_products': 'สำรวจสินค้า',
                
                // User actions
                'wishlist': 'รายการโปรด',
                'logout': 'ออกจากระบบ',
                'my_orders': 'คำสั่งซื้อของฉัน',
                'chat': 'แชท',
                'become_seller': 'เป็นผู้ขาย',
                'seller_dashboard': 'แผงผู้ขาย',
                
                // Modals
                'login_title': 'เข้าสู่ระบบ',
                'email': 'อีเมล',
                'password': 'รหัสผ่าน',
                'login_button': 'เข้าสู่ระบบ',
                'no_account': 'ยังไม่มีบัญชี?',
                'register_link': 'สมัครสมาชิกที่นี่',
                'register_title': 'สร้างบัญชีใหม่',
                'phone_number': 'หมายเลขโทรศัพท์',
                'confirm_password': 'ยืนยันรหัสผ่าน',
                'register_button': 'สมัครสมาชิก',
                'have_account': 'มีบัญชีอยู่แล้ว?',
                'login_link': 'เข้าสู่ระบบที่นี่',
                'close': 'ปิด',
                
                // Search suggestions
                'sugg_iphone_1_thb': 'ไอโฟนราคา 1 บาท',
                'sugg_bluetooth_speaker': 'ลำโพงบลูทูธ',
                'sugg_long_sleeve_mc': 'เสื้อแขนยาว MC ของแท้',
                'sugg_sneakers': 'รองเท้าผ้าใบ',
                'sugg_brand_bag': 'กระเป๋าแบรนด์เนม',
                
                // Footer
                'about_eddy': 'เกี่ยวกับ Eddy World',
                'about_us': 'เกี่ยวกับเรา',
                'careers': 'อาชีพ',
                'press': 'สื่อมวลชน',
                'blog': 'บล็อก',
                'investor_relations': 'ความสัมพันธ์นักลงทุน',
                'customer_service': 'บริการลูกค้า',
                'help_center': 'ศูนย์ช่วยเหลือ',
                'contact_us': 'ติดต่อเรา',
                'shipping_info': 'ข้อมูลการจัดส่ง',
                'returns': 'การคืนสินค้า',
                'size_guide': 'คู่มือขนาด',
                'payment_methods': 'วิธีการชำระเงิน',
                'credit_cards': 'บัตรเครดิต',
                'bank_transfer': 'โอนเงินผ่านธนาคาร',
                'cash_on_delivery': 'เก็บเงินปลายทาง',
                'e_wallet': 'กระเป๋าเงินอิเล็กทรอนิกส์',
                'installments': 'ผ่อนชำระ',
                'follow_us': 'ติดตามเรา',
                // Login footer (new)
                'footer_customer_service': 'บริการลูกค้า',
                'footer_about_eddy': 'เกี่ยวกับ Eddy',
                'footer_payment': 'การชำระเงิน',
                'footer_follow_us': 'ติดตามเรา',
                'footer_app_download': 'ดาวน์โหลดแอป',
                'footer_help_centre': 'ศูนย์ช่วยเหลือ',
                'footer_how_to_buy': 'วิธีการสั่งซื้อ',
                'footer_how_to_sell': 'วิธีการขาย',
                'footer_payment_methods': 'วิธีการชำระเงิน',
                'footer_shipping_delivery': 'การจัดส่งสินค้า',
                'footer_return_refund': 'การคืนเงินและสินค้า',
                'footer_shop_guarantee': 'การรับประกันร้านค้า',
                'footer_contact_us': 'ติดต่อเรา',
                'footer_about_us': 'เกี่ยวกับเรา',
                'footer_affiliate_program': 'โปรแกรมพันธมิตร',
                'footer_careers': 'ร่วมงานกับเรา',
                'footer_policies': 'นโยบาย',
                'footer_privacy': 'ความเป็นส่วนตัว',
                'footer_blog': 'บล็อก',
                'footer_media_contact': 'ติดต่อสื่อ',
                'footer_qr_code': 'คิวอาร์โค้ด',
                'footer_app_store': 'App Store',
                'footer_google_play': 'Google Play',
                'footer_copyright': '© 2025 Eddy World. สงวนลิขสิทธิ์',
                
                // Cart
                'shopping_cart': 'ตะกร้าสินค้า',
                'cart_empty': 'ตะกร้าของคุณว่างเปล่า',
                'total': 'รวม',
                'checkout': 'ชำระเงิน',
                'remove': 'ลบ',
                'quantity': 'จำนวน',
                
                // Messages
                'login_success': 'เข้าสู่ระบบสำเร็จ!',
                'register_success': 'สมัครสมาชิกสำเร็จ!',
                'logout_success': 'ออกจากระบบสำเร็จ!',
                'item_added_cart': 'เพิ่มสินค้าลงตะกร้าแล้ว!',
                'item_removed_cart': 'ลบสินค้าออกจากตะกร้าแล้ว!',
                'item_added_wishlist': 'เพิ่มสินค้าลงรายการโปรดแล้ว!',
                'item_removed_wishlist': 'ลบสินค้าออกจากรายการโปรดแล้ว!',
                
                // Admin specific
                'admin_welcome': 'ยินดีต้อนรับสู่แผงผู้ดูแล',
                'admin_dashboard': 'แผงผู้ดูแล',
                'manage_orders': 'จัดการคำสั่งซื้อ',
                'analytics': 'การวิเคราะห์',
                'shop_verification': 'การยืนยันร้านค้า',
                'kyc_management': 'การจัดการ KYC',
                'escrow_management': 'การจัดการเอสโครว์',
                'voucher_management': 'การจัดการคูปอง',
                'order_management': 'การจัดการคำสั่งซื้อ',
                'user_management': 'การจัดการผู้ใช้',
                'inventory_management': 'การจัดการสินค้าคงคลัง',
                
                // Language
                'language_changed': 'เปลี่ยนภาษาแล้ว',
                'language_changed_message': 'ภาษาได้ถูกเปลี่ยนเรียบร้อยแล้ว',
                'current_language': 'ภาษาปัจจุบัน',
                
                // Products
                'smartphone': 'สมาร์ทโฟน',
                'laptop': 'แล็ปท็อป',
                'headphones': 'หูฟัง',
                'watch': 'นาฬิกา',
                'smartphone_pro_max': 'สมาร์ทโฟน Pro Max 2024',
                'gaming_laptop_ultra': 'แล็ปท็อปเกมมิ่ง Ultra',
                'wireless_headphones_pro': 'หูฟังไร้สาย Pro',
                'action_camera_4k': 'กล้องแอคชั่น 4K',
                'ipad_air_2024': 'iPad Air 2024',
                'smart_watch_series_8': 'สมาร์ทวอทช์ Series 8',
                'smartphone_description': 'สมาร์ทโฟนรุ่นล่าสุดพร้อมฟีเจอร์ขั้นสูง กล้องความละเอียดสูง และแบตเตอรี่อายุการใช้งานยาวนาน',
                'laptop_description': 'แล็ปท็อปเกมมิ่งประสิทธิภาพสูงพร้อมกราฟิก RTX และอัตราการรีเฟรชที่เร็ว',
                'headphones_description': 'หูฟังไร้สายระดับพรีเมียมพร้อมการลดเสียงรบกวนและคุณภาพเสียงที่ยอดเยี่ยม',
                'camera_description': 'กล้องแอคชั่นระดับมืออาชีพพร้อมการบันทึก 4K และการออกแบบกันน้ำ',
                'ipad_description': 'iPad รุ่นล่าสุดพร้อมประสิทธิภาพที่ทรงพลังและจอ Retina ที่สวยงาม',
                'watch_description': 'สมาร์ทวอทช์ขั้นสูงพร้อมการติดตามสุขภาพและการออกกำลังกาย',
                
                // Categories grid
                'beauty_personal_care': 'ความงามและดูแลส่วนบุคคล',
                'men_clothes': 'เสื้อผ้าผู้ชาย',
                'bags': 'กระเป๋า',
                'women_shoes': 'รองเท้าผู้หญิง',
                'watches_glasses': 'นาฬิกาและแว่นตา',
                'electronics_accessories': 'อุปกรณ์เสริมอิเล็กทรอนิกส์',
                'home_appliances': 'เครื่องใช้ไฟฟ้าภายในบ้าน',
                'cameras': 'กล้องถ่ายรูป',
                'baby_toys': 'เด็กและของเล่น',
                'pets': 'สัตว์เลี้ยง',
                'health_wellness': 'สุขภาพและการดูแลตัวเอง',
                'women_clothes': 'เสื้อผ้าผู้หญิง',
                'men_shoes': 'รองเท้าผู้ชาย',
                'fashion_accessories': 'เครื่องประดับแฟชั่น',
                'mobile_tablets': 'มือถือและแท็บเล็ต',
                'computers_laptops': 'คอมพิวเตอร์และแล็ปท็อป',
                'food_beverages': 'อาหารและเครื่องดื่ม',
                'sports_outdoors': 'กีฬาและกิจกรรมกลางแจ้ง',
                'gaming_accessories': 'เกมมิ่งและอุปกรณ์เสริม',
                
                // Formatting demo
                            'price': 'ราคา',
            'date': 'วันที่',
            'number': 'ตัวเลข',
            'phone': 'โทรศัพท์',
            'close': 'ปิด'
            },
            zh: {
                // Header
                'welcome': '欢迎来到 Eddy World',
                'search_placeholder': '搜索产品...',
                'login': '登录',
                'register': '注册',
                'logout': '退出',
                'wishlist': '收藏夹',
                'my_orders': '我的订单',
                'chat': '聊天',
                'become_seller': '成为卖家',
                'admin_panel': '管理面板',
                'manage_orders': '订单管理',
                'analytics': '数据分析',
                'need_help': '需要帮助吗？',
                'seller_centre': '卖家中心',
                'start_selling': '开始销售',
                'download': '下载',
                'follow_us_on': '关注我们',
                'notification': '通知',
                'help': '帮助',
                
                // Navigation
                'home': '首页',
                'categories': '分类',
                'flash_sale': '限时抢购',
                'live_shopping': '直播购物',
                'vouchers': '优惠券',
                'electronics': '电子产品',
                'supermarket': '超市',
                'best_deals': '最佳优惠',
                'trending': '热门',
                'free_shipping': '免运费',
                'fashion': '时尚',
                'home_living': '家居生活',
                'beauty': '美容',
                'sports': '运动',
                'books': '图书',
                'automotive': '汽车',
                'mall': '商城',
                'super_brand_day': '超级品牌日',
                'selling_fast': '热销中',
                'sold': '已售',
                'off': '折',
                'shop_now': '立即购买',
                'learn_more': '了解更多',
                'get_code': '获取优惠码',
                'explore': '探索',
                
                // Free shipping popup
                'free_shipping_popup_title': '领取免运费',
                'free_shipping_popup_subtext': '获取免运费优惠码',

                // Language gate
                'select_language': '选择语言',
                'select_language_tip': '稍后可在页眉更改语言。',
                
                // Main content
                'featured_products': '精选产品',
                'view_all': '查看全部',
                'add_to_cart': '加入购物车',
                'add_to_wishlist': '加入收藏夹',
                'remove_from_wishlist': '从收藏夹移除',
                'explore_products': '探索产品',
                
                // User actions
                'wishlist': '收藏夹',
                'logout': '退出',
                'my_orders': '我的订单',
                'chat': '聊天',
                'become_seller': '成为卖家',
                'seller_dashboard': '卖家面板',
                
                // Modals
                'login_title': '登录账户',
                'email': '邮箱',
                'password': '密码',
                'login_button': '登录',
                'no_account': '没有账户？',
                'register_link': '在这里注册',
                'register_title': '创建新账户',
                'phone_number': '手机号码',
                'confirm_password': '确认密码',
                'register_button': '注册',
                'have_account': '已有账户？',
                'login_link': '在这里登录',
                'close': '关闭',
                
                // Search suggestions
                'sugg_iphone_1_thb': 'iPhone 仅 1 泰铢',
                'sugg_bluetooth_speaker': '蓝牙音箱',
                'sugg_long_sleeve_mc': '正品 MC 长袖',
                'sugg_sneakers': '运动鞋',
                'sugg_brand_bag': '品牌包袋',
                
                // Footer
                'footer_about_eddy': '关于 Eddy World',
                'about_us': '关于我们',
                'careers': '职业',
                'press': '新闻',
                'blog': '博客',
                'investor_relations': '投资者关系',
                'customer_service': '客户服务',
                'help_center': '帮助中心',
                'contact_us': '联系我们',
                'shipping_info': '配送信息',
                'returns': '退货',
                'size_guide': '尺码指南',
                'payment_methods': '支付方式',
                'credit_cards': '信用卡',
                'bank_transfer': '银行转账',
                'cash_on_delivery': '货到付款',
                'e_wallet': '电子钱包',
                'installments': '分期付款',
                'follow_us': '关注我们',
                // Login footer (new)
                'footer_customer_service': '客户服务',
                'footer_about_eddy': '关于 Eddy',
                'footer_payment': '支付',
                'footer_follow_us': '关注我们',
                'footer_app_download': '应用下载',
                'footer_help_centre': '帮助中心',
                'footer_how_to_buy': '如何购买',
                'footer_how_to_sell': '如何销售',
                'footer_payment_methods': '支付方式',
                'footer_shipping_delivery': '配送与交付',
                'footer_return_refund': '退货与退款',
                'footer_shop_guarantee': '商城保障',
                'footer_contact_us': '联系我们',
                'footer_about_us': '关于我们',
                'footer_affiliate_program': '联盟计划',
                'footer_careers': '加入我们',
                'footer_policies': '政策',
                'footer_privacy': '隐私',
                'footer_blog': '博客',
                'footer_media_contact': '媒体联络',
                'footer_qr_code': '二维码',
                'footer_app_store': 'App Store',
                'footer_google_play': 'Google Play',
                'footer_copyright': '© 2025 Eddy World. 版权所有',
                'follow_us_on': '关注我们',
                
                // Cart
                'shopping_cart': '购物车',
                'cart_empty': '您的购物车是空的',
                'total': '总计',
                'checkout': '结账',
                'remove': '移除',
                'quantity': '数量',
                
                // Messages
                'login_success': '登录成功！',
                'register_success': '注册成功！',
                'logout_success': '退出成功！',
                'item_added_cart': '商品已添加到购物车！',
                'item_removed_cart': '商品已从购物车移除！',
                'item_added_wishlist': '商品已添加到收藏夹！',
                'item_removed_wishlist': '商品已从收藏夹移除！',
                
                // Admin specific
                'admin_welcome': '欢迎来到管理面板',
                'admin_dashboard': '管理面板',
                'manage_orders': '订单管理',
                'analytics': '数据分析',
                'shop_verification': '店铺验证',
                'kyc_management': 'KYC管理',
                'escrow_management': '托管管理',
                'voucher_management': '优惠券管理',
                'order_management': '订单管理',
                'user_management': '用户管理',
                'inventory_management': '库存管理',
                
                // Language
                'language_changed': '语言已更改',
                'language_changed_message': '语言设置已成功更新',
                'current_language': '当前语言',
                
                // Products
                'smartphone': '智能手机',
                'laptop': '笔记本电脑',
                'headphones': '耳机',
                'watch': '手表',
                'smartphone_pro_max': '智能手机 Pro Max 2024',
                'gaming_laptop_ultra': '游戏本 Ultra',
                'wireless_headphones_pro': '无线耳机 Pro',
                'action_camera_4k': '4K 运动相机',
                'ipad_air_2024': 'iPad Air 2024',
                'smart_watch_series_8': '智能手表 Series 8',
                'smartphone_description': '最新智能手机，具有先进功能、高分辨率摄像头和长续航电池',
                'laptop_description': '高性能游戏本，配备 RTX 显卡和快速刷新率',
                'headphones_description': '高端无线耳机，具有降噪功能和优质音质',
                'camera_description': '专业运动相机，支持 4K 录制和防水设计',
                'ipad_description': '最新 iPad，性能强大，配备惊艳的 Retina 显示屏',
                'watch_description': '先进智能手表，具有健康监测和健身追踪功能',
                
                // Categories grid
                'beauty_personal_care': '美妆与个护',
                'men_clothes': '男装',
                'bags': '包袋',
                'women_shoes': '女鞋',
                'watches_glasses': '手表与眼镜',
                'electronics_accessories': '电子配件',
                'home_appliances': '家用电器',
                'cameras': '相机',
                'baby_toys': '婴儿与玩具',
                'pets': '宠物',
                'health_wellness': '健康与保健',
                'women_clothes': '女装',
                'men_shoes': '男鞋',
                'fashion_accessories': '时尚配饰',
                'mobile_tablets': '手机与平板',
                'computers_laptops': '电脑与笔记本',
                'food_beverages': '食品与饮料',
                'sports_outdoors': '运动与户外',
                'gaming_accessories': '游戏与配件',
                
                // Formatting demo
                            'price': '价格',
            'date': '日期',
            'number': '数字',
            'phone': '电话',
            'close': '关闭'
            }
        };
        
        // Countdown Timer Function
        function updateCountdown() {
            const now = new Date().getTime();
            const targetTime = new Date().getTime() + (2 * 60 * 60 * 1000); // 2 hours from now
            const timeLeft = targetTime - now;
            
            if (timeLeft > 0) {
                const hours = Math.floor(timeLeft / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
                
                document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
                document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
                document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
            }
        }
        
        // Categories Toggle Function
        function toggleCategoriesView() {
            const categoriesGrid = document.querySelector('.categories-grid');
            const navBtn = document.querySelector('.categories-nav-btn');
            const icon = navBtn.querySelector('i');
            const firstRow = document.querySelector('.categories-row');
            
            if (categoriesGrid.classList.contains('show-more')) {
                // Slide back to first row
                categoriesGrid.style.transform = 'translateX(0)';
                categoriesGrid.classList.remove('show-more');
                icon.className = 'fas fa-chevron-right';
                navBtn.title = 'Show More Categories';
            } else {
                // Slide to show more categories - use exact width of first row
                const slideDistance = firstRow.offsetWidth;
                categoriesGrid.style.transform = `translateX(-${slideDistance}px)`;
                categoriesGrid.classList.add('show-more');
                icon.className = 'fas fa-chevron-left';
                navBtn.title = 'Show Less Categories';
            }
        }
        
        // Admin function to add category image
        function addCategoryImage(categoryId, imageUrl) {
            const categoryIcon = document.querySelector(`[data-category-id="${categoryId}"] .category-icon-grid`);
            if (categoryIcon) {
                // Remove existing icon
                const existingIcon = categoryIcon.querySelector('i');
                if (existingIcon) {
                    existingIcon.remove();
                }
                
                // Add image
                const img = document.createElement('img');
                img.src = imageUrl;
                img.alt = 'Category Image';
                categoryIcon.appendChild(img);
            }
        }
        
        // Admin function to remove category image
        function removeCategoryImage(categoryId) {
            const categoryIcon = document.querySelector(`[data-category-id="${categoryId}"] .category-icon-grid`);
            if (categoryIcon) {
                const img = categoryIcon.querySelector('img');
                if (img) {
                    img.remove();
                }
                
                // Restore icon
                const icon = document.createElement('i');
                icon.className = 'fas fa-tag'; // Default icon
                categoryIcon.appendChild(icon);
            }
        }
        
        // Free Shipping Popup Functions
        function closeFreeShippingPopup() {
            const popup = document.getElementById('freeShippingPopup');
            popup.style.display = 'none';
        }
        
        function showFreeShippingPopup() {
            const popup = document.getElementById('freeShippingPopup');
            popup.style.display = 'block';
            popup.style.opacity = '1';
            popup.style.transform = 'none';
            // Remove any animation/transition that might be applied dynamically
            popup.style.animation = 'none';
            popup.style.transition = 'none';
            // Ensure children inherit no animation/transition
            const descendants = popup.querySelectorAll('*');
            descendants.forEach(el => {
                el.style.animation = 'none';
                el.style.transition = 'none';
                el.style.transform = 'none';
                el.style.opacity = '1';
            });
            // Ensure popup link navigates in same tab
            const link = popup.querySelector('.popup-link');
            if (link) {
                link.removeAttribute('target');
                link.removeAttribute('rel');
            }
        }

        // Hide language selection gate and mark it dismissed for this session
        function hideLanguageGate() {
            const gate = document.getElementById('languageGate');
            if (gate) {
                gate.style.display = 'none';
            }
            try { sessionStorage.setItem('eddy_lang_gate_shown_session', '1'); } catch (e) {}
        }
        
        // Removed auto-hide to keep popup visible until closed by user
        
        // Demo: Add some sample category images (admin can replace these)
        function loadSampleCategoryImages() {
            // Example of how admin can add images to categories
            // addCategoryImage(1, 'https://via.placeholder.com/50x50/667eea/ffffff?text=Beauty');
            // addCategoryImage(8, 'https://via.placeholder.com/50x50/ff6b35/ffffff?text=Camera');
            // addCategoryImage(16, 'https://via.placeholder.com/50x50/ff6b35/ffffff?text=Mobile');
        }
        // Language functions
        function changeLanguage(lang) {
            // Disable language change animation to avoid any global animation effects
            document.body.classList.remove('language-change-animation');
            
            currentLanguage = lang;
            // Store language for this session only (do not persist across sessions)
            try { sessionStorage.setItem('eddy_lang_session', lang); } catch (e) {}
            
            // Save language preference to user profile if logged in
            if (currentUser) {
                currentUser.preferredLanguage = lang;
                localStorage.setItem('eddyUser', JSON.stringify(currentUser));
            }
            
            updateLanguageUI();
            
            // Suppress language change notification per requirements
            
            // Update exchange rates when language changes
            updateExchangeRates();
            
            // Translate the entire page instantly
            translatePage();
            
            // Ensure banners/ads are identical across languages
            // Re-render banner ads and re-init carousel so content matches English
            if (typeof updateBannerDisplay === 'function') {
                updateBannerDisplay();
            }
            if (typeof carouselInterval !== 'undefined') {
                try { clearInterval(carouselInterval); } catch (e) {}
            }
            if (typeof initCarousel === 'function') {
                initCarousel();
            }
            
            // Update all prices with new currency
            updateAllPrices();
            
            // Auto-save the language preference
            saveToStorage();
            
            // Ensure animation class is not present
            document.body.classList.remove('language-change-animation');

            // Auto-refresh the page to ensure ALL dynamic content updates to the new language
            // This avoids partial translations and guarantees consistency
            // If a language was chosen via the gate in this tick, skip reload to avoid loop
            if (!window.__skipLanguageReload) {
                setTimeout(() => {
                    try { saveToStorage(); } catch (e) {}
                    window.location.reload();
                }, 150);
            } else {
                // Clear the flag and keep the page in place
                window.__skipLanguageReload = false;
                // Hide language gate after selection so it doesn't show again in this session
                try {
                    const gate = document.getElementById('languageGate');
                    if (gate) gate.style.display = 'none';
                    sessionStorage.setItem('eddy_lang_gate_shown_session', '1');
                } catch (e) {}
            }
        }
        
        function getText(key) {
            return translations[currentLanguage][key] || translations['en'][key] || key;
        }

        // Auto-translate common phrases (works for newly added DOM without adding keys)
        const autoPhrases = {
            'customer service': { th: 'บริการลูกค้า', zh: '客户服务' },
            'help centre': { th: 'ศูนย์ช่วยเหลือ', zh: '帮助中心' },
            'how to buy': { th: 'วิธีการสั่งซื้อ', zh: '如何购买' },
            'how to sell': { th: 'วิธีการขาย', zh: '如何销售' },
            'payment methods': { th: 'วิธีการชำระเงิน', zh: '支付方式' },
            'shipping & delivery': { th: 'การจัดส่งสินค้า', zh: '配送与交付' },
            'return & refund': { th: 'การคืนเงินและสินค้า', zh: '退货与退款' },
            'shop guarantee': { th: 'การรับประกันร้านค้า', zh: '商城保障' },
            'contact us': { th: 'ติดต่อเรา', zh: '联系我们' },
            'about eddy': { th: 'เกี่ยวกับ Eddy', zh: '关于 Eddy' },
            'about us': { th: 'เกี่ยวกับเรา', zh: '关于我们' },
            'affiliate program': { th: 'โปรแกรมพันธมิตร', zh: '联盟计划' },
            'careers': { th: 'ร่วมงานกับเรา', zh: '加入我们' },
            'policies': { th: 'นโยบาย', zh: '政策' },
            'privacy': { th: 'ความเป็นส่วนตัว', zh: '隐私' },
            'blog': { th: 'บล็อก', zh: '博客' },
            'media contact': { th: 'ติดต่อสื่อ', zh: '媒体联络' },
            'payment': { th: 'การชำระเงิน', zh: '支付' },
            'follow us': { th: 'ติดตามเรา', zh: '关注我们' },
            'app download': { th: 'ดาวน์โหลดแอป', zh: '应用下载' },
            'qr code': { th: 'คิวอาร์โค้ด', zh: '二维码' },
            'app store': { th: 'App Store', zh: 'App Store' },
            'google play': { th: 'Google Play', zh: 'Google Play' },
            'facebook': { th: 'เฟซบุ๊ก', zh: 'Facebook' },
            'instagram': { th: 'อินสตาแกรม', zh: 'Instagram' },
            'line': { th: 'ไลน์', zh: 'LINE' },
            'linkedin': { th: 'ลิงก์ดอิน', zh: 'LinkedIn' },
            '© 2025 eddy world. all rights reserved.': { th: '© 2025 Eddy World. สงวนลิขสิทธิ์', zh: '© 2025 Eddy World. 版权所有' }
        };

        function autoTranslatePlainText(container) {
            const walker = document.createTreeWalker(container, NodeFilter.SHOW_TEXT, null);
            let node;
            while ((node = walker.nextNode())) {
                const original = node.nodeValue;
                if (!original || !original.trim()) continue;
                // Skip if text node is inside an element carrying data-translate
                if (node.parentElement && (node.parentElement.closest('[data-translate]') || node.parentElement.closest('[data-no-translate]'))) continue;
                const trimmed = original.trim();
                const low = trimmed.toLowerCase();
                const phrase = autoPhrases[low];
                if (phrase) {
                    const translated = currentLanguage === 'th' ? phrase.th : (currentLanguage === 'zh' ? phrase.zh : trimmed);
                    if (translated !== trimmed) {
                        // preserve leading/trailing spaces around the trimmed segment
                        const leading = original.slice(0, original.indexOf(trimmed));
                        const trailing = original.slice(original.indexOf(trimmed) + trimmed.length);
                        node.nodeValue = leading + translated + trailing;
                    }
                }
            }
        }

        // Determine best initial language from browser settings
        function getBrowserPreferredLanguage() {
            const supported = ['en', 'th', 'zh'];
            try {
                const params = new URLSearchParams(window.location.search);
                const qLang = (params.get('lang') || '').toLowerCase();
                if (supported.includes(qLang)) return qLang;
            } catch (e) {}

            const rawList = [];
            try {
                if (navigator.languages && navigator.languages.length) rawList.push(...navigator.languages);
                if (navigator.language) rawList.push(navigator.language);
                // Some browsers
                if (navigator.userLanguage) rawList.push(navigator.userLanguage);
            } catch (e) {}
            const langs = rawList.map(l => String(l || '').toLowerCase());

            // Prefer English if present anywhere, then Thai, then Chinese; else default English
            if (langs.some(l => l.startsWith('en'))) return 'en';
            if (langs.some(l => l.startsWith('th'))) return 'th';
            if (langs.some(l => l.startsWith('zh'))) return 'zh';
            return 'en';
        }
        
        function updateLanguageUI() {
            const languageSelect = document.getElementById('languageSelect');
            const currentLanguageDisplay = document.getElementById('currentLanguageDisplay');
            
            if (languageSelect) {
                languageSelect.value = currentLanguage;
            }
            
            if (currentLanguageDisplay) {
                const languageInfo = {
                    'en': '🇺🇸 EN',
                    'th': '🇹🇭 TH',
                    'zh': '🇨🇳 ZH'
                };
                currentLanguageDisplay.textContent = languageInfo[currentLanguage] || '🌐';
            }
        }
        
        // Function to show current exchange rates
        function showExchangeRates() {
            const rates = {
                'en': `💱 Exchange Rates:\n1 THB = ${exchangeRates.USD.toFixed(4)} USD\n1 THB = ${exchangeRates.CNY.toFixed(4)} CNY`,
                'th': `💱 อัตราแลกเปลี่ยน:\n1 บาท = ${exchangeRates.USD.toFixed(4)} ดอลลาร์\n1 บาท = ${exchangeRates.CNY.toFixed(4)} หยวน`,
                'zh': `💱 汇率:\n1 泰铢 = ${exchangeRates.USD.toFixed(4)} 美元\n1 泰铢 = ${exchangeRates.CNY.toFixed(4)} 人民币`
            };
            
            addNotification(rates[currentLanguage] || rates['en'], 'info');
        }
        
        function translatePage() {
            // Update header elements
            const welcomeBanner = document.querySelector('.banner h1, .banner h2');
            if (welcomeBanner) {
                welcomeBanner.textContent = getText('welcome');
            }
            
            const searchInput = document.querySelector('.search-box input, .search-input');
            if (searchInput) {
                searchInput.placeholder = getText('search_placeholder');
            }
            
            // Update navigation (case-insensitive)
            const navItems = document.querySelectorAll('.nav-item a, .nav a, .header-top-left a, .header-top-right a, .header-top-left span');
            navItems.forEach(item => {
                const text = (item.textContent || '').toLowerCase();
                if (text.includes('home')) item.textContent = getText('home');
                else if (text.includes('categories')) item.textContent = getText('categories');
                else if (text.includes('flash sale')) item.textContent = getText('flash_sale');
                else if (text.includes('live shopping')) item.textContent = getText('live_shopping');
                else if (text.includes('vouchers')) item.textContent = getText('vouchers');
                else if (text.includes('electronics')) item.textContent = getText('electronics');
                else if (text.includes('fashion')) item.textContent = getText('fashion');
                else if (text.includes('home & living')) item.textContent = getText('home_living');
                else if (text.includes('beauty')) item.textContent = getText('beauty');
                else if (text.includes('sports')) item.textContent = getText('sports');
                else if (text.includes('books')) item.textContent = getText('books');
                else if (text.includes('automotive')) item.textContent = getText('automotive');
                else if (text.includes('seller centre')) item.textContent = getText('seller_centre');
                else if (text.includes('start selling')) item.textContent = getText('start_selling');
                else if (text.includes('download')) item.textContent = getText('download');
                else if (text.includes('notification')) item.textContent = getText('notification');
                else if (text.includes('help')) item.textContent = getText('help');
                else if (text.includes('follow us on')) item.textContent = getText('follow_us_on');
            });
            
            // Update sidebar categories
            const categoryItems = document.querySelectorAll('.category-item, .sidebar a');
            categoryItems.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes('electronics')) item.innerHTML = item.innerHTML.replace('Electronics', getText('electronics'));
                else if (text.includes('fashion')) item.innerHTML = item.innerHTML.replace('Fashion', getText('fashion'));
                else if (text.includes('home & living')) item.innerHTML = item.innerHTML.replace('Home & Living', getText('home_living'));
                else if (text.includes('beauty')) item.innerHTML = item.innerHTML.replace('Beauty', getText('beauty'));
                else if (text.includes('sports')) item.innerHTML = item.innerHTML.replace('Sports', getText('sports'));
                else if (text.includes('books')) item.innerHTML = item.innerHTML.replace('Books', getText('books'));
                else if (text.includes('automotive')) item.innerHTML = item.innerHTML.replace('Automotive', getText('automotive'));
            });

            // Translate categories grid items (CATEGORIES section)
            const catGridSpans = document.querySelectorAll('.categories-row .category-item-grid span');
            catGridSpans.forEach(span => {
                const raw = span.textContent.trim();
                const lower = raw.toLowerCase();
                if (!raw) return;
                if (lower === 'beauty & personal care') span.textContent = getText('beauty_personal_care');
                else if (lower === 'men clothes') span.textContent = getText('men_clothes');
                else if (lower === 'bags') span.textContent = getText('bags');
                else if (lower === 'women shoes') span.textContent = getText('women_shoes');
                else if (lower === 'watches & glasses') span.textContent = getText('watches_glasses');
                else if (lower === 'electronics accessories') span.textContent = getText('electronics_accessories');
                else if (lower === 'home appliances') span.textContent = getText('home_appliances');
                else if (lower === 'cameras') span.textContent = getText('cameras');
                else if (lower === 'baby & toys') span.textContent = getText('baby_toys');
                else if (lower === 'pets') span.textContent = getText('pets');
                else if (lower === 'health & wellness') span.textContent = getText('health_wellness');
                else if (lower === 'women clothes') span.textContent = getText('women_clothes');
                else if (lower === 'men shoes') span.textContent = getText('men_shoes');
                else if (lower === 'fashion accessories') span.textContent = getText('fashion_accessories');
                else if (lower === 'home & living') span.textContent = getText('home_living');
                else if (lower === 'mobile & tablets') span.textContent = getText('mobile_tablets');
                else if (lower === 'computers & laptops') span.textContent = getText('computers_laptops');
                else if (lower === 'food & beverages') span.textContent = getText('food_beverages');
                else if (lower === 'sports & outdoors') span.textContent = getText('sports_outdoors');
                else if (lower === 'gaming & accessories') span.textContent = getText('gaming_accessories');
                else if (lower === 'automotive') span.textContent = getText('automotive');
            });

            // Translate quick categories (skip labels with 'Eddy' brand)
            const quickCats = document.querySelectorAll('.quick-categories .category-icon span');
            quickCats.forEach(span => {
                const raw = span.textContent.trim();
                if (!raw || /eddy/i.test(raw)) return; // keep brand names
                const lower = raw.toLowerCase();
                if (lower === 'electronics') span.textContent = getText('electronics');
                else if (lower === 'supermarket') span.textContent = getText('supermarket');
                else if (lower === 'best deals') span.textContent = getText('best_deals');
                else if (lower === 'trending') span.textContent = getText('trending');
                else if (lower === 'free shipping') span.textContent = getText('free_shipping');
            });
            
            // Update main content (case-insensitive)
            const sectionTitles = document.querySelectorAll('.section-title, h3');
            sectionTitles.forEach(title => {
                const t = (title.textContent || '').toLowerCase();
                if (t.includes('featured products')) {
                    title.textContent = getText('featured_products');
                } else if (t.includes('categories')) {
                    // Force Thai wording for categories
                    title.textContent = currentLanguage === 'th' ? 'หมวดหมู่' : getText('categories');
                } else if (t.includes('flash sale')) {
                    // Handled via explicit selector below
                }
            });
            const flashSaleHeading = document.querySelector('.flash-sale-title h2');
            if (flashSaleHeading) {
                if (currentLanguage === 'th') {
                    // Keep English for Thai as requested
                    flashSaleHeading.textContent = 'FLASH SALE';
                } else {
                    flashSaleHeading.textContent = getText('flash_sale');
                }
            }
            // Set Categories header above the grid
            const categoriesHeaderTitle = document.querySelector('.categories-section .categories-header h2');
            if (categoriesHeaderTitle) {
                categoriesHeaderTitle.textContent = currentLanguage === 'th' ? 'หมวดหมู่' : getText('categories');
            }
            
            const viewAllLinks = document.querySelectorAll('.view-all');
            viewAllLinks.forEach(link => {
                if (link.textContent.includes('View All')) {
                    link.textContent = getText('view_all');
                }
            });
            
            // Update buttons (include banner buttons)
            const addToCartBtns = document.querySelectorAll('.add-to-cart, .banner-btn');
            addToCartBtns.forEach(btn => {
                const text = (btn.textContent || '').trim();
                if (text.includes('Add to Cart')) {
                    btn.textContent = getText('add_to_cart');
                } else if (text.includes('Shop Now')) {
                    btn.textContent = getText('shop_now');
                } else if (text.includes('Learn More')) {
                    btn.textContent = getText('learn_more');
                } else if (text.includes('Get Code')) {
                    btn.textContent = getText('get_code');
                } else if (text.includes('Explore')) {
                    btn.textContent = getText('explore');
                }
            });
            
            const wishlistBtns = document.querySelectorAll('.wishlist-btn');
            wishlistBtns.forEach(btn => {
                if (btn.textContent.includes('Add to Wishlist')) {
                    btn.textContent = getText('add_to_wishlist');
                } else if (btn.textContent.includes('Remove from Wishlist')) {
                    btn.textContent = getText('remove_from_wishlist');
                }
            });
            
            // Update user actions
            const userActions = document.querySelectorAll('#user-actions a, .user-actions a');
            userActions.forEach(action => {
                const text = action.textContent.toLowerCase();
                if (text.includes('wishlist')) action.innerHTML = action.innerHTML.replace('Wishlist', getText('wishlist'));
                else if (text.includes('logout')) action.textContent = getText('logout');
                else if (text.includes('my orders')) action.textContent = getText('my_orders');
                else if (text.includes('chat')) action.textContent = getText('chat');
                else if (text.includes('become a seller')) action.textContent = getText('become_seller');
                else if (text.includes('seller dashboard')) action.textContent = getText('seller_dashboard');
            });
            
            // Update guest actions (case-insensitive, handle "Sign Up"/"Log In")
            const guestActions = document.querySelectorAll('#guest-actions a, .guest-actions a');
            guestActions.forEach(action => {
                const text = (action.textContent || '').toLowerCase();
                if (text.includes('login') || text.includes('log in')) action.textContent = getText('login');
                else if (text.includes('register') || text.includes('sign up')) action.textContent = getText('register');
            });
            
            // Update modals
            updateModalTranslations();
            
            // Update footer
            updateFooterTranslations();
            // Translate login footer if present
            const loginFooterEl = document.getElementById('full-login-footer');
            if (loginFooterEl) translateNewContent(loginFooterEl);
            
            // Update admin content if present
            updateAdminTranslations();
            
            // Update cart and wishlist counts
            updateCartCount();
            updateWishlistCount();
            
            // Call enhanced translation for dynamic content
            translateDynamicContent();
            
            // Translate product data structures
            translateProductData();
            
            // Update all formatted content (dates, currency, numbers, phone)
            updateFormattedContent();

            // Final pass: translate any new nodes created by other systems
            translateNewContent(document.body);
            
            // Force UI refresh
            updateUI();
            
            // Additional comprehensive translation for any missed elements
            setTimeout(() => {
                // Force re-translation of all elements
                const allTextElements = document.querySelectorAll('h1, h2, h3, h4, h5, h6, p, span, div, button, a, label, input[placeholder]');
                
                // Update all formatted content again to ensure consistency
                updateFormattedContent();
                allTextElements.forEach(element => {
                    if (element.textContent && element.textContent.trim()) {
                        const text = element.textContent.trim();
                        
                        // Check for common untranslated text patterns
                        if (text === 'Smartphone Pro Max 2024') {
                            element.textContent = getText('smartphone_pro_max');
                        } else if (text === 'Gaming Laptop Ultra') {
                            element.textContent = getText('gaming_laptop_ultra');
                        } else if (text === 'Wireless Headphones Pro') {
                            element.textContent = getText('wireless_headphones_pro');
                        } else if (text === '4K Action Camera') {
                            element.textContent = getText('action_camera_4k');
                        } else if (text === 'iPad Air 2024') {
                            element.textContent = getText('ipad_air_2024');
                        } else if (text === 'Smart Watch Series 8') {
                            element.textContent = getText('smart_watch_series_8');
                        }
                        
                        // Check for product descriptions
                        if (text === 'Latest smartphone with advanced features, high-resolution camera, and long battery life.') {
                            element.textContent = getText('smartphone_description');
                        } else if (text === 'High-performance gaming laptop with RTX graphics and fast refresh rate.') {
                            element.textContent = getText('laptop_description');
                        } else if (text === 'Premium wireless headphones with noise cancellation and premium sound quality.') {
                            element.textContent = getText('headphones_description');
                        } else if (text === 'Professional action camera with 4K recording and waterproof design.') {
                            element.textContent = getText('camera_description');
                        } else if (text === 'Latest iPad with powerful performance and stunning Retina display.') {
                            element.textContent = getText('ipad_description');
                        } else if (text === 'Advanced smartwatch with health monitoring and fitness tracking.') {
                            element.textContent = getText('watch_description');
                        }
                    }
                });
                
                // Translate any dynamically generated content
                translateDynamicContent();
                
                // Translate product data structures
                translateProductData();
                
                // Update all formatted content
                updateFormattedContent();
                
                // Ensure banners/ads are identical across languages after all translations
                if (typeof updateBannerDisplay === 'function') {
                    updateBannerDisplay();
                }
                if (typeof carouselInterval !== 'undefined') {
                    try { clearInterval(carouselInterval); } catch (e) {}
                }
                if (typeof initCarousel === 'function') {
                    try { currentSlide = 1; } catch (e) {}
                    initCarousel();
                }
            }, 100);
            // Also auto-translate any plain text phrases across the page (including newly added blocks)
            try { autoTranslatePlainText(document.body); } catch (e) {}
        }
        
        function updateModalTranslations() {
            // Login modal
            const loginTitle = document.querySelector('#loginModal .modal-header h2');
            if (loginTitle) loginTitle.textContent = getText('login_title');
            
            const loginEmailLabel = document.querySelector('#loginModal label[for="loginEmail"]');
            if (loginEmailLabel) loginEmailLabel.textContent = getText('email');
            
            const loginPasswordLabel = document.querySelector('#loginModal label[for="loginPassword"]');
            if (loginPasswordLabel) loginPasswordLabel.textContent = getText('password');
            
            const loginButton = document.querySelector('#loginModal .btn-primary');
            if (loginButton) loginButton.textContent = getText('login_button');
            
            const noAccountText = document.querySelector('#loginModal .modal-footer a');
            if (noAccountText) {
                const text = noAccountText.textContent;
                if (text.includes("Don't have an account?")) {
                    noAccountText.innerHTML = getText('no_account') + ' <a href="#" onclick="hideLanguageGate(); switchModal(\'loginModal\', \'registerModal\')">' + getText('register_link') + '</a>';
                }
            }
            
            // Register modal
            const registerTitle = document.querySelector('#registerModal .modal-header h2');
            if (registerTitle) registerTitle.textContent = getText('register_title');
            
            const registerEmailLabel = document.querySelector('#registerModal label[for="registerEmail"]');
            if (registerEmailLabel) registerEmailLabel.textContent = getText('email');
            
            const registerPhoneLabel = document.querySelector('#registerModal label[for="registerPhone"]');
            if (registerPhoneLabel) registerPhoneLabel.textContent = getText('phone_number');
            
            const registerPasswordLabel = document.querySelector('#registerModal label[for="registerPassword"]');
            if (registerPasswordLabel) registerPasswordLabel.textContent = getText('password');
            
            const registerConfirmLabel = document.querySelector('#registerModal label[for="registerConfirmPassword"]');
            if (registerConfirmLabel) registerConfirmLabel.textContent = getText('confirm_password');
            
            const registerButton = document.querySelector('#registerModal .btn-primary');
            if (registerButton) registerButton.textContent = getText('register_button');
            
            const haveAccountText = document.querySelector('#registerModal .modal-footer a');
            if (haveAccountText) {
                const text = haveAccountText.textContent;
                if (text.includes('Already have an account?')) {
                    haveAccountText.innerHTML = getText('have_account') + ' <a href="#" onclick="switchModal(\'registerModal\', \'loginModal\')">' + getText('login_link') + '</a>';
                }
            }

            // Full-page login (if currently rendered)
            const fullLogin = document.getElementById('full-login');
            if (fullLogin) {
                const subtitle = fullLogin.querySelector('p');
                if (subtitle) subtitle.textContent = getText('welcome');
                const fullLoginTitle = fullLogin.querySelector('h2');
                if (fullLoginTitle) fullLoginTitle.textContent = getText('login_title');
                const fullLoginEmail = fullLogin.querySelector('#loginEmail');
                if (fullLoginEmail) fullLoginEmail.placeholder = getText('email');
                const fullLoginPassword = fullLogin.querySelector('#loginPassword');
                if (fullLoginPassword) fullLoginPassword.placeholder = getText('password');
                const fullLoginButton = fullLogin.querySelector('button[type="submit"]');
                if (fullLoginButton) fullLoginButton.textContent = getText('login_button');
                const fullLoginFooter = Array.from(fullLogin.querySelectorAll('p')).pop();
                if (fullLoginFooter) {
                    fullLoginFooter.innerHTML = getText('no_account') + ' <a href="#" onclick="hideLanguageGate(); switchModal(\'loginModal\',\'registerModal\'); hideFullLoginPage(); showModal(\'registerModal\'); return false;" style="color:#2563eb; text-decoration:none;">' + getText('register_link') + '</a>';
                }
            }
        }
        
        function updateFooterTranslations() {
            // Footer section titles
            const footerSections = document.querySelectorAll('.footer-section h3');
            footerSections.forEach(section => {
                const text = section.textContent;
                if (text.includes('About Eddy World')) section.textContent = getText('about_eddy');
                else if (text.includes('Customer Service')) section.textContent = getText('customer_service');
                else if (text.includes('Payment Methods')) section.textContent = getText('payment_methods');
                else if (text.includes('Follow Us')) section.textContent = getText('follow_us');
            });
            
            // Footer links
            const footerLinks = document.querySelectorAll('.footer-section a');
            footerLinks.forEach(link => {
                const text = link.textContent;
                if (text.includes('About Us')) link.textContent = getText('about_us');
                else if (text.includes('Careers')) link.textContent = getText('careers');
                else if (text.includes('Press')) link.textContent = getText('press');
                else if (text.includes('Blog')) link.textContent = getText('blog');
                else if (text.includes('Investor Relations')) link.textContent = getText('investor_relations');
                else if (text.includes('Help Center')) link.textContent = getText('help_center');
                else if (text.includes('Contact Us')) link.textContent = getText('contact_us');
                else if (text.includes('Shipping Info')) link.textContent = getText('shipping_info');
                else if (text.includes('Returns')) link.textContent = getText('returns');
                else if (text.includes('Size Guide')) link.textContent = getText('size_guide');
                else if (text.includes('Credit Cards')) link.textContent = getText('credit_cards');
                else if (text.includes('Bank Transfer')) link.textContent = getText('bank_transfer');
                else if (text.includes('Cash on Delivery')) link.textContent = getText('cash_on_delivery');
                else if (text.includes('E-Wallet')) link.textContent = getText('e_wallet');
                else if (text.includes('Installments')) link.textContent = getText('installments');
            });
        }
        
        function updateAdminTranslations() {
            // Admin welcome message
            const adminWelcome = document.querySelector('.admin-welcome h2');
            if (adminWelcome && adminWelcome.textContent.includes('Welcome to Admin Panel')) {
                adminWelcome.textContent = getText('admin_welcome');
            }
            
            // Admin dashboard buttons
            const adminButtons = document.querySelectorAll('.admin-dashboard .admin-button');
            adminButtons.forEach(button => {
                const text = button.textContent;
                if (text.includes('Admin Dashboard')) button.textContent = getText('admin_dashboard');
                else if (text.includes('Manage Orders')) button.textContent = getText('manage_orders');
                else if (text.includes('Analytics')) button.textContent = getText('analytics');
                else if (text.includes('Shop Verification')) button.textContent = getText('shop_verification');
                else if (text.includes('KYC Management')) button.textContent = getText('kyc_management');
                else if (text.includes('Escrow Management')) button.textContent = getText('escrow_management');
                else if (text.includes('Voucher Management')) button.textContent = getText('voucher_management');
                else if (text.includes('Order Management')) button.textContent = getText('order_management');
                else if (text.includes('User Management')) button.textContent = getText('user_management');
                else if (text.includes('Inventory Management')) button.textContent = getText('inventory_management');
            });
        }
        
        // Function to translate dynamic messages
        function translateMessage(message) {
            if (typeof message === 'string') {
                // Check for common message patterns and translate them
                const lowerMessage = message.toLowerCase();
                if (lowerMessage.includes('login successful')) return getText('login_success');
                if (lowerMessage.includes('registration successful')) return getText('register_success');
                if (lowerMessage.includes('logout successful')) return getText('logout_success');
                if (lowerMessage.includes('item added to cart')) return getText('item_added_cart');
                if (lowerMessage.includes('item removed from cart')) return getText('item_removed_cart');
                if (lowerMessage.includes('item added to wishlist')) return getText('item_added_wishlist');
                if (lowerMessage.includes('item removed from wishlist')) return getText('item_removed_wishlist');
            }
            return message;
        }
        
        // Function to translate product data structures
        function translateProductData() {
            // Translate product names in the products array
            if (typeof products !== 'undefined' && products.length > 0) {
                products.forEach(product => {
                    if (product.title === 'Smartphone Pro Max 2024') {
                        product.title = getText('smartphone_pro_max');
                    } else if (product.title === 'Gaming Laptop Ultra') {
                        product.title = getText('gaming_laptop_ultra');
                    } else if (product.title === 'Wireless Headphones Pro') {
                        product.title = getText('wireless_headphones_pro');
                    } else if (product.title === '4K Action Camera') {
                        product.title = getText('action_camera_4k');
                    } else if (product.title === 'iPad Air 2024') {
                        product.title = getText('ipad_air_2024');
                    } else if (product.title === 'Smart Watch Series 8') {
                        product.title = getText('smart_watch_series_8');
                    }
                    
                    // Translate descriptions
                    if (product.description === 'Latest smartphone with advanced features, high-resolution camera, and long battery life.') {
                        product.description = getText('smartphone_description');
                    } else if (product.description === 'High-performance gaming laptop with RTX graphics and fast refresh rate.') {
                        product.description = getText('laptop_description');
                    } else if (product.description === 'Premium wireless headphones with noise cancellation and premium sound quality.') {
                        product.description = getText('headphones_description');
                    } else if (product.description === 'Professional action camera with 4K recording and waterproof design.') {
                        product.description = getText('camera_description');
                    } else if (product.description === 'Latest iPad with powerful performance and stunning Retina display.') {
                        product.description = getText('ipad_description');
                    } else if (product.description === 'Advanced smartwatch with health monitoring and fitness tracking.') {
                        product.description = getText('watch_description');
                    }
                });
            }
            
            // Force re-render of product cards
            const productCards = document.querySelectorAll('.product-card');
            productCards.forEach(card => {
                const title = card.querySelector('.product-title');
                const description = card.querySelector('.product-description');
                
                if (title) {
                    const titleText = title.textContent;
                    if (titleText.includes('Smartphone Pro Max 2024')) {
                        title.textContent = getText('smartphone_pro_max');
                    } else if (titleText.includes('Gaming Laptop Ultra')) {
                        title.textContent = getText('gaming_laptop_ultra');
                    } else if (titleText.includes('Wireless Headphones Pro')) {
                        title.textContent = getText('wireless_headphones_pro');
                    } else if (titleText.includes('4K Action Camera')) {
                        title.textContent = getText('action_camera_4k');
                    } else if (titleText.includes('iPad Air 2024')) {
                        title.textContent = getText('ipad_air_2024');
                    } else if (titleText.includes('Smart Watch Series 8')) {
                        title.textContent = getText('smart_watch_series_8');
                    }
                }
                
                if (description) {
                    const descText = description.textContent;
                    if (descText.includes('Latest smartphone with advanced features')) {
                        description.textContent = getText('smartphone_description');
                    } else if (descText.includes('High-performance gaming laptop with RTX graphics')) {
                        description.textContent = getText('laptop_description');
                    } else if (descText.includes('Premium wireless headphones with noise cancellation')) {
                        description.textContent = getText('headphones_description');
                    } else if (descText.includes('Professional action camera with 4K recording')) {
                        description.textContent = getText('camera_description');
                    } else if (descText.includes('Latest iPad with powerful performance')) {
                        description.textContent = getText('ipad_description');
                    } else if (descText.includes('Advanced smartwatch with health monitoring')) {
                        description.textContent = getText('watch_description');
                    }
                }
            });
        }
        
        // Function to translate newly added content
        function translateNewContent(container) {
            if (!container) return;
            // Translate elements with explicit data-translate keys within this container
            const scopedDynamicElements = container.querySelectorAll('[data-translate]');
            scopedDynamicElements.forEach(element => {
                if (element.hasAttribute('data-no-translate')) return;
                const key = element.getAttribute('data-translate');
                if (!key) return;
                // Inputs may want placeholder translated
                if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                    if (element.hasAttribute('placeholder')) {
                        element.setAttribute('placeholder', getText(key));
                        return;
                    }
                }
                element.textContent = getText(key);
            });
            
            // Translate buttons
            const buttons = container.querySelectorAll('button, .btn');
            buttons.forEach(button => {
                const text = button.textContent;
                if (text.includes('Add to Cart')) button.textContent = getText('add_to_cart');
                else if (text.includes('Add to Wishlist')) button.textContent = getText('add_to_wishlist');
                else if (text.includes('Remove from Wishlist')) button.textContent = getText('remove_from_wishlist');
                else if (text.includes('View All')) button.textContent = getText('view_all');
                else if (text.includes('Checkout')) button.textContent = getText('checkout');
                else if (text.includes('Remove')) button.textContent = getText('remove');
                else if (text.includes('Close')) button.textContent = getText('close');
                else if (text.includes('Explore Products')) button.textContent = getText('explore_products');
            });
            
            // Translate links
            const links = container.querySelectorAll('a');
            links.forEach(link => {
                const text = link.textContent;
                if (text.includes('Home')) link.textContent = getText('home');
                else if (text.includes('Categories')) link.textContent = getText('categories');
                else if (text.includes('Flash Sale')) link.textContent = getText('flash_sale');
                else if (text.includes('Live Shopping')) link.textContent = getText('live_shopping');
                else if (text.includes('Vouchers')) link.textContent = getText('vouchers');
                else if (text.includes('Electronics')) link.innerHTML = link.innerHTML.replace('Electronics', getText('electronics'));
                else if (text.includes('Fashion')) link.innerHTML = link.innerHTML.replace('Fashion', getText('fashion'));
                else if (text.includes('Home & Living')) link.innerHTML = link.innerHTML.replace('Home & Living', getText('home_living'));
                else if (text.includes('Beauty')) link.innerHTML = link.innerHTML.replace('Beauty', getText('beauty'));
                else if (text.includes('Sports')) link.innerHTML = link.innerHTML.replace('Sports', getText('sports'));
                else if (text.includes('Books')) link.innerHTML = link.innerHTML.replace('Books', getText('books'));
                else if (text.includes('Automotive')) link.innerHTML = link.innerHTML.replace('Automotive', getText('automotive'));
            });
            
            // Translate headings (skip banner section)
            const headings = container.querySelectorAll('h1, h2, h3, h4, h5, h6');
            headings.forEach(heading => {
                if (heading.closest('.banner-section')) return;
                const text = heading.textContent;
                if (text.includes('Featured Products')) heading.textContent = getText('featured_products');
                else if (text.includes('Welcome to Eddy World')) heading.textContent = getText('welcome');
                else if (text.includes('Shopping Cart')) heading.textContent = getText('shopping_cart');
                else if (text.includes('Your cart is empty')) heading.textContent = getText('cart_empty');
                else if (text.includes('Categories')) heading.textContent = getText('categories');
            });
            
            // Translate user action elements
            const userActions = container.querySelectorAll('#user-actions a, .user-actions a');
            userActions.forEach(action => {
                const text = action.textContent.toLowerCase();
                if (text.includes('wishlist')) action.innerHTML = action.innerHTML.replace('Wishlist', getText('wishlist'));
                else if (text.includes('logout')) action.textContent = getText('logout');
                else if (text.includes('my orders')) action.textContent = getText('my_orders');
                else if (text.includes('chat')) action.textContent = getText('chat');
                else if (text.includes('become a seller')) action.textContent = getText('become_seller');
                else if (text.includes('seller dashboard')) action.textContent = getText('seller_dashboard');
            });
            
            // Translate guest action elements
            const guestActions = container.querySelectorAll('#guest-actions a, .guest-actions a');
            guestActions.forEach(action => {
                const text = action.textContent.toLowerCase();
                if (text.includes('login')) action.textContent = getText('login');
                else if (text.includes('register')) action.textContent = getText('register');
            });
        }
        
        // Enhanced translation function that handles all dynamic content
        function translateDynamicContent() {
            // Translate product cards
            const productCards = document.querySelectorAll('.product-card');
            productCards.forEach(card => {
                const title = card.querySelector('.product-title');
                const addToCartBtn = card.querySelector('.add-to-cart');
                const wishlistBtn = card.querySelector('.wishlist-btn');
                const description = card.querySelector('.product-description');
                const mallBadge = card.querySelector('.mall-badge');
                const superBrandBadge = card.querySelector('.super-brand-badge');
                const discountBadge = card.querySelector('.discount-badge');
                const statusText = card.querySelector('.status-text');
                
                // Translate product titles with exact matches
                if (title) {
                    const titleText = title.textContent;
                    if (titleText.includes('Smartphone Pro Max 2024')) {
                        title.textContent = getText('smartphone_pro_max');
                    } else if (titleText.includes('Gaming Laptop Ultra')) {
                        title.textContent = getText('gaming_laptop_ultra');
                    } else if (titleText.includes('Wireless Headphones Pro')) {
                        title.textContent = getText('wireless_headphones_pro');
                    } else if (titleText.includes('4K Action Camera')) {
                        title.textContent = getText('action_camera_4k');
                    } else if (titleText.includes('iPad Air 2024')) {
                        title.textContent = getText('ipad_air_2024');
                    } else if (titleText.includes('Smart Watch Series 8')) {
                        title.textContent = getText('smart_watch_series_8');
                    }
                }
                
                // Translate product descriptions
                if (description) {
                    const descText = description.textContent;
                    if (descText.includes('Latest smartphone with advanced features')) {
                        description.textContent = getText('smartphone_description');
                    } else if (descText.includes('High-performance gaming laptop with RTX graphics')) {
                        description.textContent = getText('laptop_description');
                    } else if (descText.includes('Premium wireless headphones with noise cancellation')) {
                        description.textContent = getText('headphones_description');
                    } else if (descText.includes('Professional action camera with 4K recording')) {
                        description.textContent = getText('camera_description');
                    } else if (descText.includes('Latest iPad with powerful performance')) {
                        description.textContent = getText('ipad_description');
                    } else if (descText.includes('Advanced smartwatch with health monitoring')) {
                        description.textContent = getText('watch_description');
                    }
                }
                
                // Translate buttons
                if (addToCartBtn && addToCartBtn.textContent.includes('Add to Cart')) {
                    addToCartBtn.textContent = getText('add_to_cart');
                }
                
                if (wishlistBtn) {
                    if (wishlistBtn.textContent.includes('Add to Wishlist')) {
                        wishlistBtn.textContent = getText('add_to_wishlist');
                    } else if (wishlistBtn.textContent.includes('Remove from Wishlist')) {
                        wishlistBtn.textContent = getText('remove_from_wishlist');
                    }
                }

                // Badges and status
                if (mallBadge) mallBadge.textContent = getText('mall');
                if (superBrandBadge) superBrandBadge.textContent = getText('super_brand_day');
                if (discountBadge && /%\s*OFF/i.test(discountBadge.textContent)) {
                    discountBadge.textContent = discountBadge.textContent.replace(/OFF/i, getText('off'));
                }
                if (statusText) {
                    const txt = statusText.textContent;
                    if (/selling fast/i.test(txt)) statusText.textContent = getText('selling_fast');
                    else if (/\b\d+\s*sold\b/i.test(txt)) statusText.textContent = txt.replace(/sold/i, getText('sold'));
                }
            });
            
            // Translate category items
            const categoryItems = document.querySelectorAll('.category-item');
            categoryItems.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes('electronics')) {
                    item.innerHTML = item.innerHTML.replace('Electronics', getText('electronics'));
                } else if (text.includes('fashion')) {
                    item.innerHTML = item.innerHTML.replace('Fashion', getText('fashion'));
                } else if (text.includes('home & living')) {
                    item.innerHTML = item.innerHTML.replace('Home & Living', getText('home_living'));
                } else if (text.includes('beauty')) {
                    item.innerHTML = item.innerHTML.replace('Beauty', getText('beauty'));
                } else if (text.includes('sports')) {
                    item.innerHTML = item.innerHTML.replace('Sports', getText('sports'));
                } else if (text.includes('books')) {
                    item.innerHTML = item.innerHTML.replace('Books', getText('books'));
                } else if (text.includes('automotive')) {
                    item.innerHTML = item.innerHTML.replace('Automotive', getText('automotive'));
                }
            });
            
            // Translate any other dynamic elements
            const dynamicElements = document.querySelectorAll('[data-translate]');
            dynamicElements.forEach(element => {
                const key = element.getAttribute('data-translate');
                if (key) {
                    element.textContent = getText(key);
                }
            });
            
            // Translate any other dynamic content
            // Auto-translate common phrases in new content
            try {
                autoTranslatePlainText(container);
            } catch (e) {}
        }
        // Set up MutationObserver to automatically translate new content
        function setupLanguageObserver() {
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'childList') {
                        mutation.addedNodes.forEach((node) => {
                            if (node.nodeType === Node.ELEMENT_NODE) {
                                translateNewContent(node);
                                // Also translate product data when new content is added
                                setTimeout(() => {
                                    translateProductData();
                                    // Update formatted content for new elements
                                    updateFormattedContent();
                                }, 50);
                            }
                        });
                    }
                });
            });
            
            // Observe the entire document body for changes
            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
        }
        
        // Real-time currency conversion system
        let exchangeRates = {
            'THB': 1, // Base currency (Thai Baht)
            'USD': 0.031, // 1 THB = 0.031 USD (approximate)
            'CNY': 0.22 // 1 THB = 0.22 CNY (approximate)
        };
        
        // Update exchange rates from external API (simulated for now)
        async function updateExchangeRates() {
            try {
                // In a real implementation, you would fetch from a currency API
                // For now, using approximate rates that update periodically
                const response = await fetch('https://api.exchangerate-api.com/v4/latest/THB');
                if (response.ok) {
                    const data = await response.json();
                    exchangeRates = {
                        'THB': 1,
                        'USD': data.rates.USD || 0.031,
                        'CNY': data.rates.CNY || 0.22
                    };
                    console.log('Exchange rates updated:', exchangeRates);
                }
            } catch (error) {
                console.log('Using fallback exchange rates');
                // Fallback to approximate rates if API fails
                exchangeRates = {
                    'THB': 1,
                    'USD': 0.031,
                    'CNY': 0.22
                };
            }
        }
        
        // Enhanced Language-specific formatting functions with real-time conversion
        function formatCurrency(amount, currency = 'THB') {
            let convertedAmount = amount;
            let targetCurrency = currency;
            
            // Convert amount based on current language
            if (currentLanguage === 'en') {
                targetCurrency = 'USD';
                convertedAmount = amount * exchangeRates.USD;
            } else if (currentLanguage === 'zh') {
                targetCurrency = 'CNY';
                convertedAmount = amount * exchangeRates.CNY;
            } else {
                targetCurrency = 'THB';
                convertedAmount = amount; // Keep original amount for Thai
            }
            
            const formatters = {
                'en': new Intl.NumberFormat('en-US', { 
                    style: 'currency', 
                    currency: targetCurrency,
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                }),
                'th': new Intl.NumberFormat('th-TH', { 
                    style: 'currency', 
                    currency: targetCurrency,
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                }),
                'zh': new Intl.NumberFormat('zh-CN', { 
                    style: 'currency', 
                    currency: targetCurrency,
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                })
            };
            
            const formatter = formatters[currentLanguage] || formatters['en'];
            return formatter.format(convertedAmount);
        }
        
        function formatDate(date) {
            const formatters = {
                'en': new Intl.DateTimeFormat('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                }),
                'th': new Intl.DateTimeFormat('th-TH', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                }),
                'zh': new Intl.DateTimeFormat('zh-CN', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                })
            };
            
            const formatter = formatters[currentLanguage] || formatters['en'];
            return formatter.format(new Date(date));
        }
        
        function formatNumber(number) {
            const formatters = {
                'en': new Intl.NumberFormat('en-US'),
                'th': new Intl.NumberFormat('th-TH'),
                'zh': new Intl.NumberFormat('zh-CN')
            };
            
            const formatter = formatters[currentLanguage] || formatters['en'];
            return formatter.format(number);
        }
        
        // Enhanced formatting functions for different content types
        function formatPrice(price) {
            // Handle different price formats (฿15,999, $15,999, ¥15,999)
            if (typeof price === 'string') {
                // Extract numeric value
                const numericValue = parseFloat(price.replace(/[^\d.]/g, ''));
                if (!isNaN(numericValue)) {
                    return formatCurrency(numericValue, 'THB'); // Always convert from THB base
                }
            } else if (typeof price === 'number') {
                return formatCurrency(price, 'THB'); // Always convert from THB base
            }
            return price;
        }
        
        function formatDateTime(dateTime) {
            const formatters = {
                'en': new Intl.DateTimeFormat('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                }),
                'th': new Intl.DateTimeFormat('th-TH', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                }),
                'zh': new Intl.DateTimeFormat('zh-CN', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                })
            };
            
            const formatter = formatters[currentLanguage] || formatters['en'];
            return formatter.format(new Date(dateTime));
        }
        
        function formatPhoneNumber(phone) {
            // Format phone numbers according to locale
            if (currentLanguage === 'th') {
                // Thai format: +66 8 1234 5678
                return phone.replace(/(\+66)(\d{1})(\d{4})(\d{4})/, '$1 $2 $3 $4');
            } else if (currentLanguage === 'zh') {
                // Chinese format: +86 138 1234 5678
                return phone.replace(/(\+86)(\d{3})(\d{4})(\d{4})/, '$1 $2 $3 $4');
            } else {
                // English format: +1 (555) 123-4567
                return phone.replace(/(\+1)(\d{3})(\d{3})(\d{4})/, '$1 ($2) $3-$4');
            }
        }
        
        // Function to update all prices with new currency conversion
        function updateAllPrices() {
            // Update all price displays with new currency
            const priceElements = document.querySelectorAll('.price, .product-price, [data-price], .product-card .price');
            priceElements.forEach(element => {
                const price = element.textContent || element.getAttribute('data-price');
                if (price) {
                    const formattedPrice = formatPrice(price);
                    if (formattedPrice !== price) {
                        // Add visual feedback for currency change
                        element.classList.add('formatting-change');
                        element.textContent = formattedPrice;
                        // Remove animation class after animation completes
                        setTimeout(() => {
                            element.classList.remove('formatting-change');
                        }, 500);
                    }
                }
            });
            
            // Update product data prices
            if (window.products && Array.isArray(window.products)) {
                window.products.forEach(product => {
                    if (product.price) {
                        const formattedPrice = formatPrice(product.price);
                        // Update the product object
                        product.formattedPrice = formattedPrice;
                    }
                });
            }
        }
        
        // Comprehensive function to update all formatted content
        function updateFormattedContent() {
            // Update all price displays
            const priceElements = document.querySelectorAll('.price, .product-price, [data-price]');
            priceElements.forEach(element => {
                const price = element.textContent || element.getAttribute('data-price');
                if (price) {
                    const formattedPrice = formatPrice(price);
                    if (formattedPrice !== price) {
                        // Add visual feedback for formatting change
                        element.classList.add('formatting-change');
                        element.textContent = formattedPrice;
                        // Remove animation class after animation completes
                        setTimeout(() => {
                            element.classList.remove('formatting-change');
                        }, 500);
                    }
                }
            });
            
            // Update all date displays
            const dateElements = document.querySelectorAll('.date, .product-date, [data-date]');
            dateElements.forEach(element => {
                const date = element.textContent || element.getAttribute('data-date');
                if (date) {
                    try {
                        const formattedDate = formatDate(date);
                        if (formattedDate !== date) {
                            // Add visual feedback for formatting change
                            element.classList.add('formatting-change');
                            element.textContent = formattedDate;
                            // Remove animation class after animation completes
                            setTimeout(() => {
                                element.classList.remove('formatting-change');
                            }, 500);
                        }
                    } catch (e) {
                        // Skip invalid dates
                    }
                }
            });
            
            // Update all number displays
            const numberElements = document.querySelectorAll('.number, .quantity, [data-number]');
            numberElements.forEach(element => {
                const number = element.textContent || element.getAttribute('data-number');
                if (number && !isNaN(parseFloat(number))) {
                    const formattedNumber = formatNumber(parseFloat(number));
                    if (formattedNumber !== number) {
                        // Add visual feedback for formatting change
                        element.classList.add('formatting-change');
                        element.textContent = formattedNumber;
                        // Remove animation class after animation completes
                        setTimeout(() => {
                            element.classList.remove('formatting-change');
                        }, 500);
                    }
                }
            });
            
            // Update phone numbers
            const phoneElements = document.querySelectorAll('.phone, [data-phone]');
            phoneElements.forEach(element => {
                const phone = element.textContent || element.getAttribute('data-phone');
                if (phone && phone.includes('+')) {
                    const formattedPhone = formatPhoneNumber(phone);
                    if (formattedPhone !== phone) {
                        // Add visual feedback for formatting change
                        element.classList.add('formatting-change');
                        element.textContent = formattedPhone;
                        // Remove animation class after animation completes
                        setTimeout(() => {
                            element.classList.remove('formatting-change');
                        }, 500);
                    }
                }
            });
            
            // Update currency symbols in text content (avoid container elements)
            const textElements = document.querySelectorAll('p, span, h1, h2, h3, h4, h5, h6');
            textElements.forEach(element => {
                // Only adjust leaf nodes to avoid flattening containers
                if (element.children && element.children.length > 0) return;
                if (!element.textContent) return;

                let text = element.textContent;

                // Update Thai Baht symbol
                if (currentLanguage === 'th' && text.includes('฿')) {
                    // Keep Thai Baht for Thai
                } else if (currentLanguage === 'zh' && text.includes('฿')) {
                    text = text.replace(/฿/g, '¥');
                    element.textContent = text;
                } else if (currentLanguage === 'en' && text.includes('฿')) {
                    text = text.replace(/฿/g, '$');
                    element.textContent = text;
                }

                // Update other currency symbols
                if (currentLanguage === 'th' && text.includes('$')) {
                    text = text.replace(/\$/g, '฿');
                    element.textContent = text;
                } else if (currentLanguage === 'zh' && text.includes('$')) {
                    text = text.replace(/\$/g, '¥');
                    element.textContent = text;
                }
            });
        }
        
        // Language toggle function
        function toggleLanguage() {
            const languages = ['en', 'th', 'zh'];
            const currentIndex = languages.indexOf(currentLanguage);
            const nextIndex = (currentIndex + 1) % languages.length;
            changeLanguage(languages[nextIndex]);
        }
        
        // Function to get current language info
        function getCurrentLanguageInfo() {
            const languageNames = {
                'en': 'English',
                'th': 'ไทย',
                'zh': '中文'
            };
            
            return {
                code: currentLanguage,
                name: languageNames[currentLanguage],
                flag: currentLanguage === 'en' ? '🇺🇸' : (currentLanguage === 'th' ? '🇹🇭' : '🇨🇳')
            };
        }
        

        
        // Set up keyboard shortcuts for language switching
        function setupLanguageShortcuts() {
            document.addEventListener('keydown', (event) => {
                // Ctrl/Cmd + L to toggle language
                if ((event.ctrlKey || event.metaKey) && event.key === 'l') {
                    event.preventDefault();
                    toggleLanguage();
                }
                
                // Ctrl/Cmd + 1, 2, 3 for specific languages
                if ((event.ctrlKey || event.metaKey) && event.key >= '1' && event.key <= '3') {
                    event.preventDefault();
                    const languages = ['en', 'th', 'zh'];
                    const index = parseInt(event.key) - 1;
                    if (languages[index]) {
                        changeLanguage(languages[index]);
                    }
                }
            });
            
            // Add language toggle button to header
            setTimeout(() => {
                const header = document.querySelector('header');
                if (header && !document.querySelector('.language-toggle-btn')) {
                    const toggleBtn = document.createElement('button');
                    toggleBtn.className = 'language-toggle-btn';
                    toggleBtn.innerHTML = '🌐';
                    toggleBtn.title = 'Toggle Language (Ctrl/Cmd + L)';
                    toggleBtn.onclick = toggleLanguage;
                    
                    // Insert after the language selector
                    const languageSelector = document.querySelector('.language-selector');
                    if (languageSelector) {
                        languageSelector.parentNode.insertBefore(toggleBtn, languageSelector.nextSibling);
                    } else {
                        header.appendChild(toggleBtn);
                    }
                }
            }, 100);
        }
        
        // Function to show current language status
        function showLanguageStatus() {
            const info = getCurrentLanguageInfo();
            const message = `${getText('current_language')}: ${info.flag} ${info.name} (${info.code})`;
            addNotification('info', info.flag + ' ' + info.name, message, 'low');
        }
        
        // Show enhanced language change notification (disabled)
        function showLanguageChangeNotification(lang) {
            return; // disabled
        }
        


        // Load data from localStorage on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadFromStorage();
            
            createDefaultAdmin();
            initializeInventory();
            initializeMarketplace(); // Initialize complete marketplace
            completeMarketplaceSetup(); // Initialize marketplace features
            // Enforce authentication before rendering UI
            enforceAuthGate();
            updateUI();
            
            // Initialize language system: prefer session override, else device language each session
            try {
                const sessionLang = sessionStorage.getItem('eddy_lang_session');
                currentLanguage = sessionLang || getBrowserPreferredLanguage();
            } catch (e) {}
            updateLanguageUI();
            translatePage();
            
            trackPageView();
            trackUserBehavior('page_load', 'Homepage loaded');
            checkForNotifications();
            
            // Initialize display
            updateCartCount();
            updateWishlistCount();
            
            // Start cart abandonment timer only if cart has items
            if (cart.length > 0) {
                startCartAbandonmentTimer();
                setupCartAbandonmentListeners();
            }
            
            // Set up observer for dynamic content translation
            setupLanguageObserver();
            
            // Set up language keyboard shortcuts
            setupLanguageShortcuts();
            
            // Initialize exchange rates for currency conversion
            updateExchangeRates();
            
            // Set up periodic exchange rate updates (every 30 minutes)
            setInterval(updateExchangeRates, 30 * 60 * 1000);
            
            // Initialize countdown timer
            updateCountdown();
            setInterval(updateCountdown, 1000); // Update every second
            
            // Show free shipping popup after 3 seconds except on free-shipping page
            const params = new URLSearchParams(window.location.search);
            if (params.get('page') !== 'free-shipping') {
                setTimeout(showFreeShippingPopup, 3000);
            }

            // Language gate: show only once per session (first open). Hide after language change/selection
            (function() {
                const gate = document.getElementById('languageGate');
                if (!gate) return;
                const shownThisSession = (function() { try { return sessionStorage.getItem('eddy_lang_gate_shown_session') === '1'; } catch (e) { return false; } })();
                if (shownThisSession) { gate.style.display = 'none'; return; }
                gate.style.display = 'flex';
                gate.querySelectorAll('.lang-gate-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const lang = btn.getAttribute('data-lang');
                        if (lang) {
                            try { sessionStorage.setItem('eddy_lang_gate_shown_session', '1'); } catch (e) {}
                            // Skip reload for gate selection to avoid loop
                            window.__skipLanguageReload = true;
                            changeLanguage(lang);
                            gate.style.display = 'none';
                        }
                    });
                });
                translateNewContent(gate);
            })();

        });

        // Initialize complete marketplace
        function initializeMarketplace() {
            // Initialize categories if empty
            if (categories.length === 0) {
                categories = [
                    { id: 1, name: 'Electronics', slug: 'electronics', icon: 'fas fa-mobile-alt', parentId: null },
                    { id: 2, name: 'Fashion', slug: 'fashion', icon: 'fas fa-tshirt', parentId: null },
                    { id: 3, name: 'Home & Living', slug: 'home-living', icon: 'fas fa-home', parentId: null },
                    { id: 4, name: 'Beauty', slug: 'beauty', icon: 'fas fa-spa', parentId: null },
                    { id: 5, name: 'Sports', slug: 'sports', icon: 'fas fa-futbol', parentId: null },
                    { id: 6, name: 'Books', slug: 'books', icon: 'fas fa-book', parentId: null },
                    { id: 7, name: 'Automotive', slug: 'automotive', icon: 'fas fa-car', parentId: null },
                    { id: 8, name: 'Baby & Kids', slug: 'baby-kids', icon: 'fas fa-baby', parentId: null }
                ];
            }

            // Initialize sample shops if empty
            if (shops.length === 0) {
                shops = [
                    {
                        id: 1,
                        name: 'TechPro Store',
                        slug: 'techpro-store',
                        ownerId: 'admin@eddyworld.com',
                        type: 'mall',
                        status: 'verified',
                        logo: '🖥️',
                        description: 'Premium electronics and gadgets',
                        rating: 4.8,
                        totalSales: 1250,
                        badges: ['mall', 'verified', 'top-seller']
                    },
                    {
                        id: 2,
                        name: 'Fashion Forward',
                        slug: 'fashion-forward',
                        ownerId: 'admin@eddyworld.com',
                        type: 'marketplace',
                        status: 'active',
                        logo: '👗',
                        description: 'Trendy fashion and accessories',
                        rating: 4.6,
                        totalSales: 890,
                        badges: ['verified']
                    }
                ];
            }

            // Initialize sample products if empty
            if (products.length === 0) {
                products = [
                    {
                        id: 1,
                        shopId: 1,
                        title: 'Smartphone Pro Max 2024',
                        brand: 'TechPro',
                        categoryId: 1,
                        description: 'Latest smartphone with advanced features, high-resolution camera, and long battery life.',
                        price: 15999,
                        originalPrice: 18999,
                        stock: 50,
                        images: ['📱'],
                        variants: [
                            { id: 1, name: '128GB Black', price: 15999, stock: 25 },
                            { id: 2, name: '256GB Black', price: 17999, stock: 15 },
                            { id: 3, name: '512GB Black', price: 19999, stock: 10 }
                        ],
                        rating: 4.8,
                        reviewCount: 127,
                        tags: ['smartphone', '5G', 'camera'],
                        status: 'active',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 2,
                        shopId: 1,
                        title: 'Gaming Laptop Ultra',
                        brand: 'TechPro',
                        categoryId: 1,
                        description: 'High-performance gaming laptop with RTX graphics and fast refresh rate.',
                        price: 45999,
                        originalPrice: 52999,
                        stock: 25,
                        images: ['💻'],
                        variants: [
                            { id: 4, name: 'RTX 4060 16GB', price: 45999, stock: 15 },
                            { id: 5, name: 'RTX 4070 32GB', price: 55999, stock: 10 }
                        ],
                        rating: 4.6,
                        reviewCount: 89,
                        tags: ['gaming', 'laptop', 'RTX'],
                        status: 'active',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 3,
                        shopId: 2,
                        title: 'Wireless Headphones Pro',
                        brand: 'AudioTech',
                        categoryId: 1,
                        description: 'Premium wireless headphones with noise cancellation and premium sound quality.',
                        price: 2999,
                        originalPrice: 3999,
                        stock: 100,
                        images: ['🎧'],
                        variants: [
                            { id: 6, name: 'Black', price: 2999, stock: 50 },
                            { id: 7, name: 'White', price: 2999, stock: 50 }
                        ],
                        rating: 4.9,
                        reviewCount: 203,
                        tags: ['headphones', 'wireless', 'noise-cancelling'],
                        status: 'active',
                        createdAt: new Date().toISOString()
                    }
                ];
            }

            // Initialize vouchers if empty
            if (vouchers.length === 0) {
                vouchers = [
                    {
                        id: 1,
                        code: 'WELCOME10',
                        type: 'percentage',
                        value: 10,
                        minSpend: 1000,
                        maxDiscount: 500,
                        usageLimit: 1000,
                        usedCount: 0,
                        startDate: new Date().toISOString(),
                        endDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
                        applicableCategories: [1, 2, 3],
                        status: 'active'
                    },
                    {
                        id: 2,
                        code: 'FLASH50',
                        type: 'fixed',
                        value: 50,
                        minSpend: 500,
                        maxDiscount: 50,
                        usageLimit: 500,
                        usedCount: 0,
                        startDate: new Date().toISOString(),
                        endDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
                        applicableCategories: [1],
                        status: 'active'
                    }
                ];
            }

            // Initialize coins system if empty
            if (coins.length === 0) {
                coins = [
                    {
                        userId: 'admin@eddyworld.com',
                        balance: 1000,
                        earned: 1500,
                        spent: 500,
                        transactions: []
                    }
                ];
            }

            // Initialize flash sales if empty
            if (flashSales.length === 0) {
                flashSales = [
                    {
                        id: 1,
                        name: 'Tech Flash Sale',
                        startTime: new Date().toISOString(),
                        endTime: new Date(Date.now() + 2 * 60 * 60 * 1000).toISOString(),
                        status: 'active',
                        products: [
                            { productId: 1, flashPrice: 12999, stockLimit: 20, perUserLimit: 1 },
                            { productId: 2, flashPrice: 39999, stockLimit: 10, perUserLimit: 1 }
                        ]
                    }
                ];
            }

            saveToStorage();
        }

        // Initialize inventory system
        function initializeInventory() {
            if (Object.keys(inventory).length === 0) {
                inventory = {
                    1: { stock: 50, lowStock: 10, reserved: 0 },
                    2: { stock: 25, lowStock: 5, reserved: 0 },
                    3: { stock: 100, lowStock: 20, reserved: 0 },
                    4: { stock: 30, lowStock: 8, reserved: 0 },
                    5: { stock: 40, lowStock: 12, reserved: 0 },
                    6: { stock: 60, lowStock: 15, reserved: 0 }
                };
                saveToStorage();
            }
        }

        // Notification system
        function addNotification(type, title, message, priority = 'normal') {
            const notification = {
                id: Date.now(),
                type: type, // 'info', 'success', 'warning', 'error'
                title: title,
                message: message,
                priority: priority, // 'low', 'normal', 'high', 'urgent'
                timestamp: new Date().toISOString(),
                read: false
            };
            
            notifications.unshift(notification);
            if (notifications.length > 50) notifications = notifications.slice(0, 50); // Keep only last 50
            
            saveToStorage();
            showNotificationBadge();
            
            // Auto-show urgent notifications
            if (priority === 'urgent') {
                showNotificationPopup(notification);
            }
        }

        // Show notification badge
        function showNotificationBadge() {
            const unreadCount = notifications.filter(n => !n.read).length;
            let badge = document.querySelector('.notification-badge');
            
            if (!badge && unreadCount > 0) {
                badge = document.createElement('span');
                badge.className = 'notification-badge';
                badge.style.cssText = `
                    position: absolute;
                    top: -5px;
                    right: -5px;
                    background: #ff4444;
                    color: white;
                    border-radius: 50%;
                    width: 20px;
                    height: 20px;
                    font-size: 11px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-weight: bold;
                `;
                
                const notificationIcon = document.querySelector('.notification-icon');
                if (notificationIcon) {
                    notificationIcon.appendChild(badge);
                }
            }
            
            if (badge) {
                badge.textContent = unreadCount;
                badge.style.display = unreadCount > 0 ? 'flex' : 'none';
            }
        }
        // Show notification popup
        function showNotificationPopup(notification) {
            const popup = document.createElement('div');
            popup.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: white;
                border-left: 4px solid ${getNotificationColor(notification.type)};
                padding: 15px;
                border-radius: 8px;
                box-shadow: 0 5px 20px rgba(0,0,0,0.2);
                z-index: 3000;
                max-width: 300px;
                animation: slideInRight 0.3s ease-out;
            `;
            
            popup.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <div>
                        <h4 style="margin: 0 0 5px 0; color: #333;">${notification.title}</h4>
                        <p style="margin: 0; color: #666; font-size: 14px;">${notification.message}</p>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; font-size: 18px; cursor: pointer; color: #999;">&times;</button>
                </div>
            `;
            
            document.body.appendChild(popup);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (popup.parentElement) {
                    popup.remove();
                }
            }, 5000);
        }

        // Get notification color
        function getNotificationColor(type) {
            const colors = {
                'info': '#667eea',
                'success': '#4caf50',
                'warning': '#ff9800',
                'error': '#f44336'
            };
            return colors[type] || '#667eea';
        }

        // Check for notifications
        function checkForNotifications() {
            // Check for low stock
            Object.keys(inventory).forEach(productId => {
                const item = inventory[productId];
                if (item.stock <= item.lowStock && item.stock > 0) {
                    addNotification('warning', 'Low Stock Alert', `Product ID ${productId} is running low on stock (${item.stock} remaining)`, 'high');
                }
            });
            
            // Check for pending orders
            const pendingOrders = orders.filter(order => order.status === 'Pending');
            if (pendingOrders.length > 0) {
                addNotification('info', 'Pending Orders', `${pendingOrders.length} orders awaiting processing`, 'normal');
            }
        }

        // Show chat interface
        function showChat(shopId = null) {
            if (!currentUser) {
                alert('Please login to view your chats.');
                return;
            }
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            let chatHTML = '';
            
            if (shopId) {
                // Show chat with specific shop
                const shop = shops.find(s => s.id === shopId);
                if (shop) {
                    chatHTML = `
                        <div style="background: white; padding: 30px; border-radius: 20px; max-width: 800px; width: 95%; max-height: 80vh; overflow-y: auto;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                                <h2 style="color: #667eea; margin: 0;">💬 Chat with ${shop.name}</h2>
                                <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                            </div>
                            
                            <div style="background: #f8f9fa; border-radius: 15px; padding: 20px; margin-bottom: 20px; min-height: 300px;">
                                <p style="text-align: center; color: #666;">Chat interface will be displayed here</p>
                                <p style="text-align: center; color: #999; font-size: 12px;">This is a demo chat system</p>
                            </div>
                            
                            <div style="display: flex; gap: 10px;">
                                <input type="text" placeholder="Type your message..." style="flex: 1; padding: 12px; border: 2px solid #e0e0e0; border-radius: 15px; font-size: 14px;">
                                <button style="padding: 12px 25px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 15px; cursor: pointer; font-weight: 500;">
                                    Send
                                </button>
                            </div>
                        </div>
                    `;
                }
            } else {
                // Show all chat threads
                const userChats = chatThreads.filter(thread => 
                    thread.buyerId === currentUser.email || 
                    shops.find(s => s.ownerId === currentUser.email)?.id === thread.shopId
                );
                
                chatHTML = `
                    <div style="background: white; padding: 30px; border-radius: 20px; max-width: 800px; width: 95%; max-height: 80vh; overflow-y: auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                            <h2 style="color: #667eea; margin: 0;">💬 My Chats</h2>
                            <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                        </div>
                        
                        ${userChats.length === 0 ? 
                            '<p style="text-align: center; color: #666;">No chat threads yet. Start shopping to begin conversations with sellers!</p>' :
                            userChats.map(thread => {
                                const shop = shops.find(s => s.id === thread.shopId);
                                const order = orders.find(o => o.id === thread.orderId);
                                return `
                                    <div style="background: #f8f9fa; border-radius: 15px; padding: 20px; margin-bottom: 15px; cursor: pointer;" onclick="openChatThread(${thread.id})">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <div>
                                                <h4 style="margin: 0; color: #333;">${shop ? shop.name : 'Unknown Shop'}</h4>
                                                <p style="margin: 5px 0 0 0; color: #666;">Order: #${thread.orderId}</p>
                                            </div>
                                            <div style="text-align: right;">
                                                <small style="color: #999;">${new Date(thread.createdAt).toLocaleDateString()}</small>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')
                        }
                    </div>
                `;
            }
            
            modal.innerHTML = chatHTML;
            modal.classList.add('modal');
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Earn coins for user
        function earnCoins(amount, reason) {
            if (!currentUser) return;
            
            let userCoins = coins.find(c => c.userId === currentUser.email);
            if (!userCoins) {
                userCoins = {
                    userId: currentUser.email,
                    balance: 0,
                    history: []
                };
                coins.push(userCoins);
            }
            
            userCoins.balance += amount;
            userCoins.history.push({
                type: 'earned',
                amount: amount,
                reason: reason,
                timestamp: new Date().toISOString()
            });
            
            saveToStorage();
            addNotification('success', 'Coins Earned', `You earned ${amount} coins for ${reason}!`, 'normal');
        }

        // Apply voucher to cart
        function applyVoucher(voucherCode) {
            const voucher = vouchers.find(v => v.code === voucherCode && v.status === 'active');
            if (!voucher) {
                addNotification('error', 'Invalid Voucher', 'Voucher code is invalid or expired.', 'normal');
                return false;
            }
            
            // Check minimum spend
            if (cartTotal < voucher.minSpend) {
                addNotification('error', 'Minimum Spend Required', `Minimum spend of ฿${voucher.minSpend} required for this voucher.`, 'normal');
                return false;
            }
            
            // Check usage limit
            if (voucher.usageLimit && voucher.usageCount >= voucher.usageLimit) {
                addNotification('error', 'Voucher Limit Reached', 'This voucher has reached its usage limit.', 'normal');
                return false;
            }
            
            // Apply voucher
            const discount = calculateVoucherDiscount(voucher, cartTotal);
            cartTotal -= discount;
            
            // Update voucher usage
            voucher.usageCount = (voucher.usageCount || 0) + 1;
            if (voucher.usageCount >= voucher.usageLimit) {
                voucher.status = 'expired';
            }
            
            saveToStorage();
            updateCartTotal();
            
            addNotification('success', 'Voucher Applied', `Voucher applied! You saved ฿${discount.toLocaleString()}.`, 'normal');
            return true;
        }

        // Calculate voucher discount
        function calculateVoucherDiscount(voucher, itemTotal) {
            if (voucher.type === 'percentage') {
                return (itemTotal * voucher.value) / 100;
            } else if (voucher.type === 'fixed') {
                return Math.min(voucher.value, itemTotal);
            }
            return 0;
        }

        // Calculate total voucher discount
        function calculateTotalVoucherDiscount() {
            // This would calculate total discount from all applied vouchers
            return 0; // Placeholder
        }

        // Get flash sale price for product
        function getFlashSalePrice(productId) {
            const flashSale = flashSales.find(fs => 
                fs.status === 'active' && 
                fs.products.some(p => p.productId === productId)
            );
            
            if (flashSale) {
                const product = flashSale.products.find(p => p.productId === productId);
                return product ? product.salePrice : null;
            }
            return null;
        }

        // Check if product is in flash sale
        function isProductInFlashSale(productId) {
            return flashSales.some(fs => 
                fs.status === 'active' && 
                fs.products.some(p => p.productId === productId)
            );
        }

        // Get flash sale countdown
        function getFlashSaleCountdown() {
            const activeFlashSale = flashSales.find(fs => fs.status === 'active');
            if (!activeFlashSale) return null;
            
            const now = new Date();
            const endTime = new Date(activeFlashSale.endTime);
            const timeLeft = endTime - now;
            
            if (timeLeft <= 0) return null;
            
            const hours = Math.floor(timeLeft / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
            
            return { hours, minutes, seconds };
        }

        // Update cart total with voucher discounts
        function updateCartTotal() {
            cartTotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            // Apply voucher discounts here if needed
            return cartTotal;
        }

        // Redeem coins
        function redeemCoins(amount) {
            if (!currentUser) return false;
            
            const userCoins = coins.find(c => c.userId === currentUser.email);
            if (!userCoins || userCoins.balance < amount) {
                addNotification('error', 'Insufficient Coins', 'You don\'t have enough coins to redeem.', 'normal');
                return false;
            }
            
            userCoins.balance -= amount;
            userCoins.history.push({
                type: 'redeemed',
                amount: amount,
                reason: 'Coins redeemed',
                timestamp: new Date().toISOString()
            });
            
            saveToStorage();
            addNotification('success', 'Coins Redeemed', `Successfully redeemed ${amount} coins!`, 'normal');
            return true;
        }

        // Get user coins balance
        function getUserCoinsBalance() {
            if (!currentUser) return 0;
            
            const userCoins = coins.find(c => c.userId === currentUser.email);
            return userCoins ? userCoins.balance : 0;
        }

        // Get seller dashboard data
        function getSellerDashboardData(shopId) {
            const shopProducts = products.filter(p => p.shopId === shopId);
            const shopOrders = orders.filter(o => o.shopId === shopId);
            const totalRevenue = shopOrders.reduce((sum, order) => sum + order.total, 0);
            
            return {
                totalProducts: shopProducts.length,
                totalOrders: shopOrders.length,
                totalRevenue: totalRevenue,
                pendingOrders: shopOrders.filter(o => o.status === 'pending').length,
                completedOrders: shopOrders.filter(o => o.status === 'completed').length
            };
        }

        // Show seller dashboard
        function showSellerDashboard() {
            const userShop = shops.find(shop => shop.ownerId === currentUser.email);
            
            if (!userShop) {
                showShopCreation();
                return;
            }
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            const shopData = getSellerDashboardData(userShop.id);
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 20px; max-width: 1000px; width: 95%; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2 style="color: #667eea; margin: 0;">🏪 ${userShop.name} Dashboard</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    
                    <div style="background: #f8f9fa; border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="margin: 0 0 20px 0; color: #333;">Shop Overview</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                            <div style="background: white; padding: 20px; border-radius: 15px; text-align: center; border-left: 4px solid #28a745;">
                                <h4 style="margin: 0; color: #28a745; font-size: 16px;">Total Products</h4>
                                <p style="font-size: 24px; font-weight: bold; margin: 5px 0 0 0; color: #333;">${shopData.totalProducts}</p>
                            </div>
                            <div style="background: white; padding: 20px; border-radius: 15px; text-align: center; border-left: 4px solid #ffc107;">
                                <h4 style="margin: 0; color: #ffc107; font-size: 16px;">Total Orders</h4>
                                <p style="font-size: 24px; font-weight: bold; margin: 5px 0 0 0; color: #333;">${shopData.totalOrders}</p>
                            </div>
                            <div style="background: white; padding: 20px; border-radius: 15px; text-align: center; border-left: 4px solid #667eea;">
                                <h4 style="margin: 0; color: #667eea; font-size: 16px;">Total Revenue</h4>
                                <p style="font-size: 24px; font-weight: bold; margin: 5px 0 0 0; color: #333;">฿${shopData.totalRevenue.toLocaleString()}</p>
                            </div>
                            <div style="background: white; padding: 20px; border-radius: 15px; text-align: center; border-left: 4px solid #17a2b8;">
                                <h4 style="margin: 0; color: #17a2b8; font-size: 16px;">Shop Rating</h4>
                                <p style="font-size: 24px; font-weight: bold; margin: 5px 0 0 0; color: #333;">${userShop.rating.toFixed(1)}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #f8f9fa; border-radius: 15px; padding: 20px;">
                        <h3 style="margin: 0 0 20px 0; color: #333;">Quick Actions</h3>
                        <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                            <button onclick="showProductManagement()" style="padding: 12px 25px; background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                                📦 Manage Products
                            </button>
                            <button onclick="showOrderManagement()" style="padding: 12px 25px; background: linear-gradient(135deg, #ffc107, #fd7e14); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                                📋 Manage Orders
                            </button>
                            <button onclick="showShopSettings()" style="padding: 12px 25px; background: linear-gradient(135deg, #17a2b8, #6f42c1); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                                ⚙️ Shop Settings
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            modal.classList.add('modal');
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Create new shop
        function createShop(shopData) {
            const newShop = {
                id: ++shopCounter,
                name: shopData.name,
                slug: shopData.name.toLowerCase().replace(/\s+/g, '-'),
                ownerId: shopData.ownerId,
                type: shopData.type,
                status: shopData.status,
                logo: shopData.logo,
                description: shopData.description,
                rating: 0,
                totalSales: 0,
                badges: [],
                createdAt: new Date().toISOString()
            };
            
            shops.push(newShop);
            saveToStorage();
            
            addNotification('success', 'Shop Created', `${shopData.name} has been created successfully!`, 'normal');
            
            return newShop;
        }

        // Handle shop creation
        function handleShopCreation(event) {
            event.preventDefault();
            
            const shopName = document.getElementById('shopName').value;
            const shopDescription = document.getElementById('shopDescription').value;
            const shopType = document.getElementById('shopType').value;
            const shopLogo = document.getElementById('shopLogo').value;
            
            if (!shopName || !shopDescription || !shopType || !shopLogo) {
                alert('Please fill in all fields.');
                return;
            }
            
            const shopData = {
                name: shopName,
                description: shopDescription,
                type: shopType,
                logo: shopLogo,
                ownerId: currentUser.email,
                status: 'pending'
            };
            
            const newShop = createShop(shopData);
            
            if (newShop) {
                alert('Shop created successfully! It will be reviewed by our team.');
                document.querySelector('.modal').remove();
                showSellerDashboard();
            } else {
                alert('Failed to create shop. Please try again.');
            }
        }

        // Show shop creation form
        function showShopCreation() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 20px; max-width: 600px; width: 95%; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2 style="color: #667eea; margin: 0;">🏪 Create Your Shop</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    
                    <form onsubmit="handleShopCreation(event)">
                        <div class="form-group">
                            <label for="shopName">Shop Name</label>
                            <input type="text" id="shopName" required placeholder="Enter your shop name">
                        </div>
                        
                        <div class="form-group">
                            <label for="shopDescription">Shop Description</label>
                            <textarea id="shopDescription" required placeholder="Describe what your shop sells" style="width: 100%; padding: 15px; border: 2px solid #e0e0e0; border-radius: 15px; box-sizing: border-box; font-size: 14px; transition: all 0.3s ease; background: #fafafa; min-height: 100px; resize: vertical;"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="shopType">Shop Type</label>
                            <select id="shopType" required style="width: 100%; padding: 15px; border: 2px solid #e0e0e0; border-radius: 15px; box-sizing: border-box; font-size: 14px; transition: all 0.3s ease; background: #fafafa;">
                                <option value="">Select shop type</option>
                                <option value="marketplace">Marketplace</option>
                                <option value="mall">Mall</option>
                                <option value="boutique">Boutique</option>
                                <option value="specialty">Specialty Store</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="shopLogo">Shop Logo (Emoji)</label>
                            <input type="text" id="shopLogo" required placeholder="🏪" maxlength="2" style="text-align: center; font-size: 24px;">
                        </div>
                        
                        <button type="submit" class="btn-primary">Create Shop</button>
                    </form>
                </div>
            `;
            
            modal.classList.add('modal');
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Add to cart from live session
        function addToCartFromLive(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                addToCart(productId, product.title, product.price);
            }
        }

        // Send live chat message
        function sendLiveChatMessage(sessionId) {
            const messageInput = document.getElementById('liveChatInput');
            if (!messageInput || !messageInput.value.trim()) return;
            
            const session = liveSessions.find(s => s.id === sessionId);
            if (!session) return;
            
            const message = {
                id: Date.now(),
                content: messageInput.value.trim(),
                senderId: currentUser.email,
                timestamp: new Date().toISOString()
            };
            
            if (!session.chat) session.chat = [];
            session.chat.push(message);
            
            saveToStorage();
            messageInput.value = '';
            
            // Update chat display
            const chatContainer = document.getElementById('liveChatMessages');
            if (chatContainer) {
                const messageDiv = document.createElement('div');
                messageDiv.style.cssText = 'margin-bottom: 10px; text-align: right;';
                messageDiv.innerHTML = `
                    <div style="display: inline-block; max-width: 70%; background: #667eea; color: white; padding: 8px 12px; border-radius: 15px; text-align: left;">
                        <p style="margin: 0; font-size: 14px;">${message.content}</p>
                        <small style="opacity: 0.7; font-size: 11px;">${new Date(message.timestamp).toLocaleTimeString()}</small>
                    </div>
                `;
                chatContainer.appendChild(messageDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
        }

        // Simulate live chat
        function simulateLiveChat(sessionId) {
            const session = liveSessions.find(s => s.id === sessionId);
            if (!session) return;
            
            const chatContainer = document.getElementById('liveChatMessages');
            if (!chatContainer) return;
            
            // Clear existing content
            chatContainer.innerHTML = '';
            
            // Add some sample messages
            const sampleMessages = [
                { content: 'Welcome to the live stream! 🎉', senderId: 'system' },
                { content: 'This product looks amazing!', senderId: 'user1@example.com' },
                { content: 'How long is the sale going on?', senderId: 'user2@example.com' },
                { content: 'Just ordered! Can\'t wait to receive it', senderId: 'user3@example.com' }
            ];
            
            sampleMessages.forEach(msg => {
                const messageDiv = document.createElement('div');
                messageDiv.style.cssText = 'margin-bottom: 10px; text-align: left;';
                messageDiv.innerHTML = `
                    <div style="display: inline-block; max-width: 70%; background: #e9ecef; color: #333; padding: 8px 12px; border-radius: 15px; text-align: left;">
                        <p style="margin: 0; font-size: 14px;">${msg.content}</p>
                        <small style="opacity: 0.7; font-size: 11px;">${new Date().toLocaleTimeString()}</small>
                    </div>
                `;
                chatContainer.appendChild(messageDiv);
            });
            
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Join live session
        function joinLiveSession(sessionId) {
            const session = liveSessions.find(s => s.id === sessionId);
            if (!session) return;
            
            const shop = shops.find(s => s.id === session.shopId);
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 20px; max-width: 1200px; width: 95%; max-height: 90vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2 style="color: #667eea; margin: 0;">📺 ${session.title}</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px;">
                        <div>
                            <div style="background: #000; border-radius: 15px; height: 400px; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; margin-bottom: 20px;">
                                🎥 Live Stream - ${shop ? shop.name : 'Unknown Shop'}
                            </div>
                            
                            ${session.pinnedProducts && session.pinnedProducts.length > 0 ? `
                                <div style="background: #f8f9fa; border-radius: 15px; padding: 20px;">
                                    <h3 style="margin: 0 0 20px 0; color: #333;">📌 Pinned Products</h3>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                        ${session.pinnedProducts.map(productId => {
                                            const product = products.find(p => p.id === productId);
                                            if (!product) return '';
                                            return `
                                                <div style="background: white; border-radius: 10px; padding: 15px; text-align: center;">
                                                    <div style="font-size: 32px; margin-bottom: 10px;">${product.images[0] || '📦'}</div>
                                                    <h4 style="margin: 0 0 10px 0; color: #333;">${product.title}</h4>
                                                    <p style="margin: 0 0 15px 0; color: #667eea; font-weight: bold;">฿${product.price.toLocaleString()}</p>
                                                    <button onclick="addToCartFromLive(${product.id})" style="padding: 8px 16px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 12px;">
                                                        Add to Cart
                                                    </button>
                                                </div>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                        
                        <div>
                            <div style="background: #f8f9fa; border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                                <h3 style="margin: 0 0 20px 0; color: #333;">💬 Live Chat</h3>
                                <div id="liveChatMessages" style="height: 300px; overflow-y: auto; margin-bottom: 15px; padding: 10px; background: white; border-radius: 10px;">
                                    <p style="text-align: center; color: #666; font-size: 12px;">Chat will appear here</p>
                                </div>
                                <div style="display: flex; gap: 10px;">
                                    <input type="text" id="liveChatInput" placeholder="Type your message..." style="flex: 1; padding: 10px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 14px;">
                                    <button onclick="sendLiveChatMessage(${session.id})" style="padding: 10px 20px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: 500;">
                                        Send
                                    </button>
                                </div>
                            </div>
                            
                            <div style="background: #f8f9fa; border-radius: 15px; padding: 20px;">
                                <h3 style="margin: 0 0 20px 0; color: #333;">📊 Session Info</h3>
                                <p><strong>Shop:</strong> ${shop ? shop.name : 'Unknown'}</p>
                                <p><strong>Status:</strong> <span style="background: #ff4444; color: white; padding: 2px 8px; border-radius: 8px; font-size: 11px;">LIVE</span></p>
                                <p><strong>Started:</strong> ${new Date(session.startedAt).toLocaleTimeString()}</p>
                                <p><strong>Viewers:</strong> ${session.viewerCount || 0}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            modal.classList.add('modal');
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            // Simulate live chat
            simulateLiveChat(session.id);
        }

        // Show live shopping interface
        function showLiveShopping() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            const activeSessions = liveSessions.filter(session => session.status === 'live');
            const upcomingSessions = liveSessions.filter(session => session.status === 'scheduled');
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 20px; max-width: 1000px; width: 95%; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2 style="color: #667eea; margin: 0;">📺 Live Shopping</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    
                    ${activeSessions.length > 0 ? `
                        <div style="background: #f8f9fa; border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                            <h3 style="margin: 0 0 20px 0; color: #333;">🔥 Live Now</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                                ${activeSessions.map(session => {
                                    const shop = shops.find(s => s.id === session.shopId);
                                    return `
                                        <div style="background: white; border-radius: 15px; padding: 20px; border-left: 4px solid #ff4444;">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                                <h4 style="margin: 0; color: #333;">${session.title}</h4>
                                                <span style="background: #ff4444; color: white; padding: 3px 10px; border-radius: 10px; font-size: 12px;">LIVE</span>
                                            </div>
                                            <p style="margin: 0 0 15px 0; color: #666;">${session.description}</p>
                                            <p style="margin: 0 0 15px 0; color: #999; font-size: 12px;">Shop: ${shop ? shop.name : 'Unknown'}</p>
                                            <button onclick="joinLiveSession(${session.id})" style="padding: 10px 20px; background: linear-gradient(135deg, #ff4444, #ff6b6b); color: white; border: none; border-radius: 15px; cursor: pointer; font-weight: 500;">
                                                🎥 Join Live
                                            </button>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    ${upcomingSessions.length > 0 ? `
                        <div style="background: #f8f9fa; border-radius: 15px; padding: 20px;">
                            <h3 style="margin: 0 0 20px 0; color: #333;">📅 Upcoming</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                                ${upcomingSessions.map(session => {
                                    const shop = shops.find(s => s.id === session.shopId);
                                    return `
                                        <div style="background: white; border-radius: 15px; padding: 20px; border-left: 4px solid #667eea;">
                                            <h4 style="margin: 0; color: #333;">${session.title}</h4>
                                            <p style="margin: 5px 0 15px 0; color: #666;">${session.description}</p>
                                            <p style="margin: 0 0 15px 0; color: #999; font-size: 12px;">Shop: ${shop ? shop.name : 'Unknown'}</p>
                                            <p style="margin: 0; color: #667eea; font-size: 12px;">Starts: ${new Date(session.scheduledAt).toLocaleString()}</p>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    ${activeSessions.length === 0 && upcomingSessions.length === 0 ? 
                        '<p style="text-align: center; color: #666;">No live sessions available at the moment. Check back later!</p>' : ''
                    }
                </div>
            `;
            
            modal.classList.add('modal');
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }
        // Send chat message from thread
        function sendChatMessageFromThread(threadId) {
            const messageInput = document.getElementById('chatMessageInput');
            if (!messageInput || !messageInput.value.trim()) return;
            
            const thread = chatThreads.find(t => t.id === threadId);
            if (!thread) return;
            
            const message = {
                id: Date.now(),
                content: messageInput.value.trim(),
                senderId: currentUser.email,
                timestamp: new Date().toISOString()
            };
            
            if (!thread.messages) thread.messages = [];
            thread.messages.push(message);
            
            saveToStorage();
            messageInput.value = '';
            
            // Refresh the chat view
            openChatThread(threadId);
        }

        // Open specific chat thread
        function openChatThread(threadId) {
            const thread = chatThreads.find(t => t.id === threadId);
            if (!thread) return;
            
            const shop = shops.find(s => s.id === thread.shopId);
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 20px; max-width: 800px; width: 95%; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2 style="color: #667eea; margin: 0;">💬 Chat with ${shop ? shop.name : 'Unknown Shop'}</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    
                    <div style="background: #f8f9fa; border-radius: 15px; padding: 20px; margin-bottom: 20px; min-height: 300px; max-height: 400px; overflow-y: auto;">
                        ${thread.messages && thread.messages.length > 0 ? 
                            thread.messages.map(msg => `
                                <div style="margin-bottom: 15px; text-align: ${msg.senderId === currentUser.email ? 'right' : 'left'};">
                                    <div style="display: inline-block; max-width: 70%; background: ${msg.senderId === currentUser.email ? '#667eea' : '#e9ecef'}; color: ${msg.senderId === currentUser.email ? 'white' : '#333'}; padding: 10px 15px; border-radius: 15px; text-align: left;">
                                        <p style="margin: 0; font-size: 14px;">${msg.content}</p>
                                        <small style="opacity: 0.7; font-size: 11px;">${new Date(msg.timestamp).toLocaleTimeString()}</small>
                                    </div>
                                </div>
                            `).join('') :
                            '<p style="text-align: center; color: #666;">No messages yet. Start the conversation!</p>'
                        }
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="chatMessageInput" placeholder="Type your message..." style="flex: 1; padding: 12px; border: 2px solid #e0e0e0; border-radius: 15px; font-size: 14px;">
                        <button onclick="sendChatMessageFromThread(${threadId})" style="padding: 12px 25px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 15px; cursor: pointer; font-weight: 500;">
                            Send
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.add('modal');
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Show user profile
        function showUserProfile() {
            if (!currentUser) {
                alert('Please login to view your profile.');
                return;
            }
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 20px; max-width: 600px; width: 95%; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2 style="color: #667eea; margin: 0;">👤 User Profile</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    
                    <div style="background: #f8f9fa; border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="margin: 0 0 20px 0; color: #333;">Profile Information</h3>
                        <p><strong>Name:</strong> ${currentUser.name}</p>
                        <p><strong>Email:</strong> ${currentUser.email}</p>
                        ${currentUser.phone ? `<p><strong>Phone:</strong> ${currentUser.phone}</p>` : ''}
                        <p><strong>Role:</strong> <span style="background: ${currentUser.role === 'admin' ? '#dc3545' : '#28a745'}; color: white; padding: 3px 10px; border-radius: 10px; font-size: 12px;">${currentUser.role}</span></p>
                        <p><strong>Coins Balance:</strong> ${getUserCoinsBalance()} coins</p>
                        <p><strong>Language:</strong> ${getCurrentLanguageInfo().flag} ${getCurrentLanguageInfo().name}</p>
                    </div>
                    
                    <div style="background: #f8f9fa; border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="margin: 0 0 20px 0; color: #333;">Quick Actions</h3>
                        <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                            <button onclick="showWishlist()" style="padding: 12px 25px; background: linear-gradient(135deg, #ff6b6b, #ffa500); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                                ❤️ My Wishlist
                            </button>
                            <button onclick="showOrderHistory()" style="padding: 12px 25px; background: linear-gradient(135deg, #4ecdc4, #44a08d); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                                📦 My Orders
                            </button>
                            <button onclick="showChat()" style="padding: 12px 25px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                                💬 My Chats
                            </button>
                            ${currentUser.role === 'admin' ? `
                                <button onclick="showAdminDashboard()" style="padding: 12px 25px; background: linear-gradient(135deg, #dc3545, #e83e8c); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                                    👑 Admin Panel
                                </button>
                            ` : ''}
                        </div>
                    </div>
                    
                    <div style="background: #f8f9fa; border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="margin: 0 0 20px 0; color: #333;">Language Preferences</h3>
                        <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-bottom: 20px;">
                            <button onclick="changeLanguage('en')" style="padding: 12px 25px; background: ${currentLanguage === 'en' ? 'linear-gradient(135deg, #28a745, #20c997)' : 'linear-gradient(135deg, #6c757d, #495057)'}; color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                                🇺🇸 English
                            </button>
                            <button onclick="changeLanguage('th')" style="padding: 12px 25px; background: ${currentLanguage === 'th' ? 'linear-gradient(135deg, #28a745, #20c997)' : 'linear-gradient(135deg, #6c757d, #495057)'}; color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                                🇹🇭 ไทย
                            </button>
                            <button onclick="changeLanguage('zh')" style="padding: 12px 25px; background: ${currentLanguage === 'zh' ? 'linear-gradient(135deg, #28a745, #20c997)' : 'linear-gradient(135deg, #6c757d, #495057)'}; color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                                🇨🇳 中文
                            </button>
                        </div>
                        <p style="text-align: center; color: #666; font-size: 12px;">
                            💡 Use keyboard shortcuts: Ctrl/Cmd + L to cycle, Ctrl/Cmd + 1/2/3 for specific languages
                        </p>
                    </div>
                    
                    <div style="background: #f8f9fa; border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="margin: 0 0 20px 0; color: #333;">Data Management</h3>
                        <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                            <button onclick="exportUserData()" style="padding: 12px 25px; background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                                💾 Export My Data
                            </button>
                            <button onclick="importUserData()" style="padding: 12px 25px; background: linear-gradient(135deg, #17a2b8, #6f42c1); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                                📥 Import My Data
                            </button>
                            <button onclick="backupUserData()" style="padding: 12px 25px; background: linear-gradient(135deg, #ffc107, #fd7e14); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                                🔒 Backup Account
                            </button>
                        </div>
                        <p style="text-align: center; margin-top: 15px; color: #666; font-size: 12px;">
                            💡 Your data is automatically saved every 30 seconds and when you close the page
                        </p>
                    </div>
                    
                    <div style="text-align: center;">
                        <button onclick="logout()" style="padding: 12px 25px; background: linear-gradient(135deg, #6c757d, #495057); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                            🚪 Logout
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.add('modal');
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Show notifications panel
        function showNotifications() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            const unreadNotifications = notifications.filter(n => !n.read);
            const readNotifications = notifications.filter(n => n.read);
            
            let notificationsHTML = `
                <div style="background: white; padding: 25px; border-radius: 20px; max-width: 600px; width: 95%; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="color: #667eea; margin: 0;">🔔 Notifications</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
            `;
            
            if (unreadNotifications.length === 0 && readNotifications.length === 0) {
                notificationsHTML += '<p style="text-align: center; color: #666;">No notifications yet.</p>';
            } else {
                if (unreadNotifications.length > 0) {
                    notificationsHTML += '<h3 style="color: #667eea; margin-bottom: 15px;">📬 Unread</h3>';
                    unreadNotifications.forEach(notification => {
                        notificationsHTML += createNotificationHTML(notification, true);
                    });
                }
                
                if (readNotifications.length > 0) {
                    notificationsHTML += '<h3 style="color: #999; margin: 15px 0;">📭 Read</h3>';
                    readNotifications.forEach(notification => {
                        notificationsHTML += createNotificationHTML(notification, false);
                    });
                }
            }
            
            notificationsHTML += '</div>';
            modal.innerHTML = notificationsHTML;
            
            modal.classList.add('modal');
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Create notification HTML
        function createNotificationHTML(notification, isUnread) {
            const priorityColors = {
                'low': '#4caf50',
                'normal': '#667eea',
                'high': '#ff9800',
                'urgent': '#f44336'
            };
            
            return `
                <div style="border: 1px solid #eee; border-radius: 10px; padding: 15px; margin-bottom: 15px; background: ${isUnread ? '#f8f9fa' : '#fafafa'}; border-left: 4px solid ${getNotificationColor(notification.type)};">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                        <div>
                            <h4 style="margin: 0 0 5px 0; color: #333; font-size: 16px;">${notification.title}</h4>
                            <p style="margin: 0; color: #666; font-size: 14px;">${notification.message}</p>
                        </div>
                        <div style="text-align: right;">
                            <span style="background: ${priorityColors[notification.priority]}; color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px; margin-bottom: 5px; display: inline-block;">${notification.priority}</span>
                            <br>
                            <small style="color: #999;">${new Date(notification.timestamp).toLocaleString()}</small>
                        </div>
                    </div>
                    ${isUnread ? `<button onclick="markNotificationRead(${notification.id})" style="padding: 5px 10px; background: #667eea; color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 12px;">Mark as Read</button>` : ''}
                </div>
            `;
        }

        // Mark notification as read
        function markNotificationRead(notificationId) {
            const notification = notifications.find(n => n.id === notificationId);
            if (notification) {
                notification.read = true;
                saveToStorage();
                showNotifications(); // Refresh the view
            }
        }

        // Storage functions
        function saveToStorage() {
            // Save all user data permanently
            localStorage.setItem('eddyWorldCart', JSON.stringify(cart));
            localStorage.setItem('eddyWorldWishlist', JSON.stringify(wishlist));
            localStorage.setItem('eddyWorldUsers', JSON.stringify(users));
            localStorage.setItem('eddyWorldCurrentUser', JSON.stringify(currentUser));
            localStorage.setItem('eddyWorldOrders', JSON.stringify(orders));
            localStorage.setItem('eddyWorldOrderCounter', JSON.stringify(orderCounter));
            localStorage.setItem('eddyWorldCustomerData', JSON.stringify(customerData));
            
            // Save marketplace data permanently
            localStorage.setItem('eddyWorldShops', JSON.stringify(shops));
            localStorage.setItem('eddyWorldProducts', JSON.stringify(products));
            localStorage.setItem('eddyWorldCategories', JSON.stringify(categories));
            localStorage.setItem('eddyWorldInventory', JSON.stringify(inventory));
            localStorage.setItem('eddyWorldVouchers', JSON.stringify(vouchers));
            localStorage.setItem('eddyWorldCoins', JSON.stringify(coins));
            localStorage.setItem('eddyWorldEscrowTransactions', JSON.stringify(escrowTransactions));
            localStorage.setItem('eddyWorldReturns', JSON.stringify(returns));
            localStorage.setItem('eddyWorldChatThreads', JSON.stringify(chatThreads));
            localStorage.setItem('eddyWorldLiveSessions', JSON.stringify(liveSessions));
            localStorage.setItem('eddyWorldFlashSales', JSON.stringify(flashSales));
            localStorage.setItem('eddyWorldNotifications', JSON.stringify(notifications));
            
            // Save language preference
            localStorage.setItem('eddyWorldLanguage', currentLanguage);
            
            // Set a timestamp to track when data was last saved
            localStorage.setItem('eddyWorldLastSaved', new Date().toISOString());
        }

        function loadFromStorage() {
            // Load all user data permanently
            cart = JSON.parse(localStorage.getItem('eddyWorldCart')) || [];
            wishlist = JSON.parse(localStorage.getItem('eddyWorldWishlist')) || [];
            users = JSON.parse(localStorage.getItem('eddyWorldUsers')) || [];
            currentUser = JSON.parse(localStorage.getItem('eddyWorldCurrentUser')) || null;
            orders = JSON.parse(localStorage.getItem('eddyWorldOrders')) || [];
            orderCounter = JSON.parse(localStorage.getItem('eddyWorldOrderCounter')) || 1000;
            customerData = JSON.parse(localStorage.getItem('eddyWorldCustomerData')) || {
                pageViews: 0,
                productViews: {},
                searchQueries: [],
                cartAbandonments: 0,
                sessionStart: new Date(),
                userBehavior: []
            };
            
            // Load marketplace data permanently
            shops = JSON.parse(localStorage.getItem('eddyWorldShops')) || [];
            products = JSON.parse(localStorage.getItem('eddyWorldProducts')) || [];
            categories = JSON.parse(localStorage.getItem('eddyWorldCategories')) || [];
            inventory = JSON.parse(localStorage.getItem('eddyWorldInventory')) || {};
            vouchers = JSON.parse(localStorage.getItem('eddyWorldVouchers')) || [];
            coins = JSON.parse(localStorage.getItem('eddyWorldCoins')) || {};
            escrowTransactions = JSON.parse(localStorage.getItem('eddyWorldEscrowTransactions')) || [];
            returns = JSON.parse(localStorage.getItem('eddyWorldReturns')) || [];
            chatThreads = JSON.parse(localStorage.getItem('eddyWorldChatThreads')) || [];
            liveSessions = JSON.parse(localStorage.getItem('eddyWorldLiveSessions')) || [];
            flashSales = JSON.parse(localStorage.getItem('eddyWorldFlashSales')) || [];
            notifications = JSON.parse(localStorage.getItem('eddyWorldNotifications')) || [];
            
            // Load language preference
            const savedLanguage = localStorage.getItem('eddyWorldLanguage');
            if (savedLanguage && translations[savedLanguage]) {
                currentLanguage = savedLanguage;
            }
            
            // Check if data was loaded from storage
            const lastSaved = localStorage.getItem('eddyWorldLastSaved');
            if (lastSaved) {
    
            }
        }

        // User authentication functions
        function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = user;
                isAdmin = user.role === 'admin';
                
                // Load user's preferred language if set
                if (user.preferredLanguage && user.preferredLanguage !== currentLanguage) {
                    changeLanguage(user.preferredLanguage);
                }
                
                saveToStorage();
                updateUI();
                closeModal('loginModal');
                
                // Auto-progress based on user role
                if (isAdmin) {
                    // Auto-show admin dashboard after login
                    setTimeout(() => {
                        showAdminDashboard();
                    }, 500);
                } else {
                    // Auto-show seller dashboard if user has a shop, otherwise show main page
                    const userShop = shops.find(s => s.ownerId === currentUser.email);
                    if (userShop) {
                        setTimeout(() => {
                            showSellerDashboard();
                        }, 500);
                    }
                    
                    // Show welcome message with data persistence info
                    setTimeout(() => {
                        addNotification('info', 'Welcome Back!', `Welcome back, ${user.name}! Your account data is automatically saved and will be remembered forever.`, 'normal');
                    }, 1000);
                }
                
                trackUserBehavior('login', `User ${user.name} logged in as ${isAdmin ? 'Admin' : 'Customer'}`);
                // Remove full-page login if present
                hideFullLoginPage();
                showShoppingFeatures();
            } else {
                alert('Invalid email or password. Please try again.');
            }
        }

        function handleRegister(event) {
            event.preventDefault();
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const countryCode = document.getElementById('registerCountryCode').value;
            const phoneNumber = document.getElementById('registerPhone').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;

            // Validation
            if (password !== confirmPassword) {
                alert('Passwords do not match!');
                return;
            }

            if (users.find(u => u.email === email)) {
                alert('Email already registered!');
                return;
            }

            // Check phone number uniqueness (with country code)
            const fullPhone = countryCode + phoneNumber;
            if (users.find(u => u.phone === fullPhone)) {
                alert('Phone number already registered!');
                return;
            }

            // Phone number format validation
            if (!phoneNumber || phoneNumber.length < 8 || phoneNumber.length > 15) {
                alert('Please enter a valid phone number (8-15 digits)');
                return;
            }

            // Check if phone contains only numbers
            if (!/^\d+$/.test(phoneNumber)) {
                alert('Phone number should contain only digits');
                return;
            }

            const newUser = { 
                name, 
                email, 
                phone: fullPhone,
                countryCode: countryCode,
                phoneNumber: phoneNumber,
                password, 
                role: 'customer' 
            };
            
            users.push(newUser);
            currentUser = newUser;
            isAdmin = false;
            saveToStorage();
            updateUI();
            closeModal('registerModal');
            
            // Auto-show shop creation option for new users
            setTimeout(() => {
                showShopCreation();
            }, 500);
            
            // Show welcome message with data persistence info
            setTimeout(() => {
                addNotification('success', 'Account Created!', `Welcome to Eddy World, ${name}! Your account has been created and all your data will be automatically saved forever.`, 'normal');
            }, 1000);
            
            trackUserBehavior('register', `New customer ${name} registered with phone ${fullPhone}`);
        }

        function logout() {
            const wasAdmin = isAdmin;
            currentUser = null;
            isAdmin = false;
            saveToStorage();
            updateUI();
            alert(`You have been logged out successfully.${wasAdmin ? ' Admin privileges revoked.' : ''}`);
            trackUserBehavior('logout', `User logged out${wasAdmin ? ' (was admin)' : ''}`);
        }

        // Removed guest mode per requirements

        // Update UI based on user role and login status
        function updateUI() {
            const guestActions = document.getElementById('guest-actions');
            const userActions = document.getElementById('user-actions');
            const cartIcon = document.querySelector('.cart-icon');
            const wishlistIcon = document.querySelector('.wishlist-icon');
            const userIcon = document.querySelector('.user-icon');
            const adminIcon = document.querySelector('.admin-icon');
            const orderIcon = document.querySelector('.order-icon');
            const notificationIcon = document.querySelector('.notification-icon');
            
            // If not logged in, show guest mode with limited functionality
            if (!currentUser) {
                if (guestActions) guestActions.style.display = 'flex';
                if (userActions) userActions.style.display = 'none';
                if (cartIcon) cartIcon.style.display = 'inline-block'; // Show cart for guests
                if (wishlistIcon) wishlistIcon.classList.remove('show'); // Hide wishlist for guests
                if (userIcon) userIcon.style.display = 'none'; // Hide user icon for guests
                if (adminIcon) adminIcon.style.display = 'none';
                if (orderIcon) orderIcon.style.display = 'none';
                if (notificationIcon) notificationIcon.style.display = 'none'; // Hide notifications for guests
                showShoppingFeatures(); // Show all shopping features for guests
                showGuestMode();
                return;
            }

            if (currentUser) {
                // User is logged in
                guestActions.style.display = 'none';
                userActions.style.display = 'flex';
                
                // Show user-specific actions
                if (isAdmin) {
                    userActions.innerHTML = `
                        <span style="color: #667eea;">Welcome, ${currentUser.name}!</span>
                        <a href="#" onclick="showAdminDashboard()">👑 Admin Panel</a>
                        <a href="#" onclick="showAllOrders()">📦 Manage Orders</a>
                        <a href="#" onclick="logout()">Logout</a>
                    `;
                    adminIcon.style.display = 'inline-block';
                    orderIcon.style.display = 'none';
                } else {
                    // Check if user has a shop
                    const userShop = shops.find(s => s.ownerId === currentUser.email);
                    if (userShop) {
                        userActions.innerHTML = `
                            <span style="color: #667eea;">Welcome, ${currentUser.name}!</span>
                            <a href="#" onclick="showSellerDashboard()">🏪 Seller Dashboard</a>
                            <a href="#" onclick="showWishlist()">❤️ Wishlist</a>
                            <a href="#" onclick="showOrderHistory()">📦 My Orders</a>
                            <a href="#" onclick="showChat()">💬 Chat</a>
                            <a href="#" onclick="logout()">Logout</a>
                        `;
                    } else {
                        userActions.innerHTML = `
                            <span style="color: #667eea;">Welcome, ${currentUser.name}!</span>
                            <a href="#" onclick="showWishlist()">❤️ Wishlist</a>
                            <a href="#" onclick="showOrderHistory()">📦 My Orders</a>
                            <a href="#" onclick="showChat()">💬 Chat</a>
                            <a href="#" onclick="showShopCreation()">🏪 Become a Seller</a>
                            <a href="#" onclick="logout()">Logout</a>
                        `;
                    }
                    adminIcon.style.display = 'none';
                    orderIcon.style.display = 'inline-block';
                }
                
                cartIcon.style.display = 'inline-block';
                wishlistIcon.classList.add('show');
                userIcon.style.display = 'inline-block';
                notificationIcon.style.display = 'inline-block';
                
                // Update counts
                updateCartCount();
                updateWishlistCount();
                showNotificationBadge();
                
            } else {
                // User is not logged in
                guestActions.style.display = 'flex';
                userActions.style.display = 'none';
                cartIcon.style.display = 'none';
                wishlistIcon.style.display = 'none';
                adminIcon.style.display = 'none';
                orderIcon.style.display = 'none';
                notificationIcon.style.display = 'none';
            }
            
            // Show/hide shopping features based on role
            if (isAdmin) {
                hideShoppingFeatures();
                showAdminWelcome();
            } else {
                showShoppingFeatures();
                hideAdminWelcome();
            }
            
            // Update language after UI changes
            translatePage();
        }

        // Hide shopping features for admin view
        function hideShoppingFeatures() {
            const searchContainer = document.querySelector('.search-container');
            const nav = document.querySelector('.nav');
            const bannerSection = document.querySelector('.banner-section');
            const sidebar = document.querySelector('.sidebar');
            const productsSection = document.querySelector('.products-section');
            const cartIcon = document.querySelector('.cart-icon');
            const wishlistIcon = document.querySelector('.wishlist-icon');
            const mainFooter = document.getElementById('main-footer');
            
            if (searchContainer) searchContainer.style.display = 'none';
            if (nav) nav.style.display = 'none';
            if (bannerSection) bannerSection.style.display = 'none';
            if (sidebar) sidebar.style.display = 'none';
            if (productsSection) productsSection.style.display = 'none';
            if (cartIcon) cartIcon.style.display = 'none';
            if (wishlistIcon) wishlistIcon.style.display = 'none';
            if (mainFooter) mainFooter.style.display = 'none';
        }

        // Show shopping features for customer view
        function showShoppingFeatures() {
            const searchContainer = document.querySelector('.search-container');
            const nav = document.querySelector('.nav');
            const bannerSection = document.querySelector('.banner-section');
            const sidebar = document.querySelector('.sidebar');
            const productsSection = document.querySelector('.products-section');
            const cartIcon = document.querySelector('.cart-icon');
            const wishlistIcon = document.querySelector('.wishlist-icon');
            const mainFooter = document.getElementById('main-footer');
            
            if (searchContainer) searchContainer.style.display = '';
            if (nav) nav.style.display = '';
            if (bannerSection) bannerSection.style.display = '';
            if (sidebar) sidebar.style.display = '';
            if (productsSection) productsSection.style.display = '';
            if (cartIcon) cartIcon.style.display = '';
            if (wishlistIcon) wishlistIcon.style.display = '';
            if (mainFooter) mainFooter.style.display = '';
        }

        // Show admin welcome banner
        function showAdminWelcome() {
            // Remove existing admin welcome if any
            hideAdminWelcome();
            
            const adminWelcome = document.createElement('div');
            adminWelcome.id = 'admin-welcome';
            adminWelcome.style.cssText = `
                background: linear-gradient(135deg, #1d4ed8, #1e40af);
                color: white;
                padding: 40px 20px;
                text-align: center;
                margin-bottom: 30px;
                border-radius: 20px;
                box-shadow: 0 10px 30px rgba(29, 78, 216, 0.3);
            `;
            
            adminWelcome.innerHTML = `
                <h1 style="margin: 0 0 20px 0; font-size: 2.5em;">👑 Welcome to Eddy World Admin Panel</h1>
                <p style="margin: 0 0 30px 0; font-size: 1.2em; opacity: 0.9;">
                    Manage your marketplace, verify shops, handle orders, and monitor business performance
                </p>
                <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                    <button onclick="showShopVerification()" style="padding: 15px 30px; background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.3); border-radius: 25px; cursor: pointer; font-weight: 500; font-size: 16px; backdrop-filter: blur(10px);">
                        ✅ Verify Shops
                    </button>
                    <button onclick="showAllOrders()" style="padding: 15px 30px; background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.3); border-radius: 25px; cursor: pointer; font-weight: 500; font-size: 16px; backdrop-filter: blur(10px);">
                        📦 Manage Orders
                    </button>
                    <button onclick="displayAnalytics()" style="padding: 15px 30px; background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.3); border-radius: 25px; cursor: pointer; font-weight: 500; font-size: 16px; backdrop-filter: blur(10px);">
                        📊 Analytics
                    </button>
                    <button onclick="showUserManagement()" style="padding: 15px 30px; background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.3); border-radius: 25px; cursor: pointer; font-weight: 500; font-size: 16px; backdrop-filter: blur(10px);">
                        👥 User Management
                    </button>
                </div>
            `;
            
            // Insert after header
            const header = document.querySelector('header');
            header.parentNode.insertBefore(adminWelcome, header.nextSibling);
        }

        // Hide admin welcome banner
        function hideAdminWelcome() {
            const adminWelcome = document.getElementById('admin-welcome');
            if (adminWelcome) {
                adminWelcome.remove();
            }
        }

        // showOrderManagement is defined later in the file

        // showInventoryManagement is already defined elsewhere

        function showUserManagement() {
            if (!isAdmin) {
                alert('Access denied. Admin privileges required.');
                return;
            }
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 20px; max-width: 1000px; width: 95%; max-height: 90vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2 style="color: #667eea; margin: 0;">👥 User Management</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    
                    <div style="background: #f8f9fa; border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="margin: 0 0 20px 0; color: #333;">Current Users</h3>
                        ${users.map(user => `
                            <div style="background: white; border-radius: 10px; padding: 15px; margin-bottom: 15px; border-left: 4px solid ${user.role === 'admin' ? '#dc3545' : '#28a745'};">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <div>
                                        <h4 style="margin: 0; color: #333;">${user.name}</h4>
                                        <p style="margin: 0; color: #666;">${user.email}</p>
                                        <p style="margin: 0; color: #999; font-size: 14px;">Role: <span style="background: ${user.role === 'admin' ? '#dc3545' : '#28a745'}; color: white; padding: 2px 8px; border-radius: 10px; font-size: 12px;">${user.role}</span></p>
                                    </div>
                                    <div style="display: flex; gap: 10px;">
                                        ${user.role !== 'admin' ? `
                                            <button onclick="changeUserRole('${user.email}', 'admin')" style="padding: 8px 20px; background: #dc3545; color: white; border: none; border-radius: 15px; cursor: pointer; font-size: 12px;">
                                                👑 Make Admin
                                            </button>
                                        ` : ''}
                                        ${user.email !== 'admin@eddyworld.com' ? `
                                            <button onclick="deleteUser('${user.email}')" style="padding: 8px 20px; background: #ff6b6b; color: white; border: none; border-radius: 15px; cursor: pointer; font-size: 12px;">
                                                🗑️ Delete
                                            </button>
                                        ` : ''}
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            modal.classList.add('modal');
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function changeUserRole(userEmail, newRole) {
            const user = users.find(u => u.email === userEmail);
            if (user) {
                user.role = newRole;
                saveToStorage();
                addNotification('success', 'Role Changed', `User ${user.name} is now ${newRole}`, 'normal');
                alert(`User ${user.name} role changed to ${newRole}`);
                showUserManagement(); // Refresh the modal
            }
        }

        function deleteUser(userEmail) {
            if (confirm(`Are you sure you want to delete user ${userEmail}?`)) {
                users = users.filter(u => u.email !== userEmail);
                saveToStorage();
                addNotification('warning', 'User Deleted', `User ${userEmail} has been deleted`, 'high');
                alert(`User ${userEmail} has been deleted`);
                showUserManagement(); // Refresh the modal
            }
        }
        function rejectKYC(shopId) {
            const shop = shops.find(s => s.id === shopId);
            if (shop) {
                const reason = prompt('Please provide a reason for KYC rejection:');
                if (reason) {
                    shop.status = 'kyc_rejected';
                    shop.kycRejectedAt = new Date().toISOString();
                    shop.kycRejectionReason = reason;
                    saveToStorage();
                    
                    addNotification('warning', 'KYC Rejected', `KYC for shop "${shop.name}" has been rejected: ${reason}`, 'high');
                    alert(`KYC for shop "${shop.name}" has been rejected.`);
                    
                    // Refresh the modal
                    document.querySelector('.modal').remove();
                    showKYCManagement();
                }
            }
        }

        function requestMoreInfo(shopId) {
            const shop = shops.find(s => s.id === shopId);
            if (shop) {
                const info = prompt('What additional information do you need from this shop?');
                if (info) {
                    shop.status = 'kyc_info_requested';
                    shop.infoRequestedAt = new Date().toISOString();
                    shop.infoRequested = info;
                    saveToStorage();
                    
                    addNotification('info', 'Info Requested', `Additional information requested from shop "${shop.name}"`, 'normal');
                    alert(`Additional information requested from shop "${shop.name}"`);
                    
                    // Refresh the modal
                    document.querySelector('.modal').remove();
                    showKYCManagement();
                }
            }
        }

        function resolveDispute(orderId) {
            const escrow = escrowTransactions.find(e => e.orderId === orderId);
            if (escrow) {
                const resolution = prompt('How would you like to resolve this dispute? (refund/partial_refund/release)');
                if (resolution) {
                    if (resolution === 'refund') {
                        escrow.status = 'refunded';
                        escrow.timeline.push({
                            status: 'refunded',
                            timestamp: new Date().toISOString(),
                            note: `Dispute resolved: Full refund issued`
                        });
                    } else if (resolution === 'partial_refund') {
                        const amount = prompt('Enter partial refund amount:');
                        if (amount) {
                            escrow.status = 'partial_refunded';
                            escrow.timeline.push({
                                status: 'partial_refunded',
                                timestamp: new Date().toISOString(),
                                note: `Dispute resolved: Partial refund of ฿${amount} issued`
                            });
                        }
                    } else if (resolution === 'release') {
                        escrow.status = 'released';
                        escrow.timeline.push({
                            status: 'released',
                            timestamp: new Date().toISOString(),
                            note: `Dispute resolved: Payment released to seller`
                        });
                    }
                    
                    saveToStorage();
                    addNotification('success', 'Dispute Resolved', `Dispute for Order #${orderId} has been resolved`, 'normal');
                    alert(`Dispute for Order #${orderId} has been resolved`);
                    
                    // Refresh the modal
                    document.querySelector('.modal').remove();
                    showEscrowManagement();
                }
            }
        }

        function viewEscrowDetails(escrowId) {
            const escrow = escrowTransactions.find(e => e.id === escrowId);
            if (escrow) {
                let detailsHTML = `
                    <h3>🔒 Escrow Details</h3>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                        <h4>Transaction Information</h4>
                        <p><strong>Order ID:</strong> #${escrow.orderId}</p>
                        <p><strong>Amount:</strong> ฿${escrow.amount.toLocaleString()}</p>
                        <p><strong>Buyer:</strong> ${escrow.buyerId}</p>
                        <p><strong>Shop ID:</strong> ${escrow.shopId}</p>
                        <p><strong>Status:</strong> <span style="background: ${getEscrowStatusColor(escrow.status)}; color: white; padding: 3px 10px; border-radius: 10px; font-size: 12px;">${escrow.status}</span></p>
                        <p><strong>Created:</strong> ${new Date(escrow.createdAt).toLocaleString()}</p>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 15px;">
                        <h4>Timeline</h4>
                        ${escrow.timeline.map(event => `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee;">
                                <div>
                                    <strong>${event.status}</strong><br>
                                    <small style="color: #666;">${event.note || ''}</small>
                                </div>
                                <span style="color: #999; font-size: 12px;">${new Date(event.timestamp).toLocaleString()}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                alert(detailsHTML.replace(/<[^>]*>/g, ''));
            }
        }

        function getEscrowStatusColor(status) {
            switch (status) {
                case 'held': return '#17a2b8';
                case 'shipped': return '#ffc107';
                case 'delivered': return '#28a745';
                case 'released': return '#6c757d';
                case 'disputed': return '#dc3545';
                case 'refunded': return '#6f42c1';
                default: return '#6c757d';
            }
        }

        function viewShopDetails(shopId) {
            const shop = shops.find(s => s.id === shopId);
            if (shop) {
                let detailsHTML = `
                    <h3>🏪 Shop Details</h3>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                        <h4>Basic Information</h4>
                        <p><strong>Name:</strong> ${shop.name}</p>
                        <p><strong>Description:</strong> ${shop.description}</p>
                        <p><strong>Type:</strong> ${shop.type}</p>
                        <p><strong>Status:</strong> <span style="background: ${getShopStatusColor(shop.status)}; color: white; padding: 3px 10px; border-radius: 10px; font-size: 12px;">${shop.status}</span></p>
                        <p><strong>Owner:</strong> ${shop.ownerId}</p>
                        <p><strong>Created:</strong> ${new Date(shop.createdAt).toLocaleString()}</p>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 15px;">
                        <h4>Performance</h4>
                        <p><strong>Rating:</strong> ${shop.rating}/5.0</p>
                        <p><strong>Total Sales:</strong> ${shop.totalSales}</p>
                        <p><strong>Badges:</strong> ${shop.badges.join(', ') || 'None'}</p>
                    </div>
                `;
                
                alert(detailsHTML.replace(/<[^>]*>/g, ''));
            }
        }

        function getShopStatusColor(status) {
            switch (status) {
                case 'active': return '#28a745';
                case 'pending': return '#ffc107';
                case 'kyc_pending': return '#fd7e14';
                case 'kyc_rejected': return '#dc3545';
                case 'rejected': return '#dc3545';
                default: return '#6c757d';
            }
        }

        function viewLiveSessionDetails(sessionId) {
            const session = liveSessions.find(s => s.id === sessionId);
            if (session) {
                let detailsHTML = `
                    <h3>📺 Live Session Details</h3>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                        <h4>Session Information</h4>
                        <p><strong>Title:</strong> ${session.title}</p>
                        <p><strong>Description:</strong> ${session.description}</p>
                        <p><strong>Shop:</strong> ${session.shopName}</p>
                        <p><strong>Status:</strong> <span style="background: ${getSessionStatusColor(session.status)}; color: white; padding: 3px 10px; border-radius: 10px; font-size: 12px;">${session.status}</span></p>
                        <p><strong>Scheduled:</strong> ${new Date(session.scheduledAt).toLocaleString()}</p>
                        ${session.startedAt ? `<p><strong>Started:</strong> ${new Date(session.startedAt).toLocaleString()}</p>` : ''}
                        ${session.endedAt ? `<p><strong>Ended:</strong> ${new Date(session.endedAt).toLocaleString()}</p>` : ''}
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 15px;">
                        <h4>Statistics</h4>
                        <p><strong>Concurrent Viewers:</strong> ${session.concurrentViewers}</p>
                        <p><strong>Total Viewers:</strong> ${session.totalViewers}</p>
                        <p><strong>Pinned Products:</strong> ${session.products.length}</p>
                        <p><strong>Dropped Coupons:</strong> ${session.coupons.length}</p>
                    </div>
                `;
                
                alert(detailsHTML.replace(/<[^>]*>/g, ''));
            }
        }

        function createNewVoucher() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 20px; max-width: 600px; width: 95%; max-height: 90vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2 style="color: #667eea; margin: 0;">🎫 Create New Voucher</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    
                    <form onsubmit="handleVoucherCreation(event)">
                        <div class="form-group">
                            <label for="voucherCode">Voucher Code *</label>
                            <input type="text" id="voucherCode" required placeholder="Enter voucher code">
                        </div>
                        <div class="form-group">
                            <label for="voucherType">Type *</label>
                            <select id="voucherType" required>
                                <option value="percentage">Percentage Off</option>
                                <option value="fixed">Fixed Amount Off</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="voucherValue">Value *</label>
                            <input type="number" id="voucherValue" required placeholder="Enter value">
                        </div>
                        <div class="form-group">
                            <label for="voucherMinSpend">Minimum Spend *</label>
                            <input type="number" id="voucherMinSpend" required placeholder="Enter minimum spend">
                        </div>
                        <div class="form-group">
                            <label for="voucherMaxDiscount">Maximum Discount</label>
                            <input type="number" id="voucherMaxDiscount" placeholder="Enter maximum discount">
                        </div>
                        <div class="form-group">
                            <label for="voucherUsageLimit">Usage Limit *</label>
                            <input type="number" id="voucherUsageLimit" required placeholder="Enter usage limit">
                        </div>
                        <div class="form-group">
                            <label for="voucherEndDate">End Date *</label>
                            <input type="date" id="voucherEndDate" required>
                        </div>
                        <button type="submit" class="btn-primary">Create Voucher</button>
                    </form>
                </div>
            `;
            
            modal.classList.add('modal');
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function handleVoucherCreation(event) {
            event.preventDefault();
            
            const voucherData = {
                code: document.getElementById('voucherCode').value,
                type: document.getElementById('voucherType').value,
                value: parseInt(document.getElementById('voucherValue').value),
                minSpend: parseInt(document.getElementById('voucherMinSpend').value),
                maxDiscount: parseInt(document.getElementById('voucherMaxDiscount').value) || 0,
                usageLimit: parseInt(document.getElementById('voucherUsageLimit').value),
                endDate: document.getElementById('voucherEndDate').value,
                applicableCategories: [1, 2, 3, 4, 5, 6, 7, 8] // All categories
            };
            
            const newVoucher = {
                id: Date.now(),
                ...voucherData,
                usedCount: 0,
                startDate: new Date().toISOString(),
                endDate: new Date(voucherData.endDate).toISOString(),
                status: 'active'
            };
            
            vouchers.push(newVoucher);
            saveToStorage();
            
            addNotification('success', 'Voucher Created', `Voucher ${voucherData.code} has been created successfully!`, 'normal');
            alert(`Voucher ${voucherData.code} created successfully!`);
            
            document.querySelector('.modal').remove();
            showVoucherManagement();
        }

        function showVoucherAnalytics() {
            const totalVouchers = vouchers.length;
            const activeVouchers = vouchers.filter(v => v.status === 'active').length;
            const totalUsage = vouchers.reduce((sum, v) => sum + v.usedCount, 0);
            const totalDiscount = vouchers.reduce((sum, v) => sum + (v.usedCount * (v.type === 'percentage' ? v.value : v.maxDiscount)), 0);
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 20px; max-width: 800px; width: 95%; max-height: 90vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2 style="color: #667eea; margin: 0;">📊 Voucher Analytics</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                            <h3 style="margin: 0 0 10px 0; font-size: 14px;">Total Vouchers</h3>
                            <p style="font-size: 24px; font-weight: bold; margin: 0;">${totalVouchers}</p>
                        </div>
                        <div style="background: linear-gradient(135deg, #ff6b6b, #ffa500); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                            <h3 style="margin: 0 0 10px 0; font-size: 14px;">Active Vouchers</h3>
                            <p style="font-size: 24px; font-weight: bold; margin: 0;">${activeVouchers}</p>
                        </div>
                        <div style="background: linear-gradient(135deg, #4ecdc4, #44a08d); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                            <h3 style="margin: 0 0 10px 0; font-size: 14px;">Total Usage</h3>
                            <p style="font-size: 24px; font-weight: bold; margin: 0;">${totalUsage}</p>
                        </div>
                        <div style="background: linear-gradient(135deg, #a8edea, #fed6e3); color: #333; padding: 20px; border-radius: 15px; text-align: center;">
                            <h3 style="margin: 0 0 10px 0; font-size: 14px;">Total Discount</h3>
                            <p style="font-size: 24px; font-weight: bold; margin: 0;">฿${totalDiscount.toLocaleString()}</p>
                        </div>
                    </div>

                    <div style="background: #f8f9fa; border-radius: 15px; padding: 20px;">
                        <h3 style="margin: 0 0 20px 0; color: #333;">Top Performing Vouchers</h3>
                        ${vouchers.sort((a, b) => b.usedCount - a.usedCount).slice(0, 5).map((voucher, index) => `
                            <div style="background: white; border-radius: 10px; padding: 15px; margin-bottom: 15px; border-left: 4px solid ${index === 0 ? '#ffd700' : index === 1 ? '#c0c0c0' : index === 2 ? '#cd7f32' : '#28a745'};">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <h4 style="margin: 0; color: #333;">${voucher.code}</h4>
                                        <p style="margin: 0; color: #666;">
                                            ${voucher.type === 'percentage' ? `${voucher.value}% off` : `฿${voucher.value} off`} 
                                            (Min spend: ฿${voucher.minSpend})
                                        </p>
                                    </div>
                                    <div style="text-align: right;">
                                        <p style="margin: 0; color: #333; font-weight: bold;">${voucher.usedCount} uses</p>
                                        <p style="margin: 0; color: #999; font-size: 12px;">Rank #${index + 1}</p>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            modal.classList.add('modal');
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Add missing functions for live session creation
        function showCreateLiveSession() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 20px; max-width: 600px; width: 95%; max-height: 90vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2 style="color: #667eea; margin: 0;">🎥 Create Live Session</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    
                    <form onsubmit="handleLiveSessionCreation(event)">
                        <div class="form-group">
                            <label for="sessionTitle">Session Title *</label>
                            <input type="text" id="sessionTitle" required placeholder="Enter session title">
                        </div>
                        <div class="form-group">
                            <label for="sessionDescription">Description</label>
                            <textarea id="sessionDescription" rows="3" placeholder="Describe your live session"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="sessionScheduledAt">Scheduled Time *</label>
                            <input type="datetime-local" id="sessionScheduledAt" required>
                        </div>
                        <button type="submit" class="btn-primary">Create Live Session</button>
                    </form>
                </div>
            `;
            
            modal.classList.add('modal');
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function handleLiveSessionCreation(event) {
            event.preventDefault();
            
            const sessionData = {
                title: document.getElementById('sessionTitle').value,
                description: document.getElementById('sessionDescription').value,
                scheduledAt: document.getElementById('sessionScheduledAt').value
            };
            
            const newSession = createLiveSession(sessionData);
            if (newSession) {
                document.querySelector('.modal').remove();
                showLiveShopping();
            }
        }

        function viewLiveProducts(sessionId) {
            const session = liveSessions.find(s => s.id === sessionId);
            if (session) {
                let productsHTML = `
                    <h3>📦 Products in Live Session</h3>
                    <p style="color: #666; margin-bottom: 20px;">${session.title}</p>
                `;
                
                if (session.products.length > 0) {
                    session.products.forEach(product => {
                        productsHTML += `
                            <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; margin-bottom: 15px; border-left: 4px solid #4ecdc4;">
                                <h4 style="margin: 0 0 10px 0; color: #333;">${product.productTitle}</h4>
                                <p style="margin: 0; color: #666;">Pinned at: ${new Date(product.pinnedAt).toLocaleString()}</p>
                                <p style="margin: 0; color: #999; font-size: 14px;">Clicks: ${product.clicks} | Conversions: ${product.conversions}</p>
                            </div>
                        `;
                    });
                } else {
                    productsHTML += '<p style="color: #999; text-align: center;">No products pinned yet</p>';
                }
                
                alert(productsHTML.replace(/<[^>]*>/g, ''));
            }
        }

        // Update the header to include new marketplace features
        function updateHeaderForMarketplace() {
            const headerActions = document.querySelector('.header-actions');
            if (headerActions) {
                // Add live shopping button
                const liveButton = document.createElement('a');
                liveButton.href = '#';
                liveButton.onclick = () => showLiveShopping();
                liveButton.innerHTML = '<i class="fas fa-video"></i> Live Shopping';
                liveButton.style.cssText = 'color: #ff6b6b; text-decoration: none; margin-left: 20px; font-weight: 500;';
                headerActions.appendChild(liveButton);
                
                // Add chat button
                const chatButton = document.createElement('a');
                chatButton.href = '#';
                chatButton.onclick = () => showChat();
                chatButton.innerHTML = '<i class="fas fa-comments"></i> Chat';
                chatButton.style.cssText = 'color: #4ecdc4; text-decoration: none; margin-left: 20px; font-weight: 500;';
                headerActions.appendChild(chatButton);
            }
        }

        // Initialize marketplace features
        function initializeMarketplaceFeatures() {
            updateHeaderForMarketplace();
            
            // Add flash sale countdown to banner
            const banner = document.querySelector('.banner');
            if (banner) {
                const countdown = document.createElement('div');
                countdown.id = 'flash-sale-countdown';
                countdown.style.cssText = `
                    background: rgba(255, 107, 107, 0.9);
                    color: white;
                    padding: 15px 25px;
                    border-radius: 25px;
                    text-align: center;
                    margin-top: 20px;
                    font-weight: bold;
                    font-size: 18px;
                `;
                countdown.innerHTML = '⚡ Flash Sale: Loading...';
                banner.appendChild(countdown);
                
                // Update countdown every second
                setInterval(updateFlashSaleCountdown, 1000);
            }
        }

        // Update flash sale countdown
        function updateFlashSaleCountdown() {
            const countdownElement = document.getElementById('flash-sale-countdown');
            if (countdownElement) {
                const countdown = getFlashSaleCountdown();
                if (countdown) {
                    countdownElement.innerHTML = `⚡ Flash Sale: ${countdown.hours}h ${countdown.minutes}m ${countdown.seconds}s`;
                    countdownElement.style.background = 'rgba(255, 107, 107, 0.9)';
                } else {
                    countdownElement.innerHTML = '⚡ Flash Sale: Coming Soon!';
                    countdownElement.style.background = 'rgba(102, 126, 234, 0.9)';
                }
            }
        }

        // Call initialization functions
        // This will be handled in the main DOMContentLoaded listener

        // Cart functions
        function addToCart(productId, productName, price) {
            if (!currentUser) {
                openLoginSession();
                return;
            }

            // Check inventory
            const stockItem = inventory[productId];
            if (!stockItem || stockItem.stock <= 0) {
                addNotification('error', 'Out of Stock', `${productName} is currently out of stock.`, 'high');
                alert('Sorry, this product is out of stock.');
                return;
            }

            // Check if adding would exceed available stock
            const existingItem = cart.find(item => item.id === productId);
            const requestedQuantity = existingItem ? existingItem.quantity + 1 : 1;
            
            if (requestedQuantity > stockItem.stock) {
                addNotification('warning', 'Limited Stock', `Only ${stockItem.stock} units of ${productName} available.`, 'normal');
                alert(`Sorry, only ${stockItem.stock} units of ${productName} are available.`);
                return;
            }
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: productId,
                    name: productName,
                    price: price,
                    quantity: 1
                });
            }
            
            saveToStorage();
            updateCartCount();
            addNotification('success', 'Added to Cart', `${productName} added to cart successfully!`, 'normal');
            trackUserBehavior('add_to_cart', `User ${currentUser.name} added ${productName} to cart`);
            
                    // Auto-show cart after adding item
        setTimeout(() => {
            showCartModal();
        }, 300);
        
        // Show data saved notification
        addNotification('success', 'Data Saved', 'Your account data has been automatically saved!', 'normal');
            
            // Start cart abandonment timer if this is the first item
            if (cart.length === 1) {
                startCartAbandonmentTimer();
                setupCartAbandonmentListeners();
            }
        }

        function updateCartCount() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.querySelector('.cart-count').textContent = totalItems;
        }

        // Show modal function
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                // Always hide the language gate when opening any modal
                try { hideLanguageGate(); } catch (e) {}
                modal.style.display = 'block';
            }
        }

        // New conditional authentication system
        let guestSessionTimer = null;
        let guestClickCount = 0;
        let guestSessionStart = Date.now();
        const GUEST_SESSION_LIMIT = 5 * 60 * 1000; // 5 minutes in milliseconds
        const GUEST_CLICK_LIMIT = 20; // Maximum clicks before requiring login
        // Disable automatic guest popups (expiry and click-limit prompts)
        const DISABLE_GUEST_AUTO_PROMPT = true;

        // Carousel functionality
        let currentSlide = 1;
        const totalSlides = 5;
        let carouselInterval;

        // Banner management data
        let bannerAds = [
            {
                id: 1,
                type: 'carousel',
                position: 'left',
                imageUrl: 'https://via.placeholder.com/500x300/ff6b35/ffffff?text=Ad+1+New+Customer',
                title: 'ลูกค้าใหม่ ราคาพิเศษ $1.-',
                subtitle: 'New customers get special prices from $1',
                buttonText: 'Shop Now',
                active: true
            },
            {
                id: 2,
                type: 'carousel',
                position: 'left',
                imageUrl: 'https://via.placeholder.com/500x300/667eea/ffffff?text=Ad+2+Free+Shipping',
                title: 'ส่งฟรี ขั้นต่ำ 0 บาท',
                subtitle: 'Free Shipping, Minimum $0',
                buttonText: 'Learn More',
                active: true
            },
            {
                id: 3,
                type: 'carousel',
                position: 'left',
                imageUrl: 'https://via.placeholder.com/500x300/4ecdc4/ffffff?text=Ad+3+Discount+50',
                title: 'โค้ดส่วนลด 50%',
                subtitle: 'Discount Code 50% Off',
                buttonText: 'Get Code',
                active: true
            },
            {
                id: 4,
                type: 'carousel',
                position: 'left',
                imageUrl: 'https://via.placeholder.com/500x300/ff6b6b/ffffff?text=Ad+4+Hot+Sale',
                title: 'Hot Sale! 🔥',
                subtitle: 'Limited time offers',
                buttonText: 'Shop Now',
                active: true
            },
            {
                id: 5,
                type: 'carousel',
                position: 'left',
                imageUrl: 'https://via.placeholder.com/500x300/9b59b6/ffffff?text=Ad+5+New+Arrivals',
                title: 'New Arrivals ✨',
                subtitle: 'Check out latest products',
                buttonText: 'Explore',
                active: true
            },
            {
                id: 6,
                type: 'static',
                position: 'right',
                imageUrl: 'https://via.placeholder.com/300x150/4ecdc4/ffffff',
                active: true
            },
            {
                id: 7,
                type: 'static',
                position: 'right',
                imageUrl: 'https://via.placeholder.com/300x150/667eea/ffffff',
                active: true
            }
        ];
        
        function enforceAuthGate() {
            // Always show main page first - no login required initially
            showShoppingFeatures();
            
            // Start guest session timer
            startGuestSessionTimer();
            
            // Track guest clicks
            setupGuestClickTracking();
            
            // Check if user is already logged in
            if (currentUser) {
                // User is logged in, show full functionality
                updateUI();
                return;
            }

            // User is guest - show limited functionality
            showGuestMode();
        }
        
        function startGuestSessionTimer() {
            if (DISABLE_GUEST_AUTO_PROMPT) {
                // Do not schedule auto login prompts for guests
                if (guestSessionTimer) {
                    clearTimeout(guestSessionTimer);
                }
                return;
            }
            // Clear any existing timer
            if (guestSessionTimer) {
                clearTimeout(guestSessionTimer);
            }
            // Set timer for 5 minutes
            guestSessionTimer = setTimeout(() => {
                if (!currentUser) {
                    showLoginPrompt('Your guest session has expired. Please log in to continue.');
                }
            }, GUEST_SESSION_LIMIT);
        }
        
        function setupGuestClickTracking() {
            if (DISABLE_GUEST_AUTO_PROMPT) {
                return; // Do not track clicks for auto prompts
            }
            // Track clicks on interactive elements
            document.addEventListener('click', function(e) {
                if (!currentUser) {
                    guestClickCount++;
                    // Check if click limit reached
                    if (guestClickCount >= GUEST_CLICK_LIMIT) {
                        showLoginPrompt('You\'ve been browsing for a while. Please log in to continue.');
                        guestClickCount = 0; // Reset counter
                    }
                    // Reset timer on each click
                    startGuestSessionTimer();
                }
            });
        }
        
        function showGuestMode() {
            // Show limited functionality for guests
            const guestActions = document.getElementById('guest-actions');
            const userActions = document.getElementById('user-actions');
            
            if (guestActions) guestActions.style.display = 'flex';
            if (userActions) userActions.style.display = 'none';
        }
        

        
        function showLoginPrompt(message) {
            // If we disabled auto prompts, route directly to the full login page
            if (typeof DISABLE_GUEST_AUTO_PROMPT !== 'undefined' && DISABLE_GUEST_AUTO_PROMPT) {
                openLoginSession();
                return;
            }
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 3000;
                backdrop-filter: blur(5px);
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 20px; max-width: 500px; width: 90%; text-align: center; box-shadow: 0 20px 40px rgba(0,0,0,0.3);">
                    <div style="font-size: 60px; margin-bottom: 20px;">🔒</div>
                    <h2 style="color: #667eea; margin: 0 0 15px 0;">${getText('login_title')}</h2>
                    <p style="color: #666; margin: 0 0 25px 0; line-height: 1.5;">${message}</p>
                    
                    <div style="display: flex; gap: 15px; justify-content: center; margin-bottom: 25px;">
                        <button onclick="showModal('loginModal'); this.closest('.modal').remove();" style="padding: 12px 25px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                            🔑 ${getText('login_button')}
                        </button>
                        <button onclick="showModal('registerModal'); this.closest('.modal').remove();" style="padding: 12px 25px; background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                            ✨ ${getText('register_button')}
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Auto-close after 30 seconds
            setTimeout(() => {
                if (modal.parentElement) {
                    modal.remove();
                }
            }, 30000);
        }
        // Unified entry to open themed login session like Shopee page
        function openLoginSession() {
            // Always open the same full-page session destination (no extra prompt)
            showFullLoginPage();
            return false;
        }
        // Render full-page login (blocks main page until login)
        function showFullLoginPage() {
            hideFullLoginPage();
            const wrapper = document.createElement('div');
            wrapper.id = 'full-login';
            wrapper.style.cssText = `
                background: #1e40af;
                background: linear-gradient(135deg, #1d4ed8 0%, #1e40af 100%);
                padding: 80px 0 120px 0;
            `;
            wrapper.innerHTML = `
                <div style="max-width: 1100px; margin: 0 auto; display: grid; grid-template-columns: 1.6fr 1fr; gap: 30px; align-items: center;">
                    <div style="color: white; text-align: center;">
                        <h1 style="margin: 0 0 10px 0; font-size: 40px; font-weight: 700; color: #ffd700;">Eddy World</h1>
                        <p style="margin: 0; opacity: 0.9; font-size: 18px;">${getText('welcome')}</p>
                    </div>
                    <div style="background: #ffffff; border: 1px solid #e5e7eb; border-radius: 10px; padding: 24px; box-shadow: 0 10px 24px rgba(0,0,0,0.12);">
                        <h2 style="margin: 0 0 16px 0; font-size: 20px; color: #111827;">${getText('login_title')}</h2>
                        <form onsubmit="handleLogin(event)">
                            <div style="margin-bottom: 12px;">
                                <input type="email" id="loginEmail" placeholder="${getText('email')}" required style="width: 100%; padding: 12px 14px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 14px;">
                            </div>
                            <div style="margin-bottom: 12px;">
                                <input type="password" id="loginPassword" placeholder="${getText('password')}" required style="width: 100%; padding: 12px 14px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 14px;">
                            </div>
                            <button type="submit" style="width: 100%; padding: 12px; background: #2563eb; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">${getText('login_button')}</button>
                        </form>
                        <div style="display:flex; align-items:center; gap:10px; margin:14px 0; color:#9ca3af; font-size:12px;"><div style="flex:1; height:1px; background:#e5e7eb;"></div> OR <div style="flex:1; height:1px; background:#e5e7eb;"></div></div>
                        <div style="display:flex; gap:10px;">
                            <button onclick="alert('Social login is a demo');" style="flex:1; padding:10px; background:#f3f4f6; border:1px solid #e5e7eb; border-radius:8px; cursor:pointer;">Facebook</button>
                            <button onclick="alert('Social login is a demo');" style="flex:1; padding:10px; background:#f3f4f6; border:1px solid #e5e7eb; border-radius:8px; cursor:pointer;">Google</button>
                        </div>
                        <p style="margin:14px 0 0 0; font-size:13px; color:#6b7280; text-align:center;">${getText('no_account')} <a href="#" onclick="hideLanguageGate(); switchModal('loginModal','registerModal'); hideFullLoginPage(); showModal('registerModal'); return false;" style="color:#2563eb; text-decoration:none;">${getText('register_link')}</a></p>
                    </div>
                </div>
            `;
            // Simplify the top banner to mimic login header
            try {
                document.body.classList.add('login-session-active');
                const header = document.querySelector('.header');
                const headerTop = header ? header.querySelector('.header-top') : null;
                const headerMain = header ? header.querySelector('.header-main') : null;
                const searchContainer = header ? header.querySelector('.search-container') : null;
                const headerActions = header ? header.querySelector('.header-actions') : null;
                const logo = header ? header.querySelector('.logo') : null;
                if (headerTop) headerTop.style.display = 'none';
                if (searchContainer) searchContainer.style.display = 'none';
                if (headerActions) headerActions.style.display = 'none';
                if (headerMain) {
                    // store original background to restore later (no yellow highlight applied now)
                    if (!headerMain.dataset.origBg) {
                        headerMain.dataset.origBg = headerMain.style.background || '';
                    }
                    if (!headerMain.dataset.origPadding) {
                        headerMain.dataset.origPadding = headerMain.style.padding || '';
                    }
                    // make the banner taller during login session
                    headerMain.style.padding = '24px 0';
                }
                if (logo) {
                    if (!logo.dataset.origHtml) logo.dataset.origHtml = logo.innerHTML;
                    logo.innerHTML = 'Eddy World';
                    // Add separate small "Log In" label next to logo
                    if (headerMain && !document.getElementById('login-session-label')) {
                        const loginLabel = document.createElement('span');
                        loginLabel.id = 'login-session-label';
                        loginLabel.style.cssText = 'font-size:inherit; font-weight:500; color:#ffffff; margin-left:8px;';
                        loginLabel.setAttribute('data-translate', 'login_title');
                        loginLabel.textContent = getText('login_title');
                        headerMain.insertBefore(loginLabel, logo.nextSibling);
                    }
                }
                // Insert Need Help? on the right side
                if (headerMain && !document.getElementById('login-help-link')) {
                    const help = document.createElement('div');
                    help.id = 'login-help-link';
                    help.style.cssText = 'margin-left:auto; font-weight:500; color:#ffffff;';
                    help.setAttribute('data-translate', 'need_help');
                    help.textContent = getText('need_help');
                    headerMain.appendChild(help);
                }

                // Hide rest of page sections while login session is visible
                Array.from(document.body.children).forEach(el => {
                    if (el === header || el === wrapper) return;
                    if (el.tagName === 'SCRIPT') return;
                    el.setAttribute('data-hide-during-login', '1');
                    el.style.display = 'none';
                });
            } catch (e) {}
            const headerEl = document.querySelector('.header');
            if (headerEl && headerEl.parentNode) {
                headerEl.parentNode.insertBefore(wrapper, headerEl.nextSibling);
            } else {
                document.body.prepend(wrapper);
            }
            // Insert gray footer banner AFTER the blue section so it sits lower than the blue background
            const loginFooter = document.createElement('div');
            loginFooter.id = 'full-login-footer';
            loginFooter.style.cssText = 'background:#f3f4f6;';
            loginFooter.innerHTML = `
                <div style="max-width:1100px; margin:0 auto; padding:36px 0; display:grid; grid-template-columns: 1.2fr 1.2fr 1fr 1fr 1fr; gap:24px; color:#111827;">
                    <div>
                        <h4 data-translate="footer_customer_service" style="margin:0 0 12px 0; font-size:14px; color:#111827; text-transform:uppercase; letter-spacing:.02em;">Customer Service</h4>
                        <ul style="list-style:none; padding:0; margin:0; color:#374151; font-size:13px; line-height:1.9;">
                            <li><a href="#" data-translate="footer_help_centre" style="color:#374151; text-decoration:none;" onmouseover="this.style.color='#2563eb'" onmouseout="this.style.color='#374151'">Help Centre</a></li>
                            <li><a href="#" data-translate="footer_how_to_buy" style="color:#374151; text-decoration:none;" onmouseover="this.style.color='#2563eb'" onmouseout="this.style.color='#374151'">How To Buy</a></li>
                            <li><a href="#" data-translate="footer_how_to_sell" style="color:#374151; text-decoration:none;" onmouseover="this.style.color='#2563eb'" onmouseout="this.style.color='#374151'">How To Sell</a></li>
                            <li><a href="#" data-translate="footer_payment_methods" style="color:#374151; text-decoration:none;" onmouseover="this.style.color='#2563eb'" onmouseout="this.style.color='#374151'">Payment Methods</a></li>
                            <li><a href="#" data-translate="footer_shipping_delivery" style="color:#374151; text-decoration:none;" onmouseover="this.style.color='#2563eb'" onmouseout="this.style.color='#374151'">Shipping & Delivery</a></li>
                            <li><a href="#" data-translate="footer_return_refund" style="color:#374151; text-decoration:none;" onmouseover="this.style.color='#2563eb'" onmouseout="this.style.color='#374151'">Return & Refund</a></li>
                            <li><a href="#" data-translate="footer_shop_guarantee" style="color:#374151; text-decoration:none;" onmouseover="this.style.color='#2563eb'" onmouseout="this.style.color='#374151'">Shop Guarantee</a></li>
                            <li><a href="#" data-translate="footer_contact_us" style="color:#374151; text-decoration:none;" onmouseover="this.style.color='#2563eb'" onmouseout="this.style.color='#374151'">Contact Us</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4 data-translate="footer_about_eddy" style="margin:0 0 12px 0; font-size:14px; color:#111827; text-transform:uppercase; letter-spacing:.02em;">About Eddy</h4>
                        <ul style="list-style:none; padding:0; margin:0; color:#374151; font-size:13px; line-height:1.9;">
                            <li><a href="#" data-translate="footer_about_us" style="color:#374151; text-decoration:none;" onmouseover="this.style.color='#2563eb'" onmouseout="this.style.color='#374151'">About Us</a></li>
                            <li><a href="#" data-translate="footer_affiliate_program" style="color:#374151; text-decoration:none;" onmouseover="this.style.color='#2563eb'" onmouseout="this.style.color='#374151'">Affiliate Program</a></li>
                            <li><a href="#" data-translate="footer_careers" style="color:#374151; text-decoration:none;" onmouseover="this.style.color='#2563eb'" onmouseout="this.style.color='#374151'">Careers</a></li>
                            <li><a href="#" data-translate="footer_policies" style="color:#374151; text-decoration:none;" onmouseover="this.style.color='#2563eb'" onmouseout="this.style.color='#374151'">Policies</a></li>
                            <li><a href="#" data-translate="footer_privacy" style="color:#374151; text-decoration:none;" onmouseover="this.style.color='#2563eb'" onmouseout="this.style.color='#374151'">Privacy</a></li>
                            <li><a href="#" data-translate="footer_blog" style="color:#374151; text-decoration:none;" onmouseover="this.style.color='#2563eb'" onmouseout="this.style.color='#374151'">Blog</a></li>
                            <li><a href="#" data-translate="footer_media_contact" style="color:#374151; text-decoration:none;" onmouseover="this.style.color='#2563eb'" onmouseout="this.style.color='#374151'">Media Contact</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4 data-translate="footer_payment" style="margin:0 0 12px 0; font-size:14px; color:#111827; text-transform:uppercase; letter-spacing:.02em;">Payment</h4>
                        <div style="display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:8px;">
                            <div style="background:#fff; border:1px solid #e5e7eb; border-radius:6px; height:34px; display:flex; align-items:center; justify-content:center; font-size:12px; color:#6b7280;">Visa</div>
                            <div style="background:#fff; border:1px solid #e5e7eb; border-radius:6px; height:34px; display:flex; align-items:center; justify-content:center; font-size:12px; color:#6b7280;">Mastercard</div>
                            <div style="background:#fff; border:1px solid #e5e7eb; border-radius:6px; height:34px; display:flex; align-items:center; justify-content:center; font-size:12px; color:#6b7280;">AMEX</div>
                            <div style="background:#fff; border:1px solid #e5e7eb; border-radius:6px; height:34px; display:flex; align-items:center; justify-content:center; font-size:12px; color:#6b7280;">KBank</div>
                            <div style="background:#fff; border:1px solid #e5e7eb; border-radius:6px; height:34px; display:flex; align-items:center; justify-content:center; font-size:12px; color:#6b7280;">SCB</div>
                            <div style="background:#fff; border:1px solid #e5e7eb; border-radius:6px; height:34px; display:flex; align-items:center; justify-content:center; font-size:12px; color:#6b7280;">UOB</div>
                        </div>
                    </div>
                    <div>
                        <h4 data-translate="footer_follow_us" style="margin:0 0 12px 0; font-size:14px; color:#111827; text-transform:uppercase; letter-spacing:.02em;">Follow Us</h4>
                        <ul style="list-style:none; padding:0; margin:0; color:#374151; font-size:13px; line-height:2;">
                            <li><a href="#" style="color:#374151; text-decoration:none; display:inline-flex; align-items:center;" onmouseover="this.style.color='#2563eb'" onmouseout="this.style.color='#374151'"><i class="fab fa-facebook" style="width:16px; margin-right:8px;"></i> <span data-translate="facebook">Facebook</span></a></li>
                            <li><a href="#" style="color:#374151; text-decoration:none; display:inline-flex; align-items:center;" onmouseover="this.style.color='#2563eb'" onmouseout="this.style.color='#374151'"><i class="fab fa-instagram" style="width:16px; margin-right:8px;"></i> <span data-translate="instagram">Instagram</span></a></li>
                            <li><a href="#" style="color:#374151; text-decoration:none; display:inline-flex; align-items:center;" onmouseover="this.style.color='#2563eb'" onmouseout="this.style.color='#374151'"><i class="fab fa-line" style="width:16px; margin-right:8px;"></i> <span data-translate="line">LINE</span></a></li>
                            <li><a href="#" style="color:#374151; text-decoration:none; display:inline-flex; align-items:center;" onmouseover="this.style.color='#2563eb'" onmouseout="this.style.color='#374151'"><i class="fab fa-linkedin" style="width:16px; margin-right:8px;"></i> <span data-translate="linkedin">LinkedIn</span></a></li>
                        </ul>
                    </div>
                    <div>
                        <h4 data-translate="footer_app_download" style="margin:0 0 12px 0; font-size:14px; color:#111827; text-transform:uppercase; letter-spacing:.02em;">App Download</h4>
                        <div style="display:flex; flex-direction:column; gap:8px;">
                            <div data-translate="footer_qr_code" style="background:#fff; border:1px solid #e5e7eb; border-radius:6px; height:90px; display:flex; align-items:center; justify-content:center; color:#6b7280; font-size:12px;">QR Code</div>
                            <div style="display:flex; gap:8px;">
                                <a href="#" data-translate="footer_app_store" style="background:#fff; border:1px solid #e5e7eb; border-radius:6px; padding:6px 10px; font-size:12px; color:#111827; text-decoration:none;" onmouseover="this.style.color='#2563eb'" onmouseout="this.style.color='#111827'">App Store</a>
                                <a href="#" data-translate="footer_google_play" style="background:#fff; border:1px solid #e5e7eb; border-radius:6px; padding:6px 10px; font-size:12px; color:#111827; text-decoration:none;" onmouseover="this.style.color='#2563eb'" onmouseout="this.style.color='#111827'">Google Play</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div data-no-translate="true" style="max-width:1100px; margin:0 auto; padding:16px 0 40px 0; border-top:1px solid #e5e7eb; color:#6b7280; font-size:12px;">© 2025 Eddy World. All Rights Reserved.</div>
            `;
            if (wrapper.parentNode) {
                wrapper.parentNode.insertBefore(loginFooter, wrapper.nextSibling);
            }
            // Ensure any new elements inside the login session get translated immediately
            translateNewContent(wrapper);
            // Translate the login footer block as well
            translateNewContent(loginFooter);
        }

        function hideFullLoginPage() {
            const existing = document.getElementById('full-login');
            if (existing) existing.remove();
            const existingFooter = document.getElementById('full-login-footer');
            if (existingFooter && existingFooter.parentElement) existingFooter.parentElement.removeChild(existingFooter);
            try {
                document.body.classList.remove('login-session-active');
                const header = document.querySelector('.header');
                const headerTop = header ? header.querySelector('.header-top') : null;
                const headerMain = header ? header.querySelector('.header-main') : null;
                const searchContainer = header ? header.querySelector('.search-container') : null;
                const headerActions = header ? header.querySelector('.header-actions') : null;
                const logo = header ? header.querySelector('.logo') : null;
                if (headerTop) headerTop.style.display = '';
                if (searchContainer) searchContainer.style.display = '';
                if (headerActions) headerActions.style.display = '';
                if (headerMain) {
                    headerMain.style.background = headerMain.dataset.origBg || '';
                    headerMain.style.padding = headerMain.dataset.origPadding || '';
                }
                const help = document.getElementById('login-help-link');
                if (help && help.parentElement) help.parentElement.removeChild(help);
                const loginLabel = document.getElementById('login-session-label');
                if (loginLabel && loginLabel.parentElement) loginLabel.parentElement.removeChild(loginLabel);
                if (logo && logo.dataset.origHtml) logo.innerHTML = logo.dataset.origHtml;
                // Unhide previously hidden elements
                Array.from(document.querySelectorAll('[data-hide-during-login="1"]')).forEach(el => {
                    el.style.display = '';
                    el.removeAttribute('data-hide-during-login');
                });
            } catch (e) {}
        }
        
        // Guest session management functions
        function resetGuestSession() {
            guestClickCount = 0;
            guestSessionStart = Date.now();
            startGuestSessionTimer();
        }
        
        function extendGuestSession() {
            startGuestSessionTimer();
            addNotification('info', 'Session Extended', 'Your guest session has been extended by 5 minutes!', 'normal');
        }
        
        function getRemainingGuestTime() {
            if (currentUser) return 0;
            const elapsed = Date.now() - guestSessionStart;
            const remaining = GUEST_SESSION_LIMIT - elapsed;
            return Math.max(0, Math.ceil(remaining / 1000 / 60)); // Return minutes
        }
        


        // Close modal function
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // Switch between modals
        function switchModal(fromModalId, toModalId) {
            closeModal(fromModalId);
            // Hide language gate explicitly when switching
            try { hideLanguageGate(); } catch (e) {}
            showModal(toModalId);
        }

        function showCartModal() {
            if (!currentUser) {
                openLoginSession();
                return;
            }

            let cartHTML = '<h3>Shopping Cart</h3>';
            
            if (cart.length === 0) {
                cartHTML += '<p>Your cart is empty</p>';
            } else {
                cartTotal = 0;
                cart.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    cartTotal += itemTotal;
                    
                    cartHTML += `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee;">
                            <div>
                                <strong>${item.name}</strong><br>
                                <small>฿${item.price.toLocaleString()} x ${item.quantity}</small>
                            </div>
                            <div>
                                <button onclick="removeFromCart(${item.id})" style="padding: 5px 10px; background: #ff4444; color: white; border: none; border-radius: 4px; cursor: pointer;">Remove</button>
                            </div>
                        </div>
                    `;
                });
                
                cartHTML += `
                    <div style="margin-top: 20px; text-align: right;">
                        <strong>Total: ฿${cartTotal.toLocaleString()}</strong>
                        <button onclick="checkout()" style="margin-left: 15px; padding: 10px 20px; background: #1e3c72; color: white; border: none; border-radius: 4px; cursor: pointer;">Checkout</button>
                    </div>
                `;
            }
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 20px; border-radius: 8px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>Shopping Cart</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    ${cartHTML}
                </div>
            `;
            
            modal.classList.add('modal');
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            saveToStorage();
            updateCartCount();
            showCartModal();
            trackUserBehavior('remove_from_cart', `User ${currentUser.name} removed product ${productId} from cart`);
            
            // Stop cart abandonment timer if cart is now empty
            if (cart.length === 0) {
                if (cartAbandonmentTimer) {
                    clearTimeout(cartAbandonmentTimer);
                    cartAbandonmentTimer = null;
                }
                removeCartAbandonmentListeners();
            }
        }

        // Escrow System - Makao Guarantee
        function createEscrowTransaction(orderId, amount, buyerId, shopId) {
            const escrowTransaction = {
                id: Date.now(),
                orderId: orderId,
                amount: amount,
                buyerId: buyerId,
                shopId: shopId,
                status: 'held', // held, shipped, delivered, released, disputed, refunded
                createdAt: new Date().toISOString(),
                timeline: [
                    { status: 'held', timestamp: new Date().toISOString(), note: 'Payment held in escrow' }
                ]
            };
            
            escrowTransactions.push(escrowTransaction);
            saveToStorage();
            
            addNotification('info', 'Escrow Created', `Payment of ฿${amount.toLocaleString()} held in escrow for Order #${orderId}`, 'normal');
            
            return escrowTransaction;
        }

        // Update escrow status
        function updateEscrowStatus(orderId, newStatus, note = '') {
            const escrow = escrowTransactions.find(e => e.orderId === orderId);
            if (escrow) {
                escrow.status = newStatus;
                escrow.timeline.push({
                    status: newStatus,
                    timestamp: new Date().toISOString(),
                    note: note
                });
                
                saveToStorage();
                
                // Auto-release escrow after delivery (configurable)
                if (newStatus === 'delivered') {
                    setTimeout(() => {
                        if (escrow.status === 'delivered') {
                            releaseEscrow(orderId, 'Auto-released after delivery confirmation');
                        }
                    }, 3 * 24 * 60 * 60 * 1000); // 3 days default
                }
                
                addNotification('success', 'Escrow Updated', `Order #${orderId} escrow status: ${newStatus}`, 'normal');
            }
        }

        // Release escrow to seller
        function releaseEscrow(orderId, note = '') {
            const escrow = escrowTransactions.find(e => e.orderId === orderId);
            if (escrow && escrow.status === 'delivered') {
                escrow.status = 'released';
                escrow.timeline.push({
                    status: 'released',
                    timestamp: new Date().toISOString(),
                    note: note
                });
                
                saveToStorage();
                
                // Update order status
                const order = orders.find(o => o.orderId === orderId);
                if (order) {
                    order.escrowStatus = 'released';
                    saveToStorage();
                }
                
                addNotification('success', 'Escrow Released', `Payment of ฿${escrow.amount.toLocaleString()} released to seller for Order #${orderId}`, 'normal');
            }
        }

        // Dispute escrow
        function disputeEscrow(orderId, reason, evidence = []) {
            const escrow = escrowTransactions.find(e => e.orderId === orderId);
            if (escrow) {
                escrow.status = 'disputed';
                escrow.timeline.push({
                    status: 'disputed',
                    timestamp: new Date().toISOString(),
                    note: `Dispute opened: ${reason}`,
                    evidence: evidence
                });
                
                saveToStorage();
                
                // Create return request
                const order = orders.find(o => o.orderId === orderId);
                if (order) {
                    createReturnRequest(orderId, reason, evidence);
                }
                
                addNotification('warning', 'Escrow Disputed', `Order #${orderId} payment disputed: ${reason}`, 'high');
            }
        }

        // Create return request
        function createReturnRequest(orderId, reason, evidence = []) {
            const returnRequest = {
                id: Date.now(),
                orderId: orderId,
                reason: reason,
                evidence: evidence,
                status: 'requested', // requested, approved, rejected, escalated, closed
                createdAt: new Date().toISOString(),
                timeline: [
                    { status: 'requested', timestamp: new Date().toISOString(), note: `Return requested: ${reason}` }
                ]
            };
            
            returns.push(returnRequest);
            saveToStorage();
            
            addNotification('info', 'Return Requested', `Return request created for Order #${orderId}`, 'normal');
        }

        // Improved checkout with escrow
        function checkout() {
            if (!currentUser) {
                openLoginSession();
                return;
            }
            
            if (cart.length === 0) {
                alert('Your cart is empty!');
                return;
            }
            
            // Group cart items by shop
            const cartByShop = {};
            cart.forEach(item => {
                const product = products.find(p => p.id === item.id);
                if (product) {
                    if (!cartByShop[product.shopId]) {
                        cartByShop[product.shopId] = [];
                    }
                    cartByShop[product.shopId].push(item);
                }
            });
            
            // Create orders for each shop
            const createdOrders = [];
            
            Object.keys(cartByShop).forEach(shopId => {
                const shopItems = cartByShop[shopId];
                const shopTotal = shopItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                
                // Create new order
                const newOrder = {
                    orderId: orderCounter++,
                    buyerId: currentUser ? currentUser.email : 'guest',
                    buyerName: currentUser ? currentUser.name : 'Guest User',
                    buyerEmail: currentUser ? currentUser.email : 'guest@example.com',
                    shopId: parseInt(shopId),
                    shopName: shops.find(s => s.id === parseInt(shopId))?.name || 'Unknown Shop',
                    orderDate: new Date().toISOString(),
                    items: [...shopItems],
                    subtotal: shopTotal,
                    shippingFee: calculateShippingFee(shopTotal),
                    total: shopTotal + calculateShippingFee(shopTotal),
                    status: 'pending_payment',
                    escrowStatus: 'pending',
                    paymentMethod: 'Credit Card',
                    shippingAddress: 'To be provided',
                    timeline: [
                        { status: 'pending_payment', timestamp: new Date().toISOString(), note: 'Order created, awaiting payment' }
                    ]
                };
                
                orders.push(newOrder);
                createdOrders.push(newOrder);
                
                // Create escrow transaction
                createEscrowTransaction(newOrder.orderId, newOrder.total, newOrder.buyerId, newOrder.shopId);
                
                // Update inventory
                shopItems.forEach(item => {
                    updateProductStock(item.id, -item.quantity, `Order #${newOrder.orderId}`);
                });
            });
            
            saveToStorage();
            
            // Clear cart after successful order creation
            cart = [];
            saveToStorage();
            updateCartCount();
            
            // Stop cart abandonment timer since cart is now empty
            if (cartAbandonmentTimer) {
                clearTimeout(cartAbandonmentTimer);
                cartAbandonmentTimer = null;
            }
            removeCartAbandonmentListeners();
            
            // Show order confirmation
            showOrderConfirmation(createdOrders);
            
            // Track order completion
            trackUserBehavior('order_completed', `Created ${createdOrders.length} orders with escrow protection`);
        }

        // Calculate shipping fee
        function calculateShippingFee(subtotal) {
            if (subtotal >= 1000) return 0; // Free shipping over ฿1000
            if (subtotal >= 500) return 50; // ฿50 for orders ฿500-฿999
            return 100; // ฿100 for orders under ฿500
        }

        // Update product stock
        function updateProductStock(productId, delta, reason) {
            const product = products.find(p => p.id === productId);
            if (product) {
                product.stock += delta;
                if (product.stock < 0) product.stock = 0;
                
                // Update inventory tracking
                if (inventory[productId]) {
                    inventory[productId].stock = product.stock;
                }
                
                saveToStorage();
                
                // Check for low stock alerts
                if (product.stock <= 5 && product.stock > 0) {
                    addNotification('warning', 'Low Stock Alert', `${product.title} is running low (${product.stock} remaining)`, 'high');
                }
                
                if (product.stock === 0) {
                    addNotification('error', 'Out of Stock', `${product.title} is now out of stock`, 'urgent');
                }
            }
        }

        // Show order confirmation
        function showOrderConfirmation(createdOrders) {
            let confirmationHTML = '<h3>🎉 Orders Created Successfully!</h3>';
            confirmationHTML += '<p>Your orders have been created with Makao Guarantee protection:</p>';
            
            createdOrders.forEach(order => {
                confirmationHTML += `
                    <div style="border: 1px solid #eee; border-radius: 10px; padding: 15px; margin-bottom: 15px; background: #fafafa;">
                        <h4 style="margin: 0 0 10px 0; color: #667eea;">Order #${order.orderId}</h4>
                        <p><strong>Shop:</strong> ${order.shopName}</p>
                        <p><strong>Total:</strong> ฿${order.total.toLocaleString()}</p>
                        <p><strong>Items:</strong> ${order.items.length} products</p>
                        <p><strong>Status:</strong> <span style="background: #ffa500; color: white; padding: 3px 10px; border-radius: 10px; font-size: 12px;">Pending Payment</span></p>
                        <p><strong>Escrow:</strong> <span style="background: #4ecdc4; color: white; padding: 3px 10px; border-radius: 10px; font-size: 12px;">Payment Held</span></p>
                    </div>
                `;
            });
            
            confirmationHTML += `
                <div style="background: #e8f5e8; border: 1px solid #4caf50; border-radius: 10px; padding: 15px; margin-top: 20px;">
                    <h4 style="margin: 0 0 10px 0; color: #4caf50;">🔒 Makao Guarantee Protection</h4>
                    <p style="margin: 0; color: #2e7d32;">
                        Your payment is held securely in escrow until you confirm delivery. 
                        If there are any issues, you can open a dispute within 15 days of delivery.
                    </p>
                </div>
            `;
            
            alert(confirmationHTML.replace(/<[^>]*>/g, ''));
        }

        // Show order history for customers
        function showOrderHistory() {
            if (!currentUser) {
                alert('Please login to view your order history.');
                return;
            }
            
            const userOrders = orders.filter(order => order.customerEmail === currentUser.email);
            
            if (userOrders.length === 0) {
                alert('You have no orders yet.');
                return;
            }
            
            let orderHistoryHTML = '<h3>📦 My Order History</h3>';
            orderHistoryHTML += '<div style="max-height: 400px; overflow-y: auto;">';
            
            userOrders.forEach(order => {
                const orderDate = new Date(order.orderDate).toLocaleDateString();
                const statusColor = getStatusColor(order.status);
                
                orderHistoryHTML += `
                    <div style="border: 1px solid #eee; border-radius: 10px; padding: 15px; margin-bottom: 15px; background: #fafafa;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h4 style="margin: 0; color: #667eea;">Order #${order.orderId}</h4>
                            <span style="background: ${statusColor}; color: white; padding: 5px 12px; border-radius: 15px; font-size: 12px;">${order.status}</span>
                        </div>
                        <p><strong>Date:</strong> ${orderDate}</p>
                        <p><strong>Total:</strong> ฿${order.total.toLocaleString()}</p>
                        <p><strong>Items:</strong> ${order.items.length} products</p>
                        <p><strong>Tracking:</strong> ${order.trackingNumber}</p>
                        <button onclick="viewOrderDetails(${order.orderId})" style="padding: 8px 15px; background: #667eea; color: white; border: none; border-radius: 15px; cursor: pointer; margin-top: 10px;">View Details</button>
                    </div>
                `;
            });
            
            orderHistoryHTML += '</div>';
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 25px; border-radius: 20px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="color: #667eea; margin: 0;">📦 Order History</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    ${orderHistoryHTML}
                </div>
            `;
            
            modal.classList.add('modal');
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // View order details
        function viewOrderDetails(orderId) {
            const order = orders.find(o => o.orderId === orderId);
            if (!order) return;
            
            let detailsHTML = `
                <h3>📦 Order #${order.orderId} Details</h3>
                <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                    <h4>Customer Information</h4>
                    <p><strong>Name:</strong> ${order.customerName}</p>
                    <p><strong>Email:</strong> ${order.customerEmail}</p>
                    <p><strong>Order Date:</strong> ${new Date(order.orderDate).toLocaleString()}</p>
                    <p><strong>Status:</strong> <span style="background: ${getStatusColor(order.status)}; color: white; padding: 3px 10px; border-radius: 10px; font-size: 12px;">${order.status}</span></p>
                    <p><strong>Tracking Number:</strong> ${order.trackingNumber}</p>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                    <h4>Order Items</h4>
                    ${order.items.map(item => `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee;">
                            <div>
                                <strong>${item.name}</strong><br>
                                <small>฿${item.price.toLocaleString()} x ${item.quantity}</small>
                            </div>
                            <div style="font-weight: bold; color: #667eea;">
                                ฿${(item.price * item.quantity).toLocaleString()}
                            </div>
                        </div>
                    `).join('')}
                    <div style="text-align: right; margin-top: 15px; padding-top: 15px; border-top: 2px solid #667eea;">
                        <h3>Total: ฿${order.total.toLocaleString()}</h3>
                    </div>
                </div>
            `;
            
            alert(detailsHTML.replace(/<[^>]*>/g, '')); // Simple alert for now
        }

        // Get status color
        function getStatusColor(status) {
            const colors = {
                'Pending': '#ffa500',
                'Processing': '#667eea',
                'Shipped': '#4ecdc4',
                'Delivered': '#4caf50',
                'Cancelled': '#ff6b6b'
            };
            return colors[status] || '#666';
        }

        // Admin: Show all orders
        function showAllOrders() {
            if (orders.length === 0) {
                alert('No orders found.');
                return;
            }
            
            let allOrdersHTML = '<h3>📦 All Orders (Admin View)</h3>';
            allOrdersHTML += '<div style="max-height: 500px; overflow-y: auto;">';
            
            orders.forEach(order => {
                const orderDate = new Date(order.orderDate).toLocaleDateString();
                const statusColor = getStatusColor(order.status);
                
                allOrdersHTML += `
                    <div style="border: 1px solid #eee; border-radius: 10px; padding: 15px; margin-bottom: 15px; background: #fafafa;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h4 style="margin: 0; color: #667eea;">Order #${order.orderId}</h4>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <span style="background: ${statusColor}; color: white; padding: 5px 12px; border-radius: 15px; font-size: 12px;">${order.status}</span>
                                <select onchange="updateOrderStatus(${order.orderId}, this.value)" style="padding: 5px; border-radius: 5px; border: 1px solid #ddd;">
                                    <option value="Pending" ${order.status === 'Pending' ? 'selected' : ''}>Pending</option>
                                    <option value="Processing" ${order.status === 'Processing' ? 'selected' : ''}>Processing</option>
                                    <option value="Shipped" ${order.status === 'Shipped' ? 'selected' : ''}>Shipped</option>
                                    <option value="Delivered" ${order.status === 'Delivered' ? 'selected' : ''}>Delivered</option>
                                    <option value="Cancelled" ${order.status === 'Cancelled' ? 'selected' : ''}>Cancelled</option>
                                </select>
                            </div>
                        </div>
                        <p><strong>Customer:</strong> ${order.customerName} (${order.customerEmail})</p>
                        <p><strong>Date:</strong> ${orderDate}</p>
                        <p><strong>Total:</strong> ฿${order.total.toLocaleString()}</p>
                        <p><strong>Items:</strong> ${order.items.length} products</p>
                        <p><strong>Tracking:</strong> ${order.trackingNumber}</p>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <button onclick="viewOrderDetails(${order.orderId})" style="padding: 8px 15px; background: #667eea; color: white; border: none; border-radius: 15px; cursor: pointer;">View Details</button>
                            <button onclick="deleteOrder(${order.orderId})" style="padding: 8px 15px; background: #ff6b6b; color: white; border: none; border-radius: 15px; cursor: pointer;">Delete</button>
                        </div>
                    </div>
                `;
            });
            
            allOrdersHTML += '</div>';
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 25px; border-radius: 20px; max-width: 800px; width: 95%; max-height: 85vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="color: #667eea; margin: 0;">📦 Order Management (Admin)</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    ${allOrdersHTML}
                </div>
            `;
            
            modal.classList.add('modal');
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Update order status
        function updateOrderStatus(orderId, newStatus) {
            const order = orders.find(o => o.orderId === orderId);
            if (order) {
                order.status = newStatus;
                saveToStorage();
                trackUserBehavior('order_status_updated', `Order #${orderId} status changed to ${newStatus}`);
            }
        }

        // Delete order
        function deleteOrder(orderId) {
            if (confirm(`Are you sure you want to delete Order #${orderId}?`)) {
                orders = orders.filter(o => o.orderId !== orderId);
                saveToStorage();
                trackUserBehavior('order_deleted', `Order #${orderId} deleted`);
                showAllOrders(); // Refresh the view
            }
        }

        // Wishlist functions
        function toggleWishlist(productId, event) {
            event.stopPropagation();
            
            if (!currentUser) {
                showLoginPrompt('Please log in to add items to your wishlist and save your favorites.');
                return;
            }

            const product = wishlist.find(item => item.id === productId);
            const wishlistBtn = event.currentTarget;
            const heartIcon = wishlistBtn.querySelector('i');
            
            if (product) {
                // Remove from wishlist
                wishlist = wishlist.filter(item => item.id !== productId);
                heartIcon.className = 'far fa-heart';
                wishlistBtn.title = 'Add to Wishlist';
                alert('Product removed from wishlist!');
                trackUserBehavior('remove_from_wishlist', `User ${currentUser.name} removed product ${productId} from wishlist`);
            } else {
                // Add to wishlist
                wishlist.push({ id: productId });
                heartIcon.className = 'fas fa-heart';
                wishlistBtn.title = 'Remove from Wishlist';
                alert('Product added to wishlist!');
                trackUserBehavior('add_to_wishlist', `User ${currentUser.name} added product ${productId} to wishlist`);
            }
            
            saveToStorage();
            updateWishlistCount();
        }

        function updateWishlistCount() {
            document.querySelector('.wishlist-count').textContent = wishlist.length;
        }
        function showWishlist() {
            if (!currentUser) {
                showLoginPrompt('Please log in to view your wishlist and saved items.');
                return;
            }

            const productNames = {
                1: 'Smartphone Pro Max 2024',
                2: 'Gaming Laptop Ultra',
                3: 'Wireless Headphones Pro',
                4: '4K Action Camera',
                5: 'iPad Air 2024',
                6: 'Smart Watch Series 8'
            };

            const productPrices = {
                1: 15999,
                2: 45999,
                3: 2999,
                4: 8999,
                5: 25999,
                6: 12999
            };

            let wishlistHTML = '<h3>My Wishlist</h3>';
            
            if (wishlist.length === 0) {
                wishlistHTML += '<p>Your wishlist is empty. Add some products!</p>';
            } else {
                wishlistHTML += '<div style="max-height: 300px; overflow-y: auto;">';
                wishlist.forEach(item => {
                    const name = productNames[item.id] || 'Unknown Product';
                    const price = productPrices[item.id] || 0;
                    wishlistHTML += `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee;">
                            <div>
                                <strong>${name}</strong><br>
                                <small>฿${price.toLocaleString()}</small>
                            </div>
                            <div>
                                <button onclick="addToCart(${item.id}, '${name}', ${price})" style="padding: 5px 10px; background: #1e3c72; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 5px;">Add to Cart</button>
                                <button onclick="removeFromWishlist(${item.id})" style="padding: 5px 10px; background: #ff4444; color: white; border: none; border-radius: 4px; cursor: pointer;">Remove</button>
                            </div>
                        </div>
                    `;
                });
                wishlistHTML += '</div>';
            }
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 20px; border-radius: 8px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>My Wishlist</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    ${wishlistHTML}
                </div>
            `;
            
            modal.classList.add('modal');
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function removeFromWishlist(productId) {
            wishlist = wishlist.filter(item => item.id !== productId);
            saveToStorage();
            updateWishlistCount();
            showWishlist();
            trackUserBehavior('remove_from_wishlist', `User ${currentUser.name} removed product ${productId} from wishlist`);
        }

        // Product functions
        function showProductDetails(productId, readOnly = false) {
            const products = {
                1: { name: 'Smartphone Pro Max 2024', price: '฿15,999', description: 'Latest smartphone with advanced features, high-resolution camera, and long battery life.' },
                2: { name: 'Gaming Laptop Ultra', price: '฿45,999', description: 'High-performance gaming laptop with RTX graphics and fast refresh rate.' },
                3: { name: 'Wireless Headphones Pro', price: '฿2,999', description: 'Premium wireless headphones with noise cancellation and premium sound quality.' },
                4: { name: '4K Action Camera', price: '฿8,999', description: 'Professional action camera with 4K recording and waterproof design.' },
                5: { name: 'iPad Air 2024', price: '฿25,999', description: 'Latest iPad with powerful performance and stunning Retina display.' },
                6: { name: 'Smart Watch Series 8', price: '฿12,999', description: 'Advanced smartwatch with health monitoring and fitness tracking.' }
            };
            
            const product = products[productId];
            const isGuest = !currentUser;
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 20px; border-radius: 8px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>${product.name}</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="width: 200px; height: 200px; background: linear-gradient(45deg, #e3f2fd, #bbdefb); border-radius: 8px; display: flex; align-items: center; justify-content: center; margin: 0 auto; color: #1e3c72; font-size: 80px;">
                            <i class="fas fa-${getProductIcon(productId)}"></i>
                        </div>
                    </div>
                    <p style="font-size: 24px; color: #ff6b35; font-weight: bold; text-align: center; margin-bottom: 20px;">${product.price}</p>
                    <p style="line-height: 1.6; color: #666; margin-bottom: 20px;">${product.description}</p>
                    
                    ${isGuest ? `
                        <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; margin-bottom: 20px; text-align: center;">
                            <p style="margin: 0; color: #667eea; font-weight: 500;">👋 Guest Mode</p>
                            <p style="margin: 5px 0 0 0; color: #666; font-size: 14px;">Log in to add to cart and wishlist</p>
                        </div>
                    ` : ''}
                    
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        ${isGuest ? `
                            <button onclick="showLoginPrompt('Please log in to add items to your cart and make purchases.')" style="padding: 12px 25px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;">🔑 Login to Add to Cart</button>
                            <button onclick="showLoginPrompt('Please log in to save items to your wishlist.')" style="padding: 12px 25px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">❤️ Login for Wishlist</button>
                        ` : `
                            <button onclick="addToCart(${productId}, '${product.name}', ${product.price.replace('฿', '').replace(',', '')})" style="padding: 12px 25px; background: #1d4ed8; color: white; border: none; border-radius: 4px; cursor: pointer;">Add to Cart</button>
                            <button onclick="toggleWishlist(${productId}, event)" style="padding: 12px 25px; background: #2563eb; color: white; border: none; border-radius: 4px; cursor: pointer;">Add to Wishlist</button>
                        `}
                    </div>
                </div>
            `;
            
            modal.classList.add('modal');
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            trackUserBehavior('view_product_details', `User ${currentUser ? currentUser.name : 'Guest'} viewed product details for ${product.name}`);
        }

        function getProductIcon(productId) {
            const icons = {
                1: 'mobile-alt',
                2: 'laptop',
                3: 'headphones',
                4: 'camera',
                5: 'tablet-alt',
                6: 'watch'
            };
            return icons[productId] || 'box';
        }

        // Search functionality
        document.querySelector('.search-btn').addEventListener('click', function() {
            const searchTerm = document.querySelector('.search-input').value;
            if (searchTerm.trim()) {
                alert(`Searching for: ${searchTerm}\n\nThis feature will be implemented with a backend database.`);
                customerData.searchQueries.push(searchTerm);
                saveToStorage();
                trackUserBehavior('search', `User ${currentUser ? currentUser.name : 'Guest'} searched for: ${searchTerm}`);
            }
        });

        // Enter key for search
        document.querySelector('.search-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.querySelector('.search-btn').click();
            }
        });

        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // Initialize display
        updateCartCount();
        updateWishlistCount();

        // Track page views
        function trackPageView() {
            customerData.pageViews++;
            saveToStorage();
        }

        // Track user behavior
        function trackUserBehavior(action, details) {
            customerData.userBehavior.push({
                timestamp: new Date(),
                action: action,
                details: details
            });
            saveToStorage();
        }

        // Example of a simple analytics dashboard (for demonstration)
        function displayAnalytics() {
            const analyticsModal = document.createElement('div');
            analyticsModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            // Calculate some basic metrics
            const totalUsers = users.length;
            const activeUsers = currentUser ? 1 : 0;
            const totalProducts = 6; // Hardcoded for demo
            const conversionRate = customerData.pageViews > 0 ? ((cart.length / customerData.pageViews) * 100).toFixed(2) : 0;
            
            // Calculate order metrics
            const totalOrders = orders.length;
            const totalRevenue = orders.reduce((sum, order) => sum + order.total, 0);
            const pendingOrders = orders.filter(order => order.status === 'Pending').length;
            const completedOrders = orders.filter(order => order.status === 'Delivered').length;
            
            analyticsModal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 20px; max-width: 900px; width: 95%; max-height: 85vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2 style="color: #667eea; margin: 0;">📊 Analytics Dashboard</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">&times;</button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                            <h3 style="margin: 0 0 10px 0; font-size: 14px;">Total Page Views</h3>
                            <p style="font-size: 24px; font-weight: bold; margin: 0;">${customerData.pageViews}</p>
                        </div>
                        <div style="background: linear-gradient(135deg, #ff6b6b, #ffa500); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                            <h3 style="margin: 0 0 10px 0; font-size: 14px;">Registered Users</h3>
                            <p style="font-size: 24px; font-weight: bold; margin: 0;">${totalUsers}</p>
                        </div>
                        <div style="background: linear-gradient(135deg, #4ecdc4, #44a08d); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                            <h3 style="margin: 0 0 10px 0; font-size: 14px;">Total Orders</h3>
                            <p style="font-size: 24px; font-weight: bold; margin: 0;">${totalOrders}</p>
                        </div>
                        <div style="background: linear-gradient(135deg, #a8edea, #fed6e3); color: #333; padding: 20px; border-radius: 15px; text-align: center;">
                            <h3 style="margin: 0 0 10px 0; font-size: 14px;">Total Revenue</h3>
                            <p style="font-size: 24px; font-weight: bold; margin: 0;">฿${totalRevenue.toLocaleString()}</p>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                        <div>
                            <h3 style="color: #667eea; margin-bottom: 15px;">👥 User Activity</h3>
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 15px;">
                                <p><strong>Current User:</strong> ${currentUser ? currentUser.name : 'Guest'}</p>
                                <p><strong>User Email:</strong> ${currentUser ? currentUser.email : 'N/A'}</p>
                                <p><strong>Wishlist Items:</strong> ${wishlist.length}</p>
                                <p><strong>Cart Items:</strong> ${cart.length}</p>
                                <p><strong>Search Queries:</strong> ${customerData.searchQueries.length}</p>
                                <p><strong>Session Duration:</strong> ${Math.round((new Date() - new Date(customerData.sessionStart)) / 1000 / 60)} minutes</p>
                            </div>
                        </div>
                        
                        <div>
                            <h3 style="color: #667eea; margin-bottom: 15px;">📦 Order Statistics</h3>
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 15px;">
                                <p><strong>Total Orders:</strong> ${totalOrders}</p>
                                <p><strong>Pending Orders:</strong> ${pendingOrders}</p>
                                <p><strong>Completed Orders:</strong> ${completedOrders}</p>
                                <p><strong>Total Revenue:</strong> ฿${totalRevenue.toLocaleString()}</p>
                                <p><strong>Average Order Value:</strong> ฿${totalOrders > 0 ? (totalRevenue / totalOrders).toFixed(0) : 0}</p>
                                <p><strong>Conversion Rate:</strong> ${conversionRate}%</p>
                            </div>
                        </div>
                    </div>

                    <div style="margin-bottom: 30px;">
                        <h3 style="color: #667eea; margin-bottom: 15px;">🔍 Search Analytics</h3>
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; max-height: 200px; overflow-y: auto;">
                            ${customerData.searchQueries.length > 0 ? 
                                customerData.searchQueries.map(query => `<p style="margin: 5px 0;">🔍 "${query}"</p>`).join('') : 
                                '<p style="color: #666;">No search queries yet</p>'
                            }
                        </div>
                    </div>

                    <div style="margin-bottom: 30px;">
                        <h3 style="color: #667eea; margin-bottom: 15px;">📈 Recent User Behavior</h3>
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; max-height: 200px; overflow-y: auto;">
                            ${customerData.userBehavior.length > 0 ? 
                                customerData.userBehavior.slice(-10).map(item => 
                                    `<div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #eee;">
                                        <span style="color: #666; font-size: 12px;">${item.timestamp.toLocaleString()}</span>
                                        <span style="font-weight: 500;">${item.action}</span>
                                        <span style="color: #667eea; font-size: 12px;">${item.details}</span>
                                    </div>`
                                ).join('') : 
                                '<p style="color: #666;">No user behavior data yet</p>'
                            }
                        </div>
                    </div>

                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <button onclick="exportCustomerData()" style="padding: 12px 25px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                            📥 Export Customer Data
                        </button>
                        <button onclick="showAllOrders()" style="padding: 12px 25px; background: linear-gradient(135deg, #4ecdc4, #44a08d); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                            📦 Manage Orders
                        </button>
                        <button onclick="clearCustomerData()" style="padding: 12px 25px; background: linear-gradient(135deg, #ff6b6b, #ffa500); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                            🗑️ Clear Data
                        </button>
                    </div>
                </div>
            `;
            
            analyticsModal.classList.add('modal');
            document.body.appendChild(analyticsModal);
            analyticsModal.addEventListener('click', function(e) {
                if (e.target === analyticsModal) {
                    analyticsModal.remove();
                }
            });
        }

        // Export customer data to JSON file
        function exportCustomerData() {
            const dataToExport = {
                exportDate: new Date().toISOString(),
                summary: {
                    totalUsers: users.length,
                    totalOrders: orders.length,
                    totalRevenue: orders.reduce((sum, order) => sum + order.total, 0),
                    totalPageViews: customerData.pageViews,
                    totalSearchQueries: customerData.searchQueries.length
                },
                users: users,
                orders: orders,
                customerData: customerData,
                currentSession: {
                    cart: cart,
                    wishlist: wishlist,
                    currentUser: currentUser
                }
            };
            
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `eddy-world-complete-data-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            alert(`📊 Data exported successfully!\n\n📈 Summary:\n- Users: ${dataToExport.summary.totalUsers}\n- Orders: ${dataToExport.summary.totalOrders}\n- Revenue: ฿${dataToExport.summary.totalRevenue.toLocaleString()}\n- Page Views: ${dataToExport.summary.totalPageViews}`);
        }

        // Clear customer data (admin function)
        function clearCustomerData() {
            if (confirm('Are you sure you want to clear all customer data? This action cannot be undone.')) {
                customerData = {
                    pageViews: 0,
                    productViews: {},
                    searchQueries: [],
                    cartAbandonments: 0,
                    sessionStart: new Date(),
                    userBehavior: []
                };
                saveToStorage();
                alert('Customer data cleared successfully!');
                displayAnalytics(); // Refresh the dashboard
            }
        }

        // Example of a simple cart abandonment tracking
        let cartAbandonmentTimer;
        function startCartAbandonmentTimer() {
            // Only start timer if there are items in cart
            if (cart.length === 0) return;
            
            // Clear any existing timer
            if (cartAbandonmentTimer) {
                clearTimeout(cartAbandonmentTimer);
            }
            
            cartAbandonmentTimer = setTimeout(() => {
                // Only show alert if cart still has items
                if (cart.length > 0) {
                    customerData.cartAbandonments++;
                    saveToStorage();
                    alert('You left items in your cart! Please complete your purchase.');
                    trackUserBehavior('cart_abandonment', 'User abandoned cart');
                }
            }, 1800000); // 30 minutes instead of 10 seconds
        }

        function resetCartAbandonmentTimer() {
            // Only reset if there are items in cart
            if (cart.length === 0) return;
            
            if (cartAbandonmentTimer) {
                clearTimeout(cartAbandonmentTimer);
            }
        }

        // Add event listeners for cart abandonment (only when cart has items)
        function setupCartAbandonmentListeners() {
            if (cart.length > 0) {
                document.addEventListener('mousemove', resetCartAbandonmentTimer);
                document.addEventListener('keydown', resetCartAbandonmentTimer);
                document.addEventListener('scroll', resetCartAbandonmentTimer);
                document.addEventListener('click', () => {
                    resetCartAbandonmentTimer();
                    startCartAbandonmentTimer();
                });
            }
        }

        // Remove cart abandonment listeners when cart is empty
        function removeCartAbandonmentListeners() {
            document.removeEventListener('mousemove', resetCartAbandonmentTimer);
            document.removeEventListener('keydown', resetCartAbandonmentTimer);
            document.removeEventListener('scroll', resetCartAbandonmentTimer);
        }

        // Create default admin account
        function createDefaultAdmin() {
            if (!users.find(u => u.email === 'admin@eddyworld.com')) {
                const adminUser = {
                    name: 'Admin',
                    email: 'admin@eddyworld.com',
                    password: 'admin123',
                    role: 'admin'
                };
                users.push(adminUser);
                saveToStorage();
            }
        }

        // Enhanced Admin Dashboard
        function showAdminDashboard() {
            if (!isAdmin) {
                alert('Access denied. Admin privileges required.');
                return;
            }
            
            const totalUsers = users.length;
            const totalShops = shops.length;
            const totalProducts = products.length;
            const totalOrders = orders.length;
            const totalRevenue = orders.reduce((sum, order) => sum + order.total, 0);
            const pendingShops = shops.filter(s => s.status === 'pending' || s.status === 'kyc_pending').length;
            const activeShops = shops.filter(s => s.status === 'active').length;
            const totalEscrow = escrowTransactions.reduce((sum, escrow) => sum + escrow.amount, 0);
            const disputedEscrow = escrowTransactions.filter(e => e.status === 'disputed').length;
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 20px; max-width: 1200px; width: 95%; max-height: 90vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2 style="color: #667eea; margin: 0;">👑 Admin Dashboard - Eddy World</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    
                    <!-- Key Metrics -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                            <h3 style="margin: 0 0 10px 0; font-size: 14px;">Total Users</h3>
                            <p style="font-size: 24px; font-weight: bold; margin: 0;">${totalUsers}</p>
                        </div>
                        <div style="background: linear-gradient(135deg, #ff6b6b, #ffa500); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                            <h3 style="margin: 0 0 10px 0; font-size: 14px;">Total Shops</h3>
                            <p style="font-size: 24px; font-weight: bold; margin: 0;">${totalShops}</p>
                        </div>
                        <div style="background: linear-gradient(135deg, #4ecdc4, #44a08d); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                            <h3 style="margin: 0 0 10px 0; font-size: 14px;">Total Products</h3>
                            <p style="font-size: 24px; font-weight: bold; margin: 0;">${totalProducts}</p>
                        </div>
                        <div style="background: linear-gradient(135deg, #a8edea, #fed6e3); color: #333; padding: 20px; border-radius: 15px; text-align: center;">
                            <h3 style="margin: 0 0 10px 0; font-size: 14px;">Total Orders</h3>
                            <p style="font-size: 24px; font-weight: bold; margin: 0;">${totalOrders}</p>
                        </div>
                        <div style="background: linear-gradient(135deg, #ffd89b, #19547b); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                            <h3 style="margin: 0 0 10px 0; font-size: 14px;">Total Revenue</h3>
                            <p style="font-size: 24px; font-weight: bold; margin: 0;">฿${totalRevenue.toLocaleString()}</p>
                        </div>
                        <div style="background: linear-gradient(135deg, #ff9a9e, #fecfef); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                            <h3 style="margin: 0 0 10px 0; font-size: 14px;">Escrow Amount</h3>
                            <p style="font-size: 24px; font-weight: bold; margin: 0;">฿${totalEscrow.toLocaleString()}</p>
                        </div>
                    </div>

                    <!-- Shop Management -->
                    <div style="background: #f8f9fa; border-radius: 15px; padding: 20px; margin-bottom: 30px;">
                        <h3 style="margin: 0 0 20px 0; color: #333;">🏪 Shop Management</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px;">
                            <div style="background: white; padding: 15px; border-radius: 10px; text-align: center; border-left: 4px solid #28a745;">
                                <h4 style="margin: 0; color: #28a745; font-size: 16px;">Active Shops</h4>
                                <p style="font-size: 20px; font-weight: bold; margin: 5px 0 0 0; color: #333;">${activeShops}</p>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 10px; text-align: center; border-left: 4px solid #ffc107;">
                                <h4 style="margin: 0; color: #ffc107; font-size: 16px;">Pending Shops</h4>
                                <p style="font-size: 20px; font-weight: bold; margin: 5px 0 0 0; color: #333;">${pendingShops}</p>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 10px; text-align: center; border-left: 4px solid #dc3545;">
                                <h4 style="margin: 0; color: #dc3545; font-size: 16px;">Disputed Escrow</h4>
                                <p style="font-size: 20px; font-weight: bold; margin: 5px 0 0 0; color: #333;">${disputedEscrow}</p>
                            </div>
                        </div>
                        <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                            <button onclick="showShopVerification()" style="padding: 12px 25px; background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                                ✅ Verify Shops
                            </button>
                            <button onclick="showKYCManagement()" style="padding: 12px 25px; background: linear-gradient(135deg, #ffc107, #fd7e14); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                                📋 KYC Management
                            </button>
                            <button onclick="showEscrowManagement()" style="padding: 12px 25px; background: linear-gradient(135deg, #dc3545, #e83e8c); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                                🔒 Escrow Management
                            </button>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-bottom: 30px;">
                        <button onclick="showUserManagement()" style="padding: 12px 25px; background: linear-gradient(135deg, #6f42c1, #e83e8c); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                            👥 User Management
                        </button>
                        <button onclick="showOrderManagement()" style="padding: 12px 25px; background: linear-gradient(135deg, #fd7e14, #ff6b6b); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                            📦 Order Management
                        </button>
                        <button onclick="showInventoryManagement()" style="padding: 12px 25px; background: linear-gradient(135deg, #20c997, #17a2b8); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                            📊 Inventory Management
                        </button>
                        <button onclick="showLiveSessionManagement()" style="padding: 12px 25px; background: linear-gradient(135deg, #e83e8c, #6f42c1); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                            📺 Live Sessions
                        </button>
                        <button onclick="showVoucherManagement()" style="padding: 12px 25px; background: linear-gradient(135deg, #17a2b8, #6f42c1); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                            🎫 Voucher Management
                        </button>
                        <button onclick="showBannerManagement()" style="padding: 12px 25px; background: linear-gradient(135deg, #ff6b35, #f7931e); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                            🖼️ Banner Management
                        </button>
                        <button onclick="displayAnalytics()" style="padding: 12px 25px; background: linear-gradient(135deg, #6c757d, #495057); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                            📈 Analytics
                        </button>
                    </div>

                    <!-- Recent Activity -->
                    <div style="background: #f8f9fa; border-radius: 15px; padding: 20px;">
                        <h3 style="margin: 0 0 20px 0; color: #333;">🕒 Recent Activity</h3>
                        <div style="max-height: 200px; overflow-y: auto;">
                            ${getRecentAdminActivity()}
                        </div>
                    </div>
                </div>
            `;
            
            modal.classList.add('modal');
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Get recent admin activity
        function getRecentAdminActivity() {
            const activities = [];
            
            // Recent orders
            const recentOrders = orders.slice(-5).reverse();
            recentOrders.forEach(order => {
                activities.push({
                    type: 'order',
                    text: `Order #${order.orderId} placed by ${order.buyerName}`,
                    time: new Date(order.orderDate).toLocaleString(),
                    priority: 'normal'
                });
            });
            
            // Recent shop activities
            const recentShops = shops.slice(-3).reverse();
            recentShops.forEach(shop => {
                activities.push({
                    type: 'shop',
                    text: `Shop "${shop.name}" ${shop.status === 'active' ? 'activated' : 'created'}`,
                    time: new Date(shop.createdAt).toLocaleString(),
                    priority: 'high'
                });
            });
            
            // Recent escrow activities
            const recentEscrow = escrowTransactions.slice(-3).reverse();
            recentEscrow.forEach(escrow => {
                activities.push({
                    type: 'escrow',
                    text: `Escrow ${escrow.status} for Order #${escrow.orderId}`,
                    time: new Date(escrow.createdAt).toLocaleString(),
                    priority: 'urgent'
                });
            });
            
            // Sort by time and take top 10
            activities.sort((a, b) => new Date(b.time) - new Date(a.time));
            
            return activities.slice(0, 10).map(activity => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: white; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid ${getActivityColor(activity.priority)};">
                    <div>
                        <p style="margin: 0; color: #333; font-size: 14px;">${activity.text}</p>
                        <p style="margin: 0; color: #999; font-size: 12px;">${activity.time}</p>
                    </div>
                    <span style="background: ${getActivityColor(activity.priority)}; color: white; padding: 3px 8px; border-radius: 10px; font-size: 10px; text-transform: uppercase;">
                        ${activity.priority}
                    </span>
                </div>
            `).join('');
        }

        // Get activity color
        function getActivityColor(priority) {
            switch (priority) {
                case 'urgent': return '#dc3545';
                case 'high': return '#ffc107';
                case 'normal': return '#28a745';
                default: return '#6c757d';
            }
        }

        // Show shop verification interface
        function showShopVerification() {
            const pendingShops = shops.filter(s => s.status === 'pending' || s.status === 'kyc_pending');
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 20px; max-width: 1000px; width: 95%; max-height: 90vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2 style="color: #667eea; margin: 0;">✅ Shop Verification</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    
                    ${pendingShops.length > 0 ? pendingShops.map(shop => `
                        <div style="border: 1px solid #eee; border-radius: 15px; padding: 20px; margin-bottom: 20px; background: #fafafa;">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                                <div>
                                    <h4 style="margin: 0 0 10px 0; color: #333;">${shop.name}</h4>
                                    <p style="margin: 0 0 5px 0; color: #666;">${shop.description}</p>
                                    <p style="margin: 0; color: #999; font-size: 14px;">Owner: ${shop.ownerId}</p>
                                    <p style="margin: 0; color: #999; font-size: 14px;">Type: ${shop.type}</p>
                                    <p style="margin: 0; color: #999; font-size: 14px;">Status: <span style="background: #ffc107; color: white; padding: 2px 8px; border-radius: 10px; font-size: 12px;">${shop.status}</span></p>
                                </div>
                                <div style="display: flex; gap: 10px;">
                                    <button onclick="approveShop(${shop.id})" style="padding: 8px 20px; background: #28a745; color: white; border: none; border-radius: 15px; cursor: pointer; font-size: 12px;">
                                        ✅ Approve
                                    </button>
                                    <button onclick="rejectShop(${shop.id})" style="padding: 8px 20px; background: #dc3545; color: white; border: none; border-radius: 15px; cursor: pointer; font-size: 12px;">
                                        ❌ Reject
                                    </button>
                                    <button onclick="viewShopDetails(${shop.id})" style="padding: 8px 20px; background: #17a2b8; color: white; border: none; border-radius: 15px; cursor: pointer; font-size: 12px;">
                                        👁️ View Details
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('') : '<p style="color: #999; text-align: center;">No pending shops to verify</p>'}
                </div>
            `;
            
            modal.classList.add('modal');
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Approve shop
        function approveShop(shopId) {
            const shop = shops.find(s => s.id === shopId);
            if (shop) {
                shop.status = 'active';
                shop.verifiedAt = new Date().toISOString();
                saveToStorage();
                
                addNotification('success', 'Shop Approved', `Shop "${shop.name}" has been approved and activated.`, 'normal');
                alert(`Shop "${shop.name}" has been approved!`);
                
                // Refresh the modal
                document.querySelector('.modal').remove();
                showShopVerification();
            }
        }

        // Reject shop
        function rejectShop(shopId) {
            const shop = shops.find(s => s.id === shopId);
            if (shop) {
                const reason = prompt('Please provide a reason for rejection:');
                if (reason) {
                    shop.status = 'rejected';
                    shop.rejectedAt = new Date().toISOString();
                    shop.rejectionReason = reason;
                    saveToStorage();
                    
                    addNotification('warning', 'Shop Rejected', `Shop "${shop.name}" has been rejected: ${reason}`, 'high');
                    alert(`Shop "${shop.name}" has been rejected.`);
                    
                    // Refresh the modal
                    document.querySelector('.modal').remove();
                    showShopVerification();
                }
            }
        }
        // Show KYC management
        function showKYCManagement() {
            const kycShops = shops.filter(s => s.status === 'kyc_pending');
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 20px; max-width: 1000px; width: 95%; max-height: 90vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2 style="color: #667eea; margin: 0;">📋 KYC Management</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    
                    ${kycShops.length > 0 ? kycShops.map(shop => `
                        <div style="border: 1px solid #eee; border-radius: 15px; padding: 20px; margin-bottom: 20px; background: #fafafa;">
                            <h4 style="margin: 0 0 15px 0; color: #333;">${shop.name}</h4>
                            <p style="margin: 0 0 15px 0; color: #666;">KYC verification required for this shop.</p>
                            <div style="display: flex; gap: 10px;">
                                <button onclick="approveKYC(${shop.id})" style="padding: 8px 20px; background: #28a745; color: white; border: none; border-radius: 15px; cursor: pointer; font-size: 12px;">
                                    ✅ Approve KYC
                                </button>
                                <button onclick="rejectKYC(${shop.id})" style="padding: 8px 20px; background: #dc3545; color: white; border: none; border-radius: 15px; cursor: pointer; font-size: 12px;">
                                    ❌ Reject KYC
                                </button>
                                <button onclick="requestMoreInfo(${shop.id})" style="padding: 8px 20px; background: #ffc107; color: white; border: none; border-radius: 15px; cursor: pointer; font-size: 12px;">
                                    📝 Request More Info
                                </button>
                            </div>
                        </div>
                    `).join('') : '<p style="color: #999; text-align: center;">No KYC pending shops</p>'}
                </div>
            `;
            
            modal.classList.add('modal');
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Approve KYC
        function approveKYC(shopId) {
            const shop = shops.find(s => s.id === shopId);
            if (shop) {
                shop.status = 'active';
                shop.kycApprovedAt = new Date().toISOString();
                saveToStorage();
                
                addNotification('success', 'KYC Approved', `KYC for shop "${shop.name}" has been approved.`, 'normal');
                alert(`KYC for shop "${shop.name}" has been approved!`);
                
                // Refresh the modal
                document.querySelector('.modal').remove();
                showKYCManagement();
            }
        }

        // Show escrow management
        function showEscrowManagement() {
            const activeEscrow = escrowTransactions.filter(e => e.status === 'held' || e.status === 'disputed');
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 20px; max-width: 1000px; width: 95%; max-height: 90vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2 style="color: #667eea; margin: 0;">🔒 Escrow Management</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    
                    ${activeEscrow.length > 0 ? activeEscrow.map(escrow => `
                        <div style="border: 1px solid #eee; border-radius: 15px; padding: 20px; margin-bottom: 20px; background: #fafafa;">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                                <div>
                                    <h4 style="margin: 0 0 10px 0; color: #333;">Order #${escrow.orderId}</h4>
                                    <p style="margin: 0 0 5px 0; color: #666;">Amount: ฿${escrow.amount.toLocaleString()}</p>
                                    <p style="margin: 0 0 5px 0; color: #666;">Buyer: ${escrow.buyerId}</p>
                                    <p style="margin: 0; color: #999; font-size: 14px;">Status: <span style="background: ${escrow.status === 'disputed' ? '#dc3545' : '#17a2b8'}; color: white; padding: 2px 8px; border-radius: 10px; font-size: 12px;">${escrow.status}</span></p>
                                </div>
                                <div style="display: flex; gap: 10px;">
                                    ${escrow.status === 'held' ? `
                                        <button onclick="releaseEscrow(${escrow.orderId})" style="padding: 8px 20px; background: #28a745; color: white; border: none; border-radius: 15px; cursor: pointer; font-size: 12px;">
                                            💰 Release Payment
                                        </button>
                                    ` : ''}
                                    ${escrow.status === 'disputed' ? `
                                        <button onclick="resolveDispute(${escrow.orderId})" style="padding: 8px 20px; background: #ffc107; color: white; border: none; border-radius: 15px; cursor: pointer; font-size: 12px;">
                                            ⚖️ Resolve Dispute
                                        </button>
                                    ` : ''}
                                    <button onclick="viewEscrowDetails(${escrow.id})" style="padding: 8px 20px; background: #17a2b8; color: white; border: none; border-radius: 15px; cursor: pointer; font-size: 12px;">
                                        👁️ View Details
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('') : '<p style="color: #999; text-align: center;">No active escrow transactions</p>'}
                </div>
            `;
            
            modal.classList.add('modal');
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Show live session management
        function showLiveSessionManagement() {
            const allSessions = liveSessions;
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 20px; max-width: 1000px; width: 95%; max-height: 90vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2 style="color: #667eea; margin: 0;">📺 Live Session Management</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    
                    ${allSessions.length > 0 ? allSessions.map(session => `
                        <div style="border: 1px solid #eee; border-radius: 15px; padding: 20px; margin-bottom: 20px; background: #fafafa;">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                                <div>
                                    <h4 style="margin: 0 0 10px 0; color: #333;">${session.title}</h4>
                                    <p style="margin: 0 0 5px 0; color: #666;">${session.description}</p>
                                    <p style="margin: 0 0 5px 0; color: #666;">Shop: ${session.shopName}</p>
                                    <p style="margin: 0; color: #999; font-size: 14px;">Status: <span style="background: ${getSessionStatusColor(session.status)}; color: white; padding: 2px 8px; border-radius: 10px; font-size: 12px;">${session.status}</span></p>
                                </div>
                                <div style="display: flex; gap: 10px;">
                                    ${session.status === 'scheduled' ? `
                                        <button onclick="startLiveSession(${session.id})" style="padding: 8px 20px; background: #28a745; color: white; border: none; border-radius: 15px; cursor: pointer; font-size: 12px;">
                                            🎥 Start Live
                                        </button>
                                    ` : ''}
                                    ${session.status === 'live' ? `
                                        <button onclick="endLiveSession(${session.id})" style="padding: 8px 20px; background: #dc3545; color: white; border: none; border-radius: 15px; cursor: pointer; font-size: 12px;">
                                            ⏹️ End Live
                                        </button>
                                    ` : ''}
                                    <button onclick="viewLiveSessionDetails(${session.id})" style="padding: 8px 20px; background: #17a2b8; color: white; border: none; border-radius: 15px; cursor: pointer; font-size: 12px;">
                                        👁️ View Details
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('') : '<p style="color: #999; text-align: center;">No live sessions found</p>'}
                </div>
            `;
            
            modal.classList.add('modal');
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Get session status color
        function getSessionStatusColor(status) {
            switch (status) {
                case 'scheduled': return '#17a2b8';
                case 'live': return '#dc3545';
                case 'ended': return '#6c757d';
                default: return '#6c757d';
            }
        }

        // Show voucher management
        function showVoucherManagement() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 20px; max-width: 1000px; width: 95%; max-height: 90vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2 style="color: #667eea; margin: 0;">🎫 Voucher Management</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    
                    <div style="display: flex; gap: 15px; justify-content: center; margin-bottom: 30px;">
                        <button onclick="createNewVoucher()" style="padding: 12px 25px; background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                            ➕ Create New Voucher
                        </button>
                        <button onclick="showVoucherAnalytics()" style="padding: 12px 25px; background: linear-gradient(135deg, #17a2b8, #6f42c1); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                            📊 Voucher Analytics
                        </button>
                    </div>
                    
                    <div style="background: #f8f9fa; border-radius: 15px; padding: 20px;">
                        <h3 style="margin: 0 0 20px 0; color: #333;">Current Vouchers</h3>
                        ${vouchers.map(voucher => `
                            <div style="border: 1px solid #eee; border-radius: 10px; padding: 15px; margin-bottom: 15px; background: white;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <h4 style="margin: 0; color: #333;">${voucher.code}</h4>
                                    <span style="background: ${voucher.status === 'active' ? '#28a745' : '#6c757d'}; color: white; padding: 3px 10px; border-radius: 15px; font-size: 12px;">
                                        ${voucher.status}
                                    </span>
                                </div>
                                <p style="margin: 0 0 10px 0; color: #666;">
                                    ${voucher.type === 'percentage' ? `${voucher.value}% off` : `฿${voucher.value} off`} 
                                    (Min spend: ฿${voucher.minSpend})
                                </p>
                                <p style="margin: 0; color: #999; font-size: 14px;">
                                    Usage: ${voucher.usedCount}/${voucher.usageLimit} | 
                                    Expires: ${new Date(voucher.endDate).toLocaleDateString()}
                                </p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            modal.classList.add('modal');
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Show banner management for admin
        function showBannerManagement() {
            if (!isAdmin) {
                alert('Access denied. Admin privileges required.');
                return;
            }
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 20px; max-width: 1200px; width: 95%; max-height: 90vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2 style="color: #667eea; margin: 0;">🖼️ Banner Management</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    
                    <!-- Carousel Ads (Left Side) -->
                    <div style="background: #f8f9fa; border-radius: 15px; padding: 20px; margin-bottom: 30px;">
                        <h3 style="margin: 0 0 20px 0; color: #333;">🎠 Carousel Ads (Left Side)</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                            ${bannerAds.filter(ad => ad.type === 'carousel').map(ad => `
                                <div style="border: 1px solid #eee; border-radius: 15px; padding: 20px; background: white;">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                                        <h4 style="margin: 0 0 10px 0; color: #333;">Carousel Ad #${ad.id}</h4>
                                        <label style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" ${ad.active ? 'checked' : ''} onchange="toggleBannerAd(${ad.id})">
                                            Active
                                        </label>
                                    </div>
                                    <img src="${ad.imageUrl}" alt="Ad ${ad.id}" style="width: 100%; height: 120px; object-fit: cover; border-radius: 10px; margin-bottom: 15px;">
                                    <div style="margin-bottom: 15px;">
                                        <input type="text" placeholder="Image URL" value="${ad.imageUrl}" onchange="updateBannerAd(${ad.id}, 'imageUrl', this.value)" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 10px;">
                                        <input type="text" placeholder="Title" value="${ad.title}" onchange="updateBannerAd(${ad.id}, 'title', this.value)" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 10px;">
                                        <input type="text" placeholder="Subtitle" value="${ad.subtitle}" onchange="updateBannerAd(${ad.id}, 'subtitle', this.value)" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 10px;">
                                        <input type="text" placeholder="Button Text" value="${ad.buttonText}" onchange="updateBannerAd(${ad.id}, 'buttonText', this.value)" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                                    </div>
                                    <button onclick="deleteBannerAd(${ad.id})" style="padding: 8px 20px; background: #dc3545; color: white; border: none; border-radius: 15px; cursor: pointer; font-size: 12px;">
                                        🗑️ Delete
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                        <button onclick="addNewCarouselAd()" style="padding: 12px 25px; background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500; margin-top: 20px;">
                            ➕ Add New Carousel Ad
                        </button>
                    </div>
                    
                    <!-- Static Ads (Right Side) -->
                    <div style="background: #f8f9fa; border-radius: 15px; padding: 20px; margin-bottom: 30px;">
                        <h3 style="margin: 0 0 20px 0; color: #333;">🖼️ Static Ads (Right Side)</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                            ${bannerAds.filter(ad => ad.type === 'static').map(ad => `
                                <div style="border: 1px solid #eee; border-radius: 15px; padding: 20px; background: white;">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                                        <h4 style="margin: 0 0 10px 0; color: #333;">Static Ad #${ad.id}</h4>
                                        <label style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" ${ad.active ? 'checked' : ''} onchange="toggleBannerAd(${ad.id})">
                                            Active
                                        </label>
                                    </div>
                                    <img src="${ad.imageUrl}" alt="Ad ${ad.id}" style="width: 100%; height: 120px; object-fit: cover; border-radius: 10px; margin-bottom: 15px;">
                                    <div style="margin-bottom: 15px;">
                                        <input type="text" placeholder="Image URL" value="${ad.imageUrl}" onchange="updateBannerAd(${ad.id}, 'imageUrl', this.value)" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                                    </div>
                                    <button onclick="deleteBannerAd(${ad.id})" style="padding: 8px 20px; background: #dc3545; color: white; border: none; border-radius: 15px; cursor: pointer; font-size: 12px;">
                                        🗑️ Delete
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                        <button onclick="addNewStaticAd()" style="padding: 12px 25px; background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500; margin-top: 20px;">
                            ➕ Add New Static Ad
                        </button>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button onclick="saveBannerChanges()" style="padding: 15px 30px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500; font-size: 16px;">
                            💾 Save All Changes
                        </button>
                        <button onclick="previewBannerChanges()" style="padding: 15px 30px; background: linear-gradient(135deg, #ff6b35, #f7931e); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500; font-size: 16px; margin-left: 15px;">
                            👁️ Preview Changes
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.add('modal');
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Banner management helper functions
        function toggleBannerAd(adId) {
            const ad = bannerAds.find(a => a.id === adId);
            if (ad) {
                ad.active = !ad.active;
            }
        }

        function updateBannerAd(adId, field, value) {
            const ad = bannerAds.find(a => a.id === adId);
            if (ad) {
                ad[field] = value;
            }
        }

        function deleteBannerAd(adId) {
            if (confirm('Are you sure you want to delete this banner ad?')) {
                bannerAds = bannerAds.filter(a => a.id !== adId);
                addNotification('success', 'Banner Deleted', 'Banner ad has been deleted successfully!', 'normal');
            }
        }

        function addNewCarouselAd() {
            const newAd = {
                id: Date.now(),
                type: 'carousel',
                position: 'left',
                imageUrl: 'https://via.placeholder.com/500x300/ff6b35/ffffff?text=New+Ad',
                title: 'New Carousel Ad',
                subtitle: 'New subtitle',
                buttonText: 'Click Here',
                active: true
            };
            bannerAds.push(newAd);
            addNotification('success', 'New Ad Added', 'New carousel ad has been added!', 'normal');
            showBannerManagement(); // Refresh the modal
        }

        function addNewStaticAd() {
            const newAd = {
                id: Date.now(),
                type: 'static',
                position: 'right',
                imageUrl: 'https://via.placeholder.com/300x150/4ecdc4/ffffff?text=New+Static+Ad',
                active: true
            };
            bannerAds.push(newAd);
            addNotification('success', 'New Ad Added', 'New static ad has been added!', 'normal');
            showBannerManagement(); // Refresh the modal
        }

        function saveBannerChanges() {
            // Save to localStorage
            localStorage.setItem('eddyworld_bannerAds', JSON.stringify(bannerAds));
            
            // Update the actual banner display
            updateBannerDisplay();
            
            addNotification('success', 'Banner Changes Saved', 'All banner changes have been saved successfully!', 'normal');
        }

        function previewBannerChanges() {
            // Update the banner display temporarily for preview
            updateBannerDisplay();
            addNotification('info', 'Preview Mode', 'Banner changes are now visible. Use "Save All Changes" to make them permanent.', 'normal');
        }

        function updateBannerDisplay() {
            // Update carousel ads
            const carouselContainer = document.querySelector('.carousel-container');
            if (carouselContainer) {
                carouselContainer.innerHTML = bannerAds
                    .filter(ad => ad.type === 'carousel' && ad.active)
                    .map((ad, index) => `
                        <div class="carousel-slide ${index === 0 ? 'active' : ''}" data-slide="${index + 1}">
                            <img src="${ad.imageUrl}" alt="Ad ${ad.id}">
                            <div class="slide-overlay">
                                <h2>${ad.title}</h2>
                                <p>${ad.subtitle}</p>
                                <button class="banner-btn">${ad.buttonText}</button>
                            </div>
                        </div>
                    `).join('');
                
                // Update carousel dots
                const dotsContainer = document.querySelector('.carousel-dots');
                if (dotsContainer) {
                    dotsContainer.innerHTML = bannerAds
                        .filter(ad => ad.type === 'carousel' && ad.active)
                        .map((ad, index) => `
                            <span class="dot ${index === 0 ? 'active' : ''}" data-slide="${index + 1}"></span>
                        `).join('');
                }
            }
            
            // Update static ads
            const rightAds = document.querySelector('.right-picture-ads');
            if (rightAds) {
                rightAds.innerHTML = bannerAds
                    .filter(ad => ad.type === 'static' && ad.active)
                    .map(ad => `
                        <div class="picture-ad ${ad.position === 'right' ? 'static-ad' : ''}">
                            <img src="${ad.imageUrl}" alt="Ad ${ad.id}">
                        </div>
                    `).join('');
            }
        }

        // Final marketplace initialization
        function completeMarketplaceSetup() {
            // Update UI for marketplace features
            updateUI();
            
            // Initialize flash sale countdown
            const banner = document.querySelector('.banner');
            if (banner) {
                const countdown = document.createElement('div');
                countdown.id = 'flash-sale-countdown';
                countdown.style.cssText = `
                    background: rgba(255, 107, 107, 0.9);
                    color: white;
                    padding: 15px 25px;
                    border-radius: 25px;
                    text-align: center;
                    margin-top: 20px;
                    font-weight: bold;
                    font-size: 18px;
                `;
                countdown.innerHTML = '⚡ Flash Sale: Loading...';
                banner.appendChild(countdown);
                
                // Update countdown every second
                setInterval(updateFlashSaleCountdown, 1000);
            }
            
            // Add marketplace navigation
            const nav = document.querySelector('.nav');
            if (nav) {
                const liveNav = document.createElement('a');
                liveNav.href = '#';
                liveNav.onclick = () => showLiveShopping();
                liveNav.innerHTML = '<i class="fas fa-video"></i> Live Shopping';
                liveNav.className = 'nav-item';
                nav.appendChild(liveNav);
                
                const chatNav = document.createElement('a');
                chatNav.href = '#';
                chatNav.onclick = () => showChat();
                chatNav.innerHTML = '<i class="fas fa-comments"></i> Chat';
                chatNav.className = 'nav-item';
                nav.appendChild(chatNav);
            }
        }

        // Initialize complete marketplace on page load
        // This will be handled in the main DOMContentLoaded listener

        // Show order management for admin
        function showOrderManagement() {
            showAllOrders();
        }

        // Show inventory management
        function showInventoryManagement() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 20px; max-width: 1000px; width: 95%; max-height: 90vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2 style="color: #667eea; margin: 0;">📊 Inventory Management</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    
                    <div style="background: #f8f9fa; border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="margin: 0 0 20px 0; color: #333;">Inventory Overview</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px;">
                            <div style="background: white; padding: 20px; border-radius: 15px; text-align: center; border-left: 4px solid #28a745;">
                                <h4 style="margin: 0; color: #28a745; font-size: 16px;">Total Products</h4>
                                <p style="font-size: 24px; font-weight: bold; margin: 5px 0 0 0; color: #333;">${products.length}</p>
                            </div>
                            <div style="background: white; padding: 20px; border-radius: 15px; text-align: center; border-left: 4px solid #ffc107;">
                                <h4 style="margin: 0; color: #ffc107; font-size: 16px;">Low Stock</h4>
                                <p style="font-size: 24px; font-weight: bold; margin: 5px 0 0 0; color: #333;">${products.filter(p => p.stock <= 5 && p.stock > 0).length}</p>
                            </div>
                            <div style="background: white; padding: 20px; border-radius: 15px; text-align: center; border-left: 4px solid #dc3545;">
                                <h4 style="margin: 0; color: #dc3545; font-size: 16px;">Out of Stock</h4>
                                <p style="font-size: 24px; font-weight: bold; margin: 5px 0 0 0; color: #333;">${products.filter(p => p.stock === 0).length}</p>
                            </div>
                        </div>
                    </div>

                    <div style="background: #f8f9fa; border-radius: 15px; padding: 20px;">
                        <h3 style="margin: 0 0 20px 0; color: #333;">Product Inventory</h3>
                        <div style="max-height: 400px; overflow-y: auto;">
                            ${products.map(product => `
                                <div style="background: white; border-radius: 10px; padding: 15px; margin-bottom: 15px; border-left: 4px solid ${product.stock === 0 ? '#dc3545' : product.stock <= 5 ? '#ffc107' : '#28a745'};">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                        <div>
                                            <h4 style="margin: 0; color: #333;">${product.title}</h4>
                                            <p style="margin: 0; color: #666;">Shop: ${shops.find(s => s.id === product.shopId)?.name || 'Unknown'}</p>
                                        </div>
                                        <div style="text-align: right;">
                                            <p style="margin: 0; color: #333; font-weight: bold;">Stock: ${product.stock}</p>
                                            <p style="margin: 0; color: #999; font-size: 12px;">฿${product.price.toLocaleString()}</p>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                                        <button onclick="restockProduct(${product.id})" style="padding: 8px 20px; background: #28a745; color: white; border: none; border-radius: 15px; cursor: pointer; font-size: 12px;">
                                            📦 Restock
                                        </button>
                                        <button onclick="updateProductStock(${product.id}, 0, 'Manual reset')" style="padding: 8px 20px; background: #ffc107; color: white; border: none; border-radius: 15px; cursor: pointer; font-size: 12px;">
                                            🔄 Reset Stock
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            
            modal.classList.add('modal');
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Create live session
        function createLiveSession(sessionData) {
            const newSession = {
                id: Date.now(),
                shopId: sessionData.shopId,
                title: sessionData.title,
                description: sessionData.description,
                scheduledAt: sessionData.scheduledAt,
                status: 'scheduled', // scheduled, live, ended
                startedAt: null,
                endedAt: null,
                viewerCount: 0,
                pinnedProducts: [],
                chat: [],
                createdAt: new Date().toISOString()
            };
            
            liveSessions.push(newSession);
            saveToStorage();
            
            addNotification('success', 'Live Session Created', `${sessionData.title} has been scheduled!`, 'normal');
            
            return newSession;
        }

        // Start live session
        function startLiveSession(sessionId) {
            const session = liveSessions.find(s => s.id === sessionId);
            if (session) {
                session.status = 'live';
                session.startedAt = new Date().toISOString();
                session.viewerCount = Math.floor(Math.random() * 100) + 50; // Random initial viewers
                saveToStorage();
                
                addNotification('success', 'Live Session Started', `${session.title} is now live!`, 'high');
                
                // Start viewer simulation
                simulateLiveViewers(sessionId);
            }
        }

        // End live session
        function endLiveSession(sessionId) {
            const session = liveSessions.find(s => s.id === sessionId);
            if (session) {
                session.status = 'ended';
                session.endedAt = new Date().toISOString();
                saveToStorage();
                
                addNotification('info', 'Live Session Ended', `${session.title} has ended.`, 'normal');
            }
        }

        // Pin product during live session
        function pinProduct(sessionId, productId, variantId = null) {
            const session = liveSessions.find(s => s.id === sessionId);
            if (session && session.status === 'live') {
                if (!session.pinnedProducts) session.pinnedProducts = [];
                session.pinnedProducts.push({ productId, variantId, pinnedAt: new Date().toISOString() });
                saveToStorage();
                
                addNotification('success', 'Product Pinned', 'Product has been pinned to the live session!', 'normal');
            }
        }

        // Drop coupon during live session
        function dropCoupon(sessionId, voucherId, dropAt = null) {
            const session = liveSessions.find(s => s.id === sessionId);
            if (session && session.status === 'live') {
                const voucher = vouchers.find(v => v.id === voucherId);
                if (voucher) {
                    addNotification('success', 'Coupon Dropped', `${voucher.code} coupon has been dropped!`, 'high');
                }
            }
        }

        // Create new product
        function createProduct(productData) {
            const newProduct = {
                id: ++productCounter,
                shopId: productData.shopId,
                title: productData.title,
                brand: productData.brand,
                categoryId: productData.categoryId,
                description: productData.description,
                price: productData.price,
                originalPrice: productData.originalPrice || productData.price,
                stock: productData.stock,
                images: productData.images || ['📦'],
                variants: productData.variants || [],
                rating: 0,
                reviewCount: 0,
                tags: productData.tags || [],
                status: 'active',
                createdAt: new Date().toISOString()
            };
            
            products.push(newProduct);
            
            // Initialize inventory for this product
            inventory[newProduct.id] = {
                stock: newProduct.stock,
                lowStock: Math.ceil(newProduct.stock * 0.2), // 20% of stock
                reserved: 0
            };
            
            saveToStorage();
            
            addNotification('success', 'Product Created', `${productData.title} has been added to your shop!`, 'normal');
            
            return newProduct;
        }

        // Update existing product
        function updateProduct(productId, updates) {
            const product = products.find(p => p.id === productId);
            if (!product) return false;
            
            Object.assign(product, updates);
            product.updatedAt = new Date().toISOString();
            
            // Update inventory if stock changed
            if (updates.stock !== undefined) {
                inventory[productId].stock = updates.stock;
            }
            
            saveToStorage();
            
            addNotification('success', 'Product Updated', `${product.title} has been updated!`, 'normal');
            
            return true;
        }

        // Submit KYC for shop
        function submitKYC(shopId, kycData) {
            const shop = shops.find(s => s.id === shopId);
            if (!shop) return false;
            
            shop.kyc = {
                documents: kycData.documents || [],
                status: 'kyc_pending',
                submittedAt: new Date().toISOString(),
                reviewedAt: null,
                reviewerId: null,
                notes: ''
            };
            
            shop.status = 'kyc_pending';
            saveToStorage();
            
            addNotification('info', 'KYC Submitted', 'Your KYC documents have been submitted for review.', 'normal');
            
            return true;
        }

        // Delete product
        function deleteProduct(productId) {
            const productIndex = products.findIndex(p => p.id === productId);
            if (productIndex === -1) return false;
            
            const product = products[productIndex];
            products.splice(productIndex, 1);
            
            // Remove from inventory
            delete inventory[productId];
            
            saveToStorage();
            
            addNotification('warning', 'Product Deleted', `${product.title} has been removed from your shop.`, 'normal');
            
            return true;
        }
        // Create chat thread
        function createChatThread(buyerId, shopId, orderId) {
            const existingThread = chatThreads.find(thread => 
                thread.buyerId === buyerId && 
                thread.shopId === shopId && 
                thread.orderId === orderId
            );
            
            if (existingThread) return existingThread;
            
            const newThread = {
                id: Date.now(),
                buyerId: buyerId,
                shopId: shopId,
                orderId: orderId,
                messages: [],
                createdAt: new Date().toISOString(),
                lastActivity: new Date().toISOString()
            };
            
            chatThreads.push(newThread);
            saveToStorage();
            
            return newThread;
        }

        // Send chat message
        function sendChatMessage(threadId, message, senderId) {
            const thread = chatThreads.find(t => t.id === threadId);
            if (!thread) return;
            
            const newMessage = {
                id: Date.now(),
                content: message,
                senderId: senderId,
                timestamp: new Date().toISOString()
            };
            
            if (!thread.messages) thread.messages = [];
            thread.messages.push(newMessage);
            thread.lastActivity = new Date().toISOString();
            
            saveToStorage();
            
            return newMessage;
        }

        // Simulate live viewers
        function simulateLiveViewers(sessionId) {
            const session = liveSessions.find(s => s.id === sessionId);
            if (session && session.status === 'live') {
                // Simulate viewer count changes
                setInterval(() => {
                    if (session.status === 'live') {
                        const change = Math.floor(Math.random() * 10) - 5; // -5 to +5
                        session.viewerCount = Math.max(0, session.viewerCount + change);
                        saveToStorage();
                    }
                }, 5000); // Update every 5 seconds
            }
        }

        // Generate tracking number
        function generateTrackingNumber() {
            const prefix = 'EDDY';
            const timestamp = Date.now().toString().slice(-8);
            const random = Math.random().toString(36).substr(2, 4).toUpperCase();
            return `${prefix}${timestamp}${random}`;
        }

        // Clear product stock
        function clearStock(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                product.stock = 0;
                saveToStorage();
                addNotification('warning', 'Stock Cleared', `${product.title} stock has been cleared.`, 'normal');
            }
        }

        // Restock product
        function restockProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                const newStock = prompt(`Enter new stock amount for ${product.title}:`, product.stock + 10);
                if (newStock !== null) {
                    const stockDelta = parseInt(newStock) - product.stock;
                    updateProductStock(productId, stockDelta, 'Manual restock');
                    alert(`Product ${product.title} restocked to ${newStock} units!`);
                    showInventoryManagement(); // Refresh the modal
                }
            }
        }

        // Update the existing updateProductStock function to handle manual updates
        function updateProductStock(productId, delta, reason) {
            const product = products.find(p => p.id === productId);
            if (product) {
                if (reason === 'Manual reset') {
                    product.stock = 0;
                } else {
                    product.stock += delta;
                    if (product.stock < 0) product.stock = 0;
                }
                
                // Update inventory tracking
                if (inventory[productId]) {
                    inventory[productId].stock = product.stock;
                }
                
                saveToStorage();
                
                // Check for low stock alerts
                if (product.stock <= 5 && product.stock > 0) {
                    addNotification('warning', 'Low Stock Alert', `${product.title} is running low (${product.stock} remaining)`, 'high');
                }
                
                if (product.stock === 0) {
                    addNotification('error', 'Out of Stock', `${product.title} is now out of stock`, 'urgent');
                }
            }
        }

        // Add missing functions for complete marketplace
        function showShopSettings() {
            const userShop = shops.find(s => s.ownerId === currentUser.email);
            if (!userShop) {
                alert('You need to create a shop first.');
                return;
            }
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 20px; max-width: 600px; width: 95%; max-height: 90vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2 style="color: #667eea; margin: 0;">⚙️ Shop Settings</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    
                    <div style="background: #f8f9fa; border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="margin: 0 0 20px 0; color: #333;">Shop Information</h3>
                        <p><strong>Name:</strong> ${userShop.name}</p>
                        <p><strong>Type:</strong> ${userShop.type}</p>
                        <p><strong>Status:</strong> <span style="background: ${getShopStatusColor(userShop.status)}; color: white; padding: 3px 10px; border-radius: 10px; font-size: 12px;">${userShop.status}</span></p>
                        <p><strong>Rating:</strong> ${userShop.rating}/5.0</p>
                        <p><strong>Total Sales:</strong> ${userShop.totalSales}</p>
                    </div>
                    
                    <div style="background: #f8f9fa; border-radius: 15px; padding: 20px;">
                        <h3 style="margin: 0 0 20px 0; color: #333;">Quick Actions</h3>
                        <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                            <button onclick="showProductManagement()" style="padding: 12px 25px; background: linear-gradient(135deg, #4ecdc4, #44a08d); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                                📦 Manage Products
                            </button>
                            <button onclick="showLiveSessionManagement()" style="padding: 12px 25px; background: linear-gradient(135deg, #e83e8c, #6f42c1); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500;">
                                📺 Live Sessions
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            modal.classList.add('modal');
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function showProductManagement() {
            const userShop = shops.find(s => s.ownerId === currentUser.email);
            if (!userShop) {
                alert('You need to create a shop first.');
                return;
            }
            
            const shopProducts = products.filter(p => p.shopId === userShop.id);
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 20px; max-width: 1000px; width: 95%; max-height: 90vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2 style="color: #667eea; margin: 0;">📦 Product Management</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    
                    <div style="text-align: center; margin-bottom: 30px;">
                        <button onclick="showCreateProductForm()" style="padding: 15px 30px; background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 500; font-size: 16px;">
                            ➕ Create New Product
                        </button>
                    </div>
                    
                    <div style="background: #f8f9fa; border-radius: 15px; padding: 20px;">
                        <h3 style="margin: 0 0 20px 0; color: #333;">Your Products (${shopProducts.length})</h3>
                        ${shopProducts.length > 0 ? shopProducts.map(product => `
                            <div style="background: white; border-radius: 10px; padding: 15px; margin-bottom: 15px; border-left: 4px solid ${product.status === 'active' ? '#28a745' : '#ffc107'};">
                                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                                    <div>
                                        <h4 style="margin: 0 0 10px 0; color: #333;">${product.title}</h4>
                                        <p style="margin: 0 0 5px 0; color: #666;">${product.description}</p>
                                        <p style="margin: 0; color: #999; font-size: 14px;">Status: <span style="background: ${product.status === 'active' ? '#28a745' : '#ffc107'}; color: white; padding: 2px 8px; border-radius: 10px; font-size: 12px;">${product.status}</span></p>
                                    </div>
                                    <div style="text-align: right;">
                                        <p style="margin: 0; color: #333; font-weight: bold;">฿${product.price.toLocaleString()}</p>
                                        <p style="margin: 0; color: #999; font-size: 14px;">Stock: ${product.stock}</p>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 10px;">
                                    <button onclick="editProduct(${product.id})" style="padding: 8px 20px; background: #17a2b8; color: white; border: none; border-radius: 15px; cursor: pointer; font-size: 12px;">
                                        ✏️ Edit
                                    </button>
                                    <button onclick="deleteProduct(${product.id})" style="padding: 8px 20px; background: #dc3545; color: white; border: none; border-radius: 15px; cursor: pointer; font-size: 12px;">
                                        🗑️ Delete
                                    </button>
                                </div>
                            </div>
                        `).join('') : '<p style="color: #999; text-align: center;">No products found. Create your first product!</p>'}
                    </div>
                </div>
            `;
            
            modal.classList.add('modal');
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function showCreateProductForm() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 20px; max-width: 600px; width: 95%; max-height: 90vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2 style="color: #667eea; margin: 0;">📦 Create New Product</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    
                    <form onsubmit="handleProductCreation(event)">
                        <div class="form-group">
                            <label for="productTitle">Product Title *</label>
                            <input type="text" id="productTitle" required placeholder="Enter product title">
                        </div>
                        <div class="form-group">
                            <label for="productBrand">Brand</label>
                            <input type="text" id="productBrand" placeholder="Enter brand name">
                        </div>
                        <div class="form-group">
                            <label for="productCategory">Category *</label>
                            <select id="productCategory" required>
                                ${categories.map(cat => `<option value="${cat.id}">${cat.name}</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="productDescription">Description</label>
                            <textarea id="productDescription" rows="3" placeholder="Describe your product"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="productPrice">Price (฿) *</label>
                            <input type="number" id="productPrice" required placeholder="Enter price">
                        </div>
                        <div class="form-group">
                            <label for="productStock">Stock *</label>
                            <input type="number" id="productStock" required placeholder="Enter stock quantity">
                        </div>
                        <button type="submit" class="btn-primary">Create Product</button>
                    </form>
                </div>
            `;
            
            modal.classList.add('modal');
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function handleProductCreation(event) {
            event.preventDefault();
            
            const productData = {
                title: document.getElementById('productTitle').value,
                brand: document.getElementById('productBrand').value || 'Generic',
                categoryId: parseInt(document.getElementById('productCategory').value),
                description: document.getElementById('productDescription').value || 'No description available.',
                price: parseInt(document.getElementById('productPrice').value),
                stock: parseInt(document.getElementById('productStock').value)
            };
            
            const newProduct = createProduct(productData);
            if (newProduct) {
                document.querySelector('.modal').remove();
                showProductManagement();
            }
        }

        function editProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 20px; max-width: 600px; width: 95%; max-height: 90vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2 style="color: #667eea; margin: 0;">✏️ Edit Product</h2>
                        <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    
                    <form onsubmit="handleProductUpdate(event, ${productId})">
                        <div class="form-group">
                            <label for="editProductTitle">Product Title *</label>
                            <input type="text" id="editProductTitle" required value="${product.title}">
                        </div>
                        <div class="form-group">
                            <label for="editProductBrand">Brand</label>
                            <input type="text" id="editProductBrand" value="${product.brand}">
                        </div>
                        <div class="form-group">
                            <label for="editProductCategory">Category *</label>
                            <select id="editProductCategory" required>
                                ${categories.map(cat => `<option value="${cat.id}" ${cat.id === product.categoryId ? 'selected' : ''}>${cat.name}</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editProductDescription">Description</label>
                            <textarea id="editProductDescription" rows="3">${product.description}</textarea>
                        </div>
                        <div class="form-group">
                            <label for="editProductPrice">Price (฿) *</label>
                            <input type="number" id="editProductPrice" required value="${product.price}">
                        </div>
                        <div class="form-group">
                            <label for="editProductStock">Stock *</label>
                            <input type="number" id="editProductStock" required value="${product.stock}">
                        </div>
                        <button type="submit" class="btn-primary">Update Product</button>
                    </form>
                </div>
            `;
            
            modal.classList.add('modal');
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function handleProductUpdate(event, productId) {
            event.preventDefault();
            
            const updates = {
                title: document.getElementById('editProductTitle').value,
                brand: document.getElementById('editProductBrand').value,
                categoryId: parseInt(document.getElementById('editProductCategory').value),
                description: document.getElementById('editProductDescription').value,
                price: parseInt(document.getElementById('editProductPrice').value),
                stock: parseInt(document.getElementById('editProductStock').value)
            };
            
            const success = updateProduct(productId, updates);
            if (success) {
                document.querySelector('.modal').remove();
                showProductManagement();
            }
        }

        // Complete the marketplace with all features

        // Auto-save data when page is about to unload
        window.addEventListener('beforeunload', function() {
            saveToStorage();
        });
        
        // Auto-save data periodically (every 30 seconds)
        setInterval(function() {
            if (currentUser) { // Only save if user is logged in
                saveToStorage();
            }
        }, 30000);
        
        // Auto-save data when user navigates away
        window.addEventListener('pagehide', function() {
            saveToStorage();
        });
        
        // Phone number validation function
        function validatePhoneNumber(phoneInput) {
            const phone = phoneInput.value;
            const countryCode = document.getElementById('registerCountryCode').value;
            
            // Remove any non-digit characters
            const cleanPhone = phone.replace(/\D/g, '');
            phoneInput.value = cleanPhone;
            
            // Validate length
            if (cleanPhone.length < 8) {
                phoneInput.style.borderColor = '#ff6b6b';
                phoneInput.title = 'Phone number must be at least 8 digits';
            } else if (cleanPhone.length > 15) {
                phoneInput.style.borderColor = '#ff6b6b';
                phoneInput.title = 'Phone number must be 15 digits or less';
            } else {
                phoneInput.style.borderColor = '#28a745';
                phoneInput.title = 'Valid phone number';
            }
            
            // Check if phone is already registered
            const fullPhone = countryCode + cleanPhone;
            const existingUser = users.find(u => u.phone === fullPhone);
            if (existingUser && existingUser.email !== (currentUser ? currentUser.email : '')) {
                phoneInput.style.borderColor = '#ff6b6b';
                phoneInput.title = 'This phone number is already registered';
            }
        }
        
        // Update phone validation when country code changes
        function updatePhoneValidation() {
            const phoneInput = document.getElementById('registerPhone');
            if (phoneInput && phoneInput.value) {
                validatePhoneNumber(phoneInput);
            }
        }

        // Data management functions for permanent account persistence
        function exportUserData() {
            const userData = {
                user: currentUser,
                cart: cart,
                wishlist: wishlist,
                orders: orders.filter(order => order.buyerId === currentUser.email),
                coins: getUserCoinsBalance(),
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(userData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `eddyworld_${currentUser.email}_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            addNotification('success', 'Data Exported', 'Your personal data has been exported successfully!', 'normal');
        }
        
        function importUserData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            
                            // Validate the imported data
                            if (importedData.user && importedData.user.email === currentUser.email) {
                                // Import user data
                                if (importedData.cart) cart = importedData.cart;
                                if (importedData.wishlist) wishlist = importedData.wishlist;
                                if (importedData.orders) {
                                    // Merge orders, avoiding duplicates
                                    importedData.orders.forEach(importedOrder => {
                                        if (!orders.find(order => order.orderId === importedOrder.orderId)) {
                                            orders.push(importedOrder);
                                        }
                                    });
                                }
                                
                                saveToStorage();
                                updateCartCount();
                                updateWishlistCount();
                                
                                addNotification('success', 'Data Imported', 'Your personal data has been imported successfully!', 'normal');
                                showUserProfile(); // Refresh the profile modal
                            } else {
                                alert('Invalid data file or email mismatch. Please use a file exported from your account.');
                            }
                        } catch (error) {
                            alert('Error reading file. Please make sure it\'s a valid Eddy World data file.');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }
        
        function backupUserData() {
            // Create a comprehensive backup
            const backupData = {
                user: currentUser,
                cart: cart,
                wishlist: wishlist,
                orders: orders.filter(order => order.buyerId === currentUser.email),
                coins: getUserCoinsBalance(),
                backupDate: new Date().toISOString(),
                backupType: 'comprehensive',
                version: '1.0'
            };
            
            // Save backup to localStorage with timestamp
            const backupKey = `eddyworld_backup_${currentUser.email}_${Date.now()}`;
            localStorage.setItem(backupKey, JSON.stringify(backupData));
            
            // Keep only last 5 backups
            const backupKeys = Object.keys(localStorage).filter(key => key.startsWith(`eddyworld_backup_${currentUser.email}`));
            if (backupKeys.length > 5) {
                backupKeys.sort().slice(0, -5).forEach(key => localStorage.removeItem(key));
            }
            
            addNotification('success', 'Backup Created', 'Your account has been backed up successfully!', 'normal');
        }

        // Error handling and debugging - removed console statements to prevent issues

        // Carousel functionality
        function initCarousel() {
            // Disable autoplay
            try { clearInterval(carouselInterval); } catch (e) {}
            
            // Add event listeners for navigation
            const prevBtn = document.querySelector('.prev-btn');
            const nextBtn = document.querySelector('.next-btn');
            
            if (prevBtn) prevBtn.addEventListener('click', prevSlide);
            if (nextBtn) nextBtn.addEventListener('click', nextSlide);
            
            // Add event listeners for dots
            document.querySelectorAll('.dot').forEach(dot => {
                dot.addEventListener('click', () => {
                    const slideNumber = parseInt(dot.dataset.slide);
                    goToSlide(slideNumber);
                });
            });
        }

        function nextSlide() {
            const activeCarouselAds = bannerAds.filter(ad => ad.type === 'carousel' && ad.active);
            const totalActiveSlides = activeCarouselAds.length;
            
            if (totalActiveSlides === 0) return;
            
            currentSlide = currentSlide >= totalActiveSlides ? 1 : currentSlide + 1;
            updateCarousel();
        }

        function prevSlide() {
            const activeCarouselAds = bannerAds.filter(ad => ad.type === 'carousel' && ad.active);
            const totalActiveSlides = activeCarouselAds.length;
            
            if (totalActiveSlides === 0) return;
            
            currentSlide = currentSlide <= 1 ? totalActiveSlides : currentSlide - 1;
            updateCarousel();
        }

        function goToSlide(slideNumber) {
            const activeCarouselAds = bannerAds.filter(ad => ad.type === 'carousel' && ad.active);
            const totalActiveSlides = activeCarouselAds.length;
            
            if (totalActiveSlides === 0) return;
            
            currentSlide = Math.min(Math.max(1, slideNumber), totalActiveSlides);
            updateCarousel();
        }

        function updateCarousel() {
            const activeSlides = document.querySelectorAll('.carousel-slide');
            const activeDots = document.querySelectorAll('.dot');
            
            if (activeSlides.length === 0 || activeDots.length === 0) return;
            
            // Hide all slides
            activeSlides.forEach(slide => {
                slide.classList.remove('active');
            });
            
            // Remove active class from all dots
            activeDots.forEach(dot => {
                dot.classList.remove('active');
            });
            
            // Show current slide
            const currentSlideElement = document.querySelector(`[data-slide="${currentSlide}"]`);
            if (currentSlideElement) currentSlideElement.classList.add('active');
            
            // Activate current dot
            const currentDot = document.querySelector(`.dot[data-slide="${currentSlide}"]`);
            if (currentDot) currentDot.classList.add('active');
            
            // Do not auto-advance after manual navigation
            try { clearInterval(carouselInterval); } catch (e) {}
        }

        // Initialize carousel when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Load banner ads from localStorage if available
            const savedBannerAds = localStorage.getItem('eddyworld_bannerAds');
            if (savedBannerAds) {
                try {
                    bannerAds = JSON.parse(savedBannerAds);
                } catch (e) {
                    console.log('Error loading banner ads, using defaults');
                }
            }
            
            // Update banner display with loaded data
            updateBannerDisplay();
            
            // Initialize carousel
            initCarousel();
        });
    </script>
</body>
</html>